




	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.117.0">
    <meta name="generator" content="Relearn 5.18.0">
    <meta name="description" content="CIS 527 Textbook">
    <meta name="author" content="Russell Feldhausen">
    <title>Configuration Management :: CIS 527 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cis527/2-configuration-management/index.html" rel="canonical" type="text/html" title="Configuration Management :: CIS 527 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis527/2-configuration-management/index.xml" rel="alternate" type="application/rss+xml" title="Configuration Management :: CIS 527 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis527/2-configuration-management/tele.html" rel="alternate" type="text/html" title="Configuration Management :: CIS 527 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis527/2-configuration-management/embed.html" rel="alternate" type="text/html" title="Configuration Management :: CIS 527 Textbook">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/fontawesome-all.min.css?1698865464" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis527/css/fontawesome-all.min.css?1698865464" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/nucleus.css?1698865464" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/auto-complete.css?1698865464" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis527/css/auto-complete.css?1698865464" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/perfect-scrollbar.min.css?1698865464" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/fonts.css?1698865464" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis527/css/fonts.css?1698865464" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/theme.css?1698865464" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/theme-auto.css?1698865464" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/variant.css?1698865464" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/print.css?1698865464" rel="stylesheet" media="print">
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/format-print.css?1698865464" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/ie.css?1698865464" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cis527/js/url.js?1698865464"></script>
    <script src="https://ksu-cs-textbooks.github.io/cis527/js/variant.js?1698865464"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="https://ksu-cs-textbooks.github.io/cis527/index.search.js";
      var root_url="https://ksu-cs-textbooks.github.io/cis527/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cis527/';
      window.variants && variants.init( [ 'auto', 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/custom.css?1698865464" rel="stylesheet">

  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cis527/2-configuration-management/index.html">
    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable">
        <div>
          <div id="top-tele-link">
            <a class="print-link" title='Teleprompter View' href="https://ksu-cs-textbooks.github.io/cis527/2-configuration-management/tele.html">
              <i class="fas fa-tv fa-fw"></i>
            </a>
          </div>
          <div id="top-embed-link">
            <a class="print-link" title='Embeddable Version' href="https://ksu-cs-textbooks.github.io/cis527/2-configuration-management/embed.html">
              <i class="fas fa-expand-arrows-alt fa-fw"></i>
            </a>
          </div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" class="topbar-link" title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="https://ksu-cs-textbooks.github.io/cis527/index.html"><span itemprop="name">CIS 527 Textbook</span></a><meta itemprop="position" content="1"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Configuration Management</span><meta itemprop="position" content="2"></li>
            </ol>
          </div>
        </div>
      </nav>
      <main id="body-inner" class="highlightable chapter narrow" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="chapter">
            <header class="headline">
            </header>


<div class="article-subheading">Chapter 2</div>
<h1 id="configuration-management">Configuration Management</h1>

<p>Automated provisioning of workstations and servers.</p>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Configuration Management</h1>
    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="introduction">Introduction</h1>


  
  
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Puppet Learning VM Deprecated</div>
  <div class="box-content">

<p><em>As of 2023, the Puppet Learning VM is no longer being maintained. The videos below demonstrate some of the features of Puppet, which can also be done on your Ubuntu VM after installing Puppet Agent. Unfortunately, it is not easily possible to simulate an enterprise Puppet setup without this VM, so I&rsquo;ll keep these videos up for demonstration purposes.</em> &ndash;Russ</p>
</div>
</div>

<a href="https://www.youtube.com/watch?v=iA1t_NLO0DM">YouTube Video</a>

<h4 id="resources">Resources</h4>
<ul>
<li><strong><a href="https://ksu-cs-textbooks.github.io/cis527/2-configuration-management/01-introduction-slides/">Slides</a>
</strong></li>
</ul>
<h4 id="video-script">Video Script</h4>
<p>Welcome to Module 2! In this module, we&rsquo;ll be discussing configuration management. The next video will define that concept in detail and give some additional background.</p>
<p>The lab assignment will have you work with Puppet to completely automate most of the tasks you performed in Lab 1. By doing so, hopefully you&rsquo;ll see the incredible power of using configuration management tools in your workflow as a system administrator.</p>
<p>For the lab, I chose to use the Puppet configuration management tool for a couple of reasons. First, they have an open source, community edition that is very powerful and easy to use, so there is no cost to get started. Secondly, their documentation and support is very well done, so you&rsquo;ll have plenty of ways to get help if you get stuck. Finally, they provide an easy to use learning VM that can walk you through the basics of Puppet quickly and easily.</p>
<p>To get started in this module, I recommend downloading the Puppet Learning VM at this URL. The link is also in the resources section below this video. It is a very large download, so I recommend starting it now so you are ready to go by the time you get to that point. A later video will discuss how to install and use that VM in detail.</p>
<p>Good luck!</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="configuration-management-overview">Configuration Management Overview</h1>


<a href="https://www.youtube.com/watch?v=oCkDAdMDiqw">YouTube Video</a>

<h4 id="resources">Resources</h4>
<ul>
<li><strong><a href="https://ksu-cs-textbooks.github.io/cis527/2-configuration-management/02-configuration-management-overview-slides/">Slides</a>
</strong></li>
<li><a href="https://en.wikipedia.org/wiki/Configuration_management" target="_blank">Configuration Management</a>
 on Wikipedia</li>
<li><a href="https://puppet.com/solutions/configuration-management" target="_blank">Configuration Management</a>
 from Puppet</li>
<li><a href="https://www.chef.io/configuration-management/" target="_blank">Modern Configuration Management: Configuration as Code</a>
 from Chef</li>
<li><a href="https://www.ansible.com/use-cases/configuration-management" target="_blank">Use Case: Configuration Management</a>
 from Ansible</li>
<li><a href="https://www.mitre.org/publications/systems-engineering-guide/acquisition-systems-engineering/configuration-management" target="_blank">Configuration Management</a>
 from MITRE Systems Engineering Guide</li>
<li><a href="https://saltstack.com/saltstack-enterprise/" target="_blank">SaltStack Enterprise</a>
 from SaltStack</li>
<li><a href="https://en.wikipedia.org/wiki/DevOps" target="_blank">DevOps</a>
 on Wikipedia</li>
<li><a href="https://theagileadmin.com/what-is-devops/" target="_blank">What Is DevOps?</a>
 From The Agile Admin</li>
<li><a href="http://www.jedi.be/blog/2010/02/12/what-is-this-devops-thing-anyway/" target="_blank">What is this DevOps Thing, Anyway?</a>
 From Just Enough Developed Infrastructure (JEDI)</li>
<li><a href="https://xebialabs.com/periodic-table-of-devops-tools/" target="_blank">Periodic Table of DevOps Tools</a>
 from XebiaLabs</li>
</ul>
<h4 id="video-script">Video Script</h4>
<p>This module deals with the topic of configuration management. Before I introduce that topic directly, let&rsquo;s look at what we&rsquo;ve done so far in this class.</p>
<p>In Lab 1, you were asked to set up and configure a single operating system VM for both Windows and Linux. For many system administrators, that is exactly how they operate on real systems - each one is set up by hand, one at a time, manually. This process, of course, does have some benefits. For the sysadmin, they get hands-on management with each computer they support. In addition, they can easily customize each system to meet the individual needs of the user. For sysadmins with a low level of experience, or few resources, this can be a very easy way to at least help users configure their systems. And, in practice, this method works well for small groups of users. If you are only supporting a few users, maybe even up to several dozen, manually managing systems and configurations may be the most efficient and cost-effective way to do so.</p>
<p>However, there are some major downsides to this as well. First and foremost, it is a very time consuming and labor intensive process. You probably experienced that while working on the first lab. Depending on your own experience and familiarity with those systems and the tasks at hand, it may have taken anywhere from one to several hours to complete. While you can, of course, become more proficient, it may still take quite a bit of hands-on time to configure an operating system. In addition, there is the high likelihood of machines being configured inconsistently, leading to additional support headaches down the road. I can confidently say from my time working as a sysadmin and from grading labs in this class, even with the same simple instructions, it is very difficult for any two people to configure a computer in exactly the same way. Also, as new software and operating system updates are released, you&rsquo;ll find that you need to install them on a per-machine basis, or depend on the end users to do those updates themselves. Finally, as your groups get larger, this approach really doesn&rsquo;t scale well at all.</p>
<p>So, that leads to the big question - how do we make this process scalable?</p>
<p>One way to do this is through the use of automation tools, such as GNU Make. While Make was developed to help with compiling large pieces of code, it shares many similarities with the tools we&rsquo;ll look at in this module. Many system administrators also wrote scripts to automate part of their process, but in most cases those scripts were simply a list of steps or commands that the sysadmin would run manually, and they would have to be customized to fit each particular operating system or configuration.</p>
<p>There are also a couple of techniques that can be used to scale this process. One is through the use of system images. Much like the virtual machines we are using in this class, you can actually store the entire hard drive of a computer as a system image and copy it as many times as you&rsquo;d like to machines. However, this process is also very time-consuming since the images are so big, and they can only be copied onto the same or similar hardware configurations. This is great when everyone has the same hardware, but in many organizations that simply isn&rsquo;t the case. Lastly, you can also use tools to create custom operating system installers for both Windows and Linux, with much of the configuration and software pre-installed and configured along with the operating system. Again, this is very time consuming, and it must be redone and updated every time something changes. In addition, none of these methods really address how to handle updates and new software once the system is in the hands of the users. In short, we need something better.</p>
<p>Enter the concept of a defined configuration. Imagine this: what if we could write out exactly how we would like our computers to be configured, and then direct our staff to make sure the system matched that configuration, regardless of the operating system or hardware? That configuration would be a list of configured items only, not a set of steps to accomplish that task. In essence, much of the first lab assignment could be thought of as a defined configuration. Those items are high level, system independent, and hopefully just enough information that any competent system administrator could build a system that meets those requirements. If that is the case, could we build a software tool to do the same?</p>
<p>This is the big concept behind configuration management. As a system administrator, all you have to do is define your desired configuration in a way that these tools can understand it, then they will do the rest. In that way, you can think of your system configuration as just another piece of &ldquo;source code&rdquo; and manage it just like any other code. If you need to deploy a new piece of software or update one, simply change the configuration file and every system using the tool will make the necessary changes to match. By doing so, this will greatly reduce downtime and errors and increase the consistency of all the systems you are managing. According to one estimate, 70% of all downtime in datacenters is due to human error, so the more we can take humans out of the equation, the better.</p>
<p>There are many tools available for configuration management. For this class, we&rsquo;ll be using Puppet as it is one of the easiest tools to work with in my experience, and it is available for a variety of platforms and uses. If you are interested in using configuration management tools in your own work, I encourage you to review each of these platforms, as each one offers unique features and abilities.</p>
<p>As we discuss automation tools, I briefly want to bring up the term DevOps, since it is really one of the big things you&rsquo;ll hear discussed on the internet today. DevOps is a shortened form of &ldquo;development operations&rdquo; and is, in essence, a very close collaboration between software development and system administration staff. A good way to think of this is the application of &ldquo;agile&rdquo; software development practices to the world of system administration, so that the systems can be as &ldquo;agile&rdquo; (pun intended) as the developers want them to be. This involves a high level of automation and monitoring, both in terms of configuration management but also deployment and testing. There are also the very short development cycles traditionally seen in agile development, with increased deployment frequency. We&rsquo;ll spend a little bit of time talking about DevOps later in the course, but many of the concepts we are covering here in configuration management are very applicable there as well.</p>
<p>Finally, here are a few tools from the DevOps world you may come across. Some of the biggest ones, Jenkins and Travis, are used for build and test automation, while tools such as Nagios and Icinga are helpful for system monitoring. Feel free to check out any of these tools on your own time, as you may find several of them very useful.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="assignment">Assignment</h1>

<h3 id="lab-2---configuration-management">Lab 2 - Configuration Management</h3>
<h4 id="instructions">Instructions</h4>
<p>Create two different <strong>Puppet Manifest Files</strong> that meet the specifications below. Each one will be applied to a newly installed virtual machine of the appropriate operating system configured as described in Task 0. The best way to accomplish this is to treat this assignment like a checklist and check things off as you complete them.</p>
<p>If you have any questions about these items or are unsure what they mean, please contact the instructor. Remember that part of being a system administrator (and a software developer in general) is working within vague specifications to provide what your client is requesting, so eliciting additional information is a very necessary skill.</p>

  
  
<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Note</div>
  <div class="box-content">

<p><em>To be more blunt - this specification may be purposefully designed to be vague, and it is your responsibility to ask questions about any vagaries you find. Once you begin the grading process, you cannot go back and change things, so be sure that your machines meet the expected specification regardless of what is written here. &ndash;Russ</em></p>
</div>
</div>
<p>Also, to complete many of these items, you may need to refer to additional materials and references not included in this document. System administrators must learn how to make use of available resources, so this is a good first step toward that. Of course, there&rsquo;s always <a href="http://www.google.com" target="_blank">Google</a>
!</p>
<h4 id="time-expectation">Time Expectation</h4>
<p>This lab may take anywhere from <strong>1 - 6 hours</strong> to complete, depending on your previous experience working with these tools and the speed of the hardware you are using.</p>

  
  
<div class="box notices cstyle tip">
  <div class="box-label"><i class="fa-fw fas fa-lightbulb"></i> Tip</div>
  <div class="box-content">

<p><strong>Testing Manifest Files</strong> - When testing these manifest files, there is a three step process. First, <strong>apply</strong> the manifest, then <strong>reboot</strong>, then <strong>apply again</strong>. This is because any changes made to group memberships are not applied until after a user logs back in or the system reboots. So, you may get permission issues when creating files or assigning permissions due to incorrect group memberships. Ideally, those permission errors should be eliminated after a reboot. There is no good fix for this in Puppet itself, since it is an operating system issue. Therefore, this is the process that you should use, and it is the process that will be used when your manifest files are graded. Basically, if you get no errors after a reboot, you should be fine!</p>
</div>
</div>
<hr>
<h3 id="task-0-create-new-virtual-machines--snapshots">Task 0: Create New Virtual Machines &amp; Snapshots</h3>
<p>Create new Windows 10 and Ubuntu 22.04 virtual machines for this lab. When creating the virtual machines and installing the operating system, use the same information from Lab 1. You should create the <code>cis527</code> account during installation. <strong>DO NOT PERFORM ANY ADDITIONAL CONFIGURATION AFTER THE INSTALLATION IS COMPLETE EXCEPT WHAT IS LISTED BELOW!</strong></p>
<p>After installing the operating system, install <strong>ONLY</strong> the following software:</p>
<ul>
<li>Puppet Agent 8 (<a href="https://downloads.puppetlabs.com/windows/puppet8/" target="_blank">Windows</a>
 &amp; Ubuntu)
<ul>
<li>See <a href="https://puppet.com/docs/puppet/latest/install_agents.html" target="_blank">Installing Agents</a>
 and <a href="https://www.puppet.com/docs/puppet/8/install_puppet#enable_the_puppet_platform_repository" target="_blank">Enable the Puppet Platform on Apt</a>
 from Puppet Documentation</li>
<li>Recall that Ubuntu 22.04 is codenamed &ldquo;Jammy Jellyfish&rdquo;, so use the url <code>https://apt.puppet.com/puppet8-release-jammy.deb</code> to get the correct version on Ubuntu.</li>
</ul>
</li>
<li>VMware Tools (Windows) and either <code>open-vm-tools-desktop</code> or VMware Tools (Ubuntu)</li>
<li>All System Updates (Windows &amp; Ubuntu)</li>
</ul>
<p>On the Windows virtual machine only, create a folder at <code>C:\install</code> and download the following installers. Do not change the name of the installers from the default name provided from the website. You may choose to do this step using the <a href="https://forge.puppet.com/puppet/download_file" target="_blank">download_file</a>
 Puppet module instead.</p>
<ul>
<li><a href="https://www.mozilla.org/en-US/firefox/all/" target="_blank">Firefox</a>
 (<code>Firefox Setup 116.0.2.exe</code> as of 8/15/2023)</li>
<li><a href="https://www.thunderbird.net/en-US/thunderbird/all/" target="_blank">Thunderbird</a>
 (<code>Thunderbird Setup 115.1.0.exe</code> as of 8/15/2023)</li>
<li><a href="https://notepad-plus-plus.org/download/" target="_blank">Notepad++</a>
 (<code>npp.8.5.6.Installer.x64.exe</code> as of 8/15/2023)</li>
</ul>

  
  
<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Note</div>
  <div class="box-content">

<p><em>I have listed sample names of the installers as of this writing, and these will be the ones that I use for testing; however, you may receive newer versions with slightly different names. That is fine. Just be sure that you don&rsquo;t get the default stub or web-only installers, which is what Firefox typically gives you unless you follow the links above. They will not work properly for this lab. &ndash;Russ</em></p>
</div>
</div>
<p>Once you have your virtual machines configured, make a snapshot of each called &ldquo;Puppet Testing&rdquo; for your use. As you test your Puppet manifest files, you&rsquo;ll reset to this snapshot to undo any changes made by Puppet so you can test on a clean VM. The VMs used for grading will be configured as described here.</p>

  
  
<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div>
  <div class="box-content">

<p>When you reset back to a snapshot, any new or modified files on the VM will be lost. So, make sure you keep a backup of the latest version of your manifest files on your host machine!</p>
</div>
</div>
<hr>
<h3 id="task-1-puppet-manifest-file-for-ubuntu">Task 1: Puppet Manifest File for Ubuntu</h3>
<p>Create a Puppet Manifest File for Ubuntu 22.04 that defines the following configuration. This configuration is very similar to, but not exactly the same as, Lab 1, so read through it carefully. Assume that the machine you are applying the manifest file on is configured as described above in Task 0.</p>
<ul>
<li><strong>Users (Same as Lab 1)</strong>
<ul>
<li><code>adminuser</code> | <code>AdminPassword123</code> (Administrator type or <code>sudo</code> group)</li>
<li><code>normaluser</code> | <code>NormalPassword123</code> (Normal type)</li>
<li><code>guestuser</code> | <code>GuestPassword123</code> (Normal type)</li>
<li><code>eviluser</code> | <code>EvilPassword123</code> (Normal type)</li>
<li><em>Create groups as needed below</em></li>
</ul>
</li>
<li><strong>Files &amp; Permissions (Same as Lab 1)</strong>
<ul>
<li>Create a folder <code>/docs</code> (<strong>at the root of the system, not in a user&rsquo;s home folder</strong>). Any user may read or write to this folder, and it should be owned by <code>root:root</code> (user: <code>root</code>; group: <code>root</code>).</li>
<li>Within <code>/docs</code>, create a folder for each user created above except for <code>cis527</code>, with the folder name matching the user&rsquo;s name.</li>
<li>Make sure that each folder is owned by the user of the same name, and that that user has full permissions to its namesake folder.</li>
<li>Create a group and set permissions on each folder using that group to allow both <code>cis527</code> and <code>adminuser</code> to have full access to each folder created in <code>/docs</code>.</li>
<li>No other user should be able to access any other user&rsquo;s folder. For example, <code>eviluser</code> cannot access <code>guestuser</code>&rsquo;s folder, but <code>adminuser</code> and <code>cis527</code> can, as well as <code>guestuser</code>, who is also the owner of its own folder.</li>
<li>In each subfolder of <code>/docs</code>, create a text file. It should have the same access permissions as the folder it is contained in. The name and contents of the text file are up to you.</li>
<li>See <a href="https://ksu-cs-textbooks.github.io/cis527/2-configuration-management/03-assignment/../../images/lab1-image2.png">this screenshot</a>
 for what these permissions may look like in Terminal.</li>
</ul>
</li>
<li><strong>Software (Same as Lab 1)</strong>
<ul>
<li>Mozilla Firefox (<code>firefox</code>)</li>
<li>Mozilla Thunderbird (<code>thunderbird</code>)</li>
<li>Apache Web Server (<code>apache2</code>)</li>
<li>Synaptic Package Manager (<code>synaptic</code>)</li>
<li>GUFW Firewall Management Utility (<code>gufw</code>)</li>
<li>ClamAV (<code>clamav</code>)</li>
</ul>
</li>
<li><strong>Services</strong> - Ensure the following services are running:
<ul>
<li>Apache Web Server</li>
<li>Clam AntiVirus&rsquo; FreshClam Service

  
  
<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Note</div>
  <div class="box-content">

<p><em>You will have to find the appropriate name for each service. &ndash;Russ</em></p>
</div>
</div></li>
</ul>
</li>
</ul>
<hr>
<h3 id="task-2-puppet-manifest-file-for-windows-10">Task 2: Puppet Manifest File for Windows 10</h3>
<p>Create a Puppet Manifest File for Windows 10 that defines the following configuration. This configuration is very similar to, but not exactly the same as, Lab 1, so read through it carefully. Assume that the machine you are applying the manifest file on is configured as described above in Task 0.</p>
<ul>
<li><strong>Users (Same as Lab 1)</strong>
<ul>
<li><code>AdminUser</code> | <code>AdminPassword123</code> (Administrators &amp; Users group)</li>
<li><code>NormalUser</code> | <code>NormalPassword123</code> (Users group)</li>
<li><code>GuestUser</code> | <code>GuestPassword123</code> (Guests group only)</li>
<li><code>EvilUser</code> | <code>EvilPassword123</code> (Users group)</li>
<li><em>Create groups as needed below</em></li>
</ul>
</li>
<li><strong>Files &amp; Permissions (Same as Lab 1)</strong>
<ul>
<li>Create the folder <code>C:\docs</code>. It should be owned by the <code>cis527</code> account, but make sure all other users can read and write to that folder.</li>
<li>Within <code>C:\docs</code>, create a folder for each user created above except for <code>cis527</code>, with the folder name matching the user&rsquo;s name.</li>
<li>Make sure that each folder is owned by the user of the same name, and that that user has full permissions to its namesake folder.</li>
<li>Create a group containing <code>cis527</code> and <code>AdminUser</code>, and set permissions on <code>C:\docs</code> for that group to have full access to each folder created in <code>C:\docs</code>.</li>
<li>No other user should be able to access any other user&rsquo;s folder. For example, <code>EvilUser</code> cannot access <code>GuestUser</code>&rsquo;s folder, but <code>AdminUser</code> and <code>cis527</code> can, as well as <code>GuestUser</code>, who is also the owner of its own folder.</li>
<li>In each subfolder of <code>C:\docs</code>, create a text file. It should have the same access permissions as the folder it is contained in. The name and contents of the text file are up to you.</li>
<li><strong>Don&rsquo;t remove the SYSTEM account or the built-in Administrator account&rsquo;s access from any of these files.</strong> Usually this is as simple as not modifying their permissions from the defaults.</li>
<li>See <a href="https://ksu-cs-textbooks.github.io/cis527/2-configuration-management/03-assignment/../../images/lab1-image1.png">this screenshot</a>
 and <a href="https://ksu-cs-textbooks.github.io/cis527/2-configuration-management/03-assignment/../../images/lab1-image1a.png">this screenshot</a>
 for what these permissions may look like in PowerShell.</li>
</ul>
</li>
<li><strong>Software</strong> - Install the latest version of the following software. The installation should be done SILENTLY without any user interaction required. In addition, Puppet should be able to detect if they are already installed, and not attempt to install them again.
<ul>
<li>Mozilla Firefox</li>
<li>Mozilla Thunderbird</li>
<li>Notepad++

  
  
<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Note</div>
  <div class="box-content">

<p><em>You will need to research the appropriate options to give to the installer through Puppet for them to install silently. For this lab, you should not use any Windows package managers such as Chocolatey or Ninite. The installation files will be already downloaded and stored in <code>C:\install</code>. Also, you&rsquo;ll need to make sure your resource names exactly match the names of the packages after they are installed, or Puppet will attempt to reinstall them each time the manifest file is applied. &ndash;Russ</em></p>
</div>
</div></li>
</ul>
</li>
<li><strong>Services</strong> - Ensure the following services are running:
<ul>
<li>DHCP Client</li>
<li>DNS Client</li>
<li>Windows Update

  
  
<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Note</div>
  <div class="box-content">

<p><em>You will have to find the appropriate name for each service. &ndash;Russ</em></p>
</div>
</div></li>
</ul>
</li>
</ul>
<hr>
<h3 id="task-3-upload-to-canvas--contact-instructor">Task 3: Upload to Canvas &amp; Contact Instructor</h3>

  
  
<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Note</div>
  <div class="box-content">

<p>Please add comments to your Puppet Manifest Files describing any Puppet Modules that must be installed prior to applying them.</p>
</div>
</div>
<p>Upload your completed Puppet Manifest Files to Canvas and then contact the instructor for grading. You may continue with the next module once grading has been completed. In general, this lab does not require interactive grading, but you are welcome to request a time if you&rsquo;d prefer.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="installing-puppet">Installing Puppet</h1>


  
  
<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Note</div>
  <div class="box-content">

<p>The video refers to Puppet version 6, but Puppet 8 is now the latest version. For the lab assignment, you&rsquo;ll want to install Puppet 8 and not Puppet 6. This changes the URL used to get the release package - see the assignment page for more information. The basic process is otherwise the same.</p>
</div>
</div>

<a href="https://www.youtube.com/watch?v=brfUIda9IPc">YouTube Video</a>

<!-- F12XwpusumA -->
<h4 id="resources">Resources</h4>
<ul>
<li><a href="https://downloads.puppetlabs.com/windows/puppet8/" target="_blank">Puppet Agent Windows Downloads</a>
 from Puppet (look for puppet-agent-x64-latest.msi)</li>
<li><a href="https://www.puppet.com/docs/puppet/8/platform_components" target="_blank">About Puppet Platform and Its Packages</a>
 from Puppet</li>
<li><a href="https://puppet.com/download-learning-vm" target="_blank">Puppet Learning VM</a>
 from Puppet</li>
<li><a href="https://puppet.com/docs/pe/latest/system_requirements.html" target="_blank">Puppet System Requirements</a>
 from Puppet</li>
<li><a href="https://puppet.com/docs" target="_blank">Puppet Documentation</a>
 from Puppet</li>
<li><a href="https://puppet.com/docs/puppet/latest/install_agents.html" target="_blank">Installing Puppet Agent</a>
 from Puppet</li>
<li><a href="https://puppet.com/docs/puppet/latest/install_agents.html#concept-6837" target="_blank">Add Executables to your PATH</a>
 from Puppet</li>
</ul>
<h4 id="video-script">Video Script</h4>
<p>To begin work on Lab 2, you&rsquo;ll need to install Puppet Agent on your new VMs. This video will walk you through that process.</p>
<p>First, let&rsquo;s look at installing Puppet Agent on Ubuntu. Here I have an Ubuntu VM configured as described in the Lab 2 assignment, except I have not installed the Puppet Agent software yet. To install Puppet Agent, we must first enable the Puppet Platform repositories. A link to these instructions are in the resources section below the video. On that page, scroll down to the section titled &ldquo;Enable the Puppet Platform on Apt&rdquo; and enter the two commands given.</p>
<p>However, we&rsquo;ll need to determine the URL required for our version of Puppet and Ubuntu. In this case, we&rsquo;d like to install Puppet version 6, and we are using Ubuntu 20.04, which is codenamed &ldquo;Focal Fossa&rdquo;. So, our URL would consist of &lsquo;puppet6&rsquo; as the platform name, and &lsquo;focal&rsquo; as the OS abbreviation. So, the full URL will be <code>https://apt.puppetlabs.com/puppet6-release-focal.deb</code>. When we place that first URL after <code>wget</code> in the first command, it will simply download a .DEB installation file to your computer. The second command uses the <code>dpkg</code> tool to install that file.</p>
<p>Once we&rsquo;ve done that, we can use <code>sudo apt update</code> and <code>sudo apt install puppet-agent</code> to install the Puppet Agent program on Ubuntu.</p>
<p>However, you won&rsquo;t be able to use those commands until we add them to the <code>PATH</code> environment variable. The <code>PATH</code> variable is a list of folders that contain the commands you can access from the Terminal. If you have reviewed the information in the Extras module for Bash Scripting, you are already familiar with the <code>PATH</code> variable. The instructions for installing Puppet Agent on Linux linked in the resources section gives one way to add these commands to your <code>PATH</code> variable, but it is incomplete and will not work in all cases. So, there are two options: one would be to use the full path each time you need to use the Puppet commands, and the second is to modify the <code>PATH</code> variable. In this video, I&rsquo;ll walk you through the steps to modify your <code>PATH</code> to enable direct access to these commands.</p>
<p>First, you must add it to your own <code>PATH</code> variable. To do so, use the following command to edit your Bash configuration file:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nano ~/.bashrc</span></span></code></pre></div><p>Use the arrow keys to navigate to the bottom of the file. Then, on a new line, add the following:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>export PATH<span style="color:#f92672">=</span>/opt/puppetlabs/bin:$PATH</span></span></code></pre></div><p>Then press <kbd>CTRL</kbd>+<kbd>X</kbd>, then <kbd>Y</kbd>, then <kbd>ENTER</kbd> to save and close the file. Finally, close and reopen Terminal to load the new <code>PATH</code> variable. If you did it correctly, you should be able to run the <code>puppet</code> command, as you can see here.</p>
<p>However, if you try to use <code>sudo</code> to run the <code>puppet</code> command as root, you&rsquo;ll notice that it still cannot find the command. This is due to the fact that the system protects the <code>PATH</code> variable from changes when using root privileges in order to enhance system security. So, you&rsquo;ll also need to edit the <code>PATH</code> variable used by the <code>sudo</code> command. To do so, use the following command to open the <code>sudo</code> configuration file:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo visudo</span></span></code></pre></div><p>This command will open the <code>\etc\sudoers</code> file on your system for editing. Near the top, you&rsquo;ll see a line for <code>Defaults secure_path</code> containing the <code>PATH</code> variable used by the <code>sudo</code> command. Carefully edit that line by adding the following text to the end, before the closing quotation mark:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>:/opt/puppetlabs/bin</span></span></code></pre></div><p>Note that I added a colon to the end of the existing line, then the new path. On my system, the full line now looks like this:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Defaults    secure_path<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin:/opt/puppetlabs/bin&#34;</span></span></span></code></pre></div><p>Once you are done editing, you can use <kbd>CTRL</kbd>+<kbd>X</kbd>, then <kbd>Y</kbd>, then <kbd>ENTER</kbd> to save and close the file. You should now be able to use the <code>sudo puppet</code> command as well.</p>
<p>Now, let&rsquo;s switch over to Windows and install the Puppet Agent there. First, you&rsquo;ll need to download the Puppet Agent using the link on the resources page below this video. Remember to find the latest version of the Puppet Agent installer, as there are many listed on this page. Once you have downloaded the file, simply double-click on it to run the installer. It will install Puppet Agent on the computer. It&rsquo;s that simple!</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="puppet-resources">Puppet Resources</h1>


  
  
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Puppet Learning VM Deprecated</div>
  <div class="box-content">

<p><em>As of 2023, the Puppet Learning VM is no longer being maintained. The videos below demonstrate some of the features of Puppet, which can also be done on your Ubuntu VM after installing Puppet Agent. Unfortunately, it is not easily possible to simulate an enterprise Puppet setup without this VM, so I&rsquo;ll keep these videos up for demonstration purposes.</em> &ndash;Russ</p>
</div>
</div>

<a href="https://www.youtube.com/watch?v=KAnRoCS2NHo">YouTube Video</a>

<h4 id="resources">Resources</h4>
<ul>
<li><strong><a href="https://ksu-cs-textbooks.github.io/cis527/2-configuration-management/05-puppet-resources-slides/">Slides</a>
</strong></li>
<li><a href="https://puppet.com/docs/puppet/latest/cheatsheet_core_types.html" target="_blank">Core Types Cheat Sheet</a>
 from Puppet</li>
<li><a href="https://puppet.com/docs/puppet/latest/type.html" target="_blank">Resource Type Reference</a>
 from Puppet</li>
</ul>
<h4 id="video-script">Video Script</h4>
<p>In this video, we will begin learning how to use Puppet to configure a system. Before creating our own Puppet scripts, called Manifest Files, we will discuss how Puppet actually views a system it is configuring.</p>
<p>In Puppet, a system is simply a set of resources. There are many different types of resources, such as files, user accounts, installed programs, and more. In addition to a type, each resource has a title, and a set of attributes giving additional information about the resource. The resources section below the video has links to the Puppet documentation for resource types.</p>
<p>Let&rsquo;s review some different resources using the Puppet Learning VM. You can also perform many of these same operations on your Windows and Linux computers with Puppet Agent installed. If you&rsquo;d like to follow along, I&rsquo;ll be working in the <code>hello_puppet</code> quest on the Puppet Learning VM.</p>
<p>I have already performed the first task for the <code>hello_puppet</code> quest, so I&rsquo;m now connected to one of the internal systems and installed the Puppet Agent on it. Now, I can start Task 2, where I review a file resource. Using Puppet, you can describe a file resource such as the following:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo puppet resource file /tmp/test</span></span></code></pre></div><p>That should give you information about that file. Here you can see that the resource is of type file, and has its path for a title. Below that are the attributes of the file, given as <code>parameter =&gt; value</code> pairs. Since the file doesn&rsquo;t exist, the only attribute visible is the ensure attribute, and it shows that the file is absent on the system.</p>
<p>We can easily create the file using this command:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>touch /tmp/test</span></span></code></pre></div><p>Then we can use the same resource command to view it:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo puppet resource file /tmp/test</span></span></code></pre></div><p>Now we can see many additional attributes of the file.</p>
<p>We can also use the <code>puppet resource</code> command to modify resource. For example, let&rsquo;s add some content to that file:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo puppet resource file /tmp/test content<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Hello Puppet!&#39;</span></span></span></code></pre></div><p>Once you run that command, you can view the contents of the file to confirm that it worked:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat /tmp/test</span></span></code></pre></div><p>There are many types of resources that can be viewed and modified in this way. For example, you can view information about a user account, such as the learning account on the current VM:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo puppet resource user learning</span></span></code></pre></div><p>You can also find information about installed software packages, such as the Apache Webserver <code>httpd</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo puppet resource package httpd</span></span></code></pre></div><p>In this case, since the package is not installed on the system, the ensure attribute is set to purged, which is similar to absent.</p>
<p>The Puppet Learning VM quest describes how to see the inner workings of a Puppet Resource by breaking it. I&rsquo;m not going to go over that process in detail, but I recommend you review that information on your own.</p>
<p>As with the file, we can configure attributes easily enough:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo puppet resource package httpd ensure<span style="color:#f92672">=</span>present</span></span></code></pre></div><p>That command will install the latest version of the <code>httpd</code> package. Note that when it executes, the ensure value is changed to the current version. Later, as you define your Puppet manifests, you can use the ensure attribute to install the latest version using the <code>present</code> value, or provide a specific version number here if desired.</p>
<p>There are many different types of resources available in Puppet. I encourage you to review some of the documentation linked below this video before continuing, just to get an idea of what is available. The next video will describe how to create your own Puppet Manifest Files and apply them to a system directly using the Puppet Agent.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="puppet-manifest-files">Puppet Manifest Files</h1>


  
  
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Puppet Learning VM Deprecated</div>
  <div class="box-content">

<p><em>As of 2023, the Puppet Learning VM is no longer being maintained. The videos below demonstrate some of the features of Puppet, which can also be done on your Ubuntu VM after installing Puppet Agent. Unfortunately, it is not easily possible to simulate an enterprise Puppet setup without this VM, so I&rsquo;ll keep these videos up for demonstration purposes.</em> &ndash;Russ</p>
</div>
</div>

<a href="https://www.youtube.com/watch?v=3QFCLHACFIM">YouTube Video</a>

<h4 id="resources">Resources</h4>
<ul>
<li><strong><a href="https://ksu-cs-textbooks.github.io/cis527/2-configuration-management/06-puppet-manifest-files-slides/">Slides</a>
</strong></li>
<li><a href="https://www.digitalocean.com/community/tutorials/configuration-management-101-writing-puppet-manifests" target="_blank">Configuration Management 101: Writing Puppet Manifests</a>
 from DigitalOcean</li>
<li><a href="https://puppet.com/docs/puppet/latest/lang_visual_index.html" target="_blank">Language: Visual Index</a>
 from Puppet</li>
<li><a href="https://puppet.com/docs/puppet/latest/puppet_language.html" target="_blank">Language: Basics</a>
 from Puppet</li>
</ul>
<h4 id="video-script">Video Script</h4>
<p>Now, let&rsquo;s take a look at how we can use Puppet to create defined configurations to be applied to our systems. In Puppet, we refer to those defined configurations as manifest files. Each manifest file defines a set of resources to be configured on the system. Then, the Puppet Agent tool compares the configuration defined in the manifest file and the system&rsquo;s current configuration, making changes as needed to the system until they match. In addition, each manifest file should be written in a way that it can be repeatedly applied to a system, since it is only defining the configuration desired and not the steps to accomplish it. This makes Puppet a very powerful tool for managing system configuration across a variety of systems and platforms.</p>
<p>When you apply a manifest file, Puppet will go through a compilation process to convert the manifest file into a catalog. When working in a larger organization with a Puppet master server containing several manifest files, this allows the system to distill all of that information into a single place. We&rsquo;ll talk a bit more about that when we look at a master/agent setup using Puppet.</p>
<p>Now, let&rsquo;s create our first Puppet Manifest files. Once again, I&rsquo;m using the Learning Puppet VM during the <code>hello_puppet</code> quest, but you can follow along on your own Windows or Linux VM as well. I&rsquo;ll use SSH to connect to the <code>hello.puppet.vm</code> node, then make sure the Puppet Agent is installed.</p>
<p>To make this process simpler, I&rsquo;m also going to install the Nano text editor. For most beginners, I feel that Nano is the easiest command-line text editor to learn, though it may not be the most powerful. If you are familiar with Vim, feel free to use it as it is already installed on this system. Since the Learning Puppet VM is using CentOS as its Linux distribution of choice, the command to install packages is a bit different than on Ubuntu. To install Nano, type the following:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo yum install nano</span></span></code></pre></div><p>Now, let&rsquo;s open a new text file using Nano, called <code>manifest.pp</code>. In that file, we can define a file resource as follows:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-pp" data-lang="pp"><span style="display:flex;"><span><span style="color:#66d9ef">file</span> { <span style="color:#e6db74">&#39;/tmp/testfile&#39;</span>:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">ensure</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;file&#39;</span>,<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">content</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;Manifest File!&#39;</span>,<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">mode</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;0644&#39;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}</span></span></code></pre></div><p>Once you have created that file, press <kbd>CTRL</kbd>+<kbd>X</kbd>, then <kbd>Y</kbd>, then <kbd>ENTER</kbd> to save and close the file in Nano. Then, you can apply the file using this command:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo puppet apply manifest.pp</span></span></code></pre></div><p>It should successfully apply, and give you a message that the file was created. You can then use either</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo puppet resource file /tmp/testfile</span></span></code></pre></div><p>or</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ls -l /tmp/testfile</span></span></code></pre></div><p>to verify that the file exists and has the correct permissions. You can also view the file&rsquo;s contents using</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat /tmp/testfile</span></span></code></pre></div><p>It&rsquo;s that easy! Most of the attributes displayed when you use the puppet resource command are configurable in a manifest file, so you can use puppet resource to determine how a system is currently configured, then copy the desired attributes into a manifest file to define that configuration. Let&rsquo;s add a few more things to our manifest:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-pp" data-lang="pp"><span style="display:flex;"><span><span style="color:#66d9ef">package</span> {  <span style="color:#e6db74">&#39;nano&#39;</span>:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">ensure</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;present&#39;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">user</span> { <span style="color:#e6db74">&#39;cis527&#39;</span>:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">ensure</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;present&#39;</span>,<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">shell</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;/bin/zsh&#39;</span>,<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">home</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;/home/cis527&#39;</span>,<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">managehome</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}</span></span></code></pre></div><p>Once you&rsquo;ve edited a manifest file, you can verify that your syntax is correct using the following command:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>puppet parser validate manifest.pp</span></span></code></pre></div><p>If you have any errors in your manifest file, it will give you the approximate line and column number. Be careful about your use of colons, commas, quotes, and brackets. As with any programming language, Puppet is very particular about the correct use of syntax.</p>
<p>Now, let&rsquo;s apply that manifest and see what happens:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo puppet apply manifest.pp</span></span></code></pre></div><p>Since the Nano package is already installed, it probably won&rsquo;t do much at this point. However, it should create the cis527 user. We can verify that it worked by switching to that user account. First, we&rsquo;ll need to set a password for it:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo passwd cis527</span></span></code></pre></div><p>Then, we can use that password and the switch user command to log in as that user:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>su cis527</span></span></code></pre></div><p>If all goes well, our terminal should change to show that we are logged in as the cis527 user. Of course, it is possible to define the desired password in the manifest file, but that is something you&rsquo;ll have to figure out on your own as you complete Lab 2. (I can&rsquo;t give everything away, can I?)</p>
<p>Before moving on to the next video, I encourage you to play around with this temporary manifest file a bit and see what other changes you can make to the resources we&rsquo;ve defined, or what other resources you can use here.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="puppet-resource-ordering">Puppet Resource Ordering</h1>


  
  
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Puppet Learning VM Deprecated</div>
  <div class="box-content">

<p><em>As of 2023, the Puppet Learning VM is no longer being maintained. The videos below demonstrate some of the features of Puppet, which can also be done on your Ubuntu VM after installing Puppet Agent. Unfortunately, it is not easily possible to simulate an enterprise Puppet setup without this VM, so I&rsquo;ll keep these videos up for demonstration purposes.</em> &ndash;Russ</p>
</div>
</div>

<a href="https://www.youtube.com/watch?v=RywZUa_x3oA">YouTube Video</a>

<h4 id="resources">Resources</h4>
<ul>
<li><a href="https://puppet.com/docs/puppet/latest/lang_relationships.html" target="_blank">Language: Relationships and Ordering</a>
 from Puppet</li>
</ul>
<h4 id="video-script">Video Script</h4>
<p>Now that we&rsquo;ve seen Puppet Manifest files, let&rsquo;s discuss some of the caveats of such a system. On the Learning Puppet VM, during the <code>hello_puppet</code> quest as described in the earlier videos, I&rsquo;m going to continue to create manifest files on the <code>hello.puppet.vm</code> node.</p>
<p>Using Nano, create the following manifest file:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-pp" data-lang="pp"><span style="display:flex;"><span><span style="color:#66d9ef">file</span> { <span style="color:#e6db74">&#39;/tmp/test1&#39;</span>:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">ensure</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;file&#39;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">file</span> { <span style="color:#e6db74">&#39;/tmp/test2&#39;</span>:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">ensure</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;file&#39;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">file</span> { <span style="color:#e6db74">&#39;/tmp/test3&#39;</span>:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">ensure</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;file&#39;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">notify</span> { <span style="color:#e6db74">&#34;First Notification&#34;</span>: }<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">notify</span> { <span style="color:#e6db74">&#34;Second Notification&#34;</span>: }<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">notify</span> { <span style="color:#e6db74">&#34;Third Notification&#34;</span>: }</span></span></code></pre></div><p>Once that is done, apply the manifest:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo puppet apply test.pp</span></span></code></pre></div><p>When you do, you may see things applied out of order. Since a Puppet Manifest file only defines the desired configuration, it is up to the Puppet Agent tool to determine which steps are necessary and in what order. This is because Puppet considers each resource definition to be <strong>atomic</strong>, meaning that it is independent of all other resources. In some cases, however, we want to make sure that some resources are configured before others. Thankfully, Puppet gives us many ways to do so.</p>
<p>The first uses the before and require keywords. Here is an example from the Puppet documentation linked in the resources section below the video:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-pp" data-lang="pp"><span style="display:flex;"><span><span style="color:#66d9ef">package</span> { <span style="color:#e6db74">&#39;openssh-server&#39;</span>:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">ensure</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">present</span>,<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">before</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">File</span>[<span style="color:#e6db74">&#39;/etc/ssh/sshd_config&#39;</span>],<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">file</span> { <span style="color:#e6db74">&#39;/etc/ssh/sshd_config&#39;</span>:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">ensure</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">file</span>,<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">mode</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;0600&#39;</span>,<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">source</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;puppet:///modules/sshd/sshd_config&#39;</span>,<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">require</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">Package</span>[<span style="color:#e6db74">&#39;openssh-server&#39;</span>],<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}</span></span></code></pre></div><p>Each of these elements creates the same relationship. You only need to include either the before or require keyword in one of the resources, but both are not required.</p>
<p>Similarly, the notify and subscribe keywords create a similar relationship. From the documentation:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-pp" data-lang="pp"><span style="display:flex;"><span><span style="color:#66d9ef">file</span> { <span style="color:#e6db74">&#39;/etc/ssh/sshd_config&#39;</span>:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">ensure</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">file</span>,<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">mode</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;0600&#39;</span>,<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">source</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;puppet:///modules/sshd/sshd_config&#39;</span>,<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">notify</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">Service</span>[<span style="color:#e6db74">&#39;sshd&#39;</span>],<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">service</span> { <span style="color:#e6db74">&#39;sshd&#39;</span>:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">ensure</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">running</span>,<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">enable</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span>,<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">subscribe</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">File</span>[<span style="color:#e6db74">&#39;/etc/ssh/sshd_config&#39;</span>],<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}</span></span></code></pre></div><p>Again, only one or the other is required. However, unlike with the before and require keywords, in this case the second item will only be refreshed if the prior resource has changed. In this example, if the <code>sshd_config</code> file is changed, then the <code>sshd</code> service will be restarted so it will read the newly changed file. This is a very powerful tool for making changes to configuration files and making sure the services immediately restart and load the new configuration.</p>
<p>Finally, the third method is through the use of chaining arrows. This tells the Puppet Agent to apply resources in the order they are written in the manifest. One of the most powerful and common uses of this is to create a &ldquo;Package, File, Service&rdquo; chain. Here is the example from the Puppet documentation:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-pp" data-lang="pp"><span style="display:flex;"><span><span style="color:#75715e"># first:</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">package</span> { <span style="color:#e6db74">&#39;openssh-server&#39;</span>:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">ensure</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">present</span>,<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>} <span style="color:#f92672">-&gt;</span><span style="color:#75715e"> # and then:</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">file</span> { <span style="color:#e6db74">&#39;/etc/ssh/sshd_config&#39;</span>:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">ensure</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">file</span>,<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">mode</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;0600&#39;</span>,<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">source</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;puppet:///modules/sshd/sshd_config&#39;</span>,<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>} <span style="color:#f92672">~&gt;</span><span style="color:#75715e"> # and then, if the previous file was updated:</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">service</span> { <span style="color:#e6db74">&#39;sshd&#39;</span>:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">ensure</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">running</span>,<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">enable</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span>,<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}</span></span></code></pre></div><p>This manifest will ensure the <code>openssh-server</code> package is installed first. Then, once it is installed, it will place the desired configuration file on the system. The first arrow with a simple hyphen creates a before/require relationship. Then, if that file is modified in any way, the second arrow, using a tilde <code>~</code> character, will enforce a notify/subscribe relationship and cause the <code>sshd</code> service to refresh.</p>
<p>As you work on your Puppet Manifest files for Lab 2, it is helpful to keep in mind that some resources may need to be chained together to work properly. However, do not try to chain together your entire manifest file, as that defeats much of the flexibility of Puppet itself.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="puppet-variables--facts">Puppet Variables &amp; Facts</h1>


<a href="https://www.youtube.com/watch?v=SEVm33_GcYc">YouTube Video</a>

<h4 id="resources">Resources</h4>
<ul>
<li><a href="https://puppet.com/docs/puppet/latest/lang_variables.html" target="_blank">Language: Variables</a>
 from Puppet</li>
<li><a href="https://puppet.com/docs/puppet/latest/core_facts.html" target="_blank">Facter: Core Facts</a>
 from Puppet</li>
<li><a href="https://puppet.com/docs/puppet/latest/lang_data.html" target="_blank">Values and Data Types</a>
 from Puppet</li>
<li><a href="https://puppet.com/docs/puppet/latest/lang_template.html" target="_blank">Templates</a>
 from Puppet</li>
</ul>
<h4 id="video-script">Video Script</h4>
<p>In this video, we&rsquo;ll go just a bit deeper into the Puppet language and some additional features of Puppet. You may not need all of this information to complete Lab 2, but it is definitely helpful.</p>
<p>First, as with any programming language, Puppet allows you to assign variables. The basic syntax for assigning a variable is:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-pp" data-lang="pp"><span style="display:flex;"><span>$my_variable <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Some text&#34;</span></span></span></code></pre></div><p>As with many scripting languages, a variable name always begins with a dollar sign <code>$</code>, and is assigned with a single equals sign <code>=</code>. Unlike most languages, however, variables can only be assigned once. If you think about it, this makes sense, since Puppet may apply resources in any order. In this way, it is much more of a declarative language than an imperative language, though it shares some features of both.</p>
<p>You can then use variables in your manifest files. For example, a variable is interpolated in any double-quoted string, such as here:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-pp" data-lang="pp"><span style="display:flex;"><span>$username <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;russfeld&#34;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">notify</span> { <span style="color:#e6db74">&#34;Your home directory is /home/${username}&#34;</span>: }</span></span></code></pre></div><p>Puppet also has a very powerful templating language that can be used with configuration files. It is outside the scope of what I&rsquo;ll cover in this class, but I encourage you to look into it on your own if you are interested.</p>
<p>Another tool bundled with Puppet is Facter. Facter is able to provide information about the system it is running on. Puppet can then use that information in manifest variables and templates to customize the system&rsquo;s configuration. To see the facts available on your system, type:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>facter -p</span></span></code></pre></div><p>Of course, you&rsquo;ll find that there are many facts available. You can find a full list of facts in the Puppet documentation linked below this video. You can also write custom facts, if needed.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="puppet-programming-constructs--classes">Puppet Programming Constructs &amp; Classes</h1>


<a href="https://www.youtube.com/watch?v=1-i6RDUoAeI">YouTube Video</a>

<h4 id="resources">Resources</h4>
<ul>
<li><a href="https://puppet.com/docs/puppet/latest/lang_conditional.html" target="_blank">Conditional Statements and Expressions</a>
 from Puppet</li>
<li><a href="https://puppet.com/docs/puppet/latest/lang_expressions.html" target="_blank">Expressions and Operators</a>
 from Puppet</li>
<li><a href="https://puppet.com/docs/puppet/latest/lang_classes.html" target="_blank">Classes</a>
 from Puppet</li>
<li><a href="https://forge.puppet.com/puppetlabs/stdlib" target="_blank">Puppet Labs Standard Library</a>
 from Puppet</li>
<li><a href="https://forge.puppet.com/" target="_blank">Puppet Forge</a>
 from Puppet</li>
</ul>
<h4 id="video-script">Video Script</h4>
<p>Puppet also has very powerful programming constructs which can be used in your manifest files. One of the most useful is the conditional statement, or &ldquo;if&rdquo; statement. The syntax is very similar to most other languages. For example, here is the sample &ldquo;if&rdquo; statement from the Puppet documentation:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-pp" data-lang="pp"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> $facts[<span style="color:#e6db74">&#39;is_virtual&#39;</span>] {<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">warning</span>(<span style="color:#e6db74">&#39;Tried to include class ntp on virtual machine; this node might be misclassified.&#39;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">elsif</span> $facts[&#39;os&#39;][<span style="color:#e6db74">&#39;family&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;Darwin&#39;</span> {<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">warning</span>(<span style="color:#e6db74">&#39;This NTP module does not yet work on our Mac laptops.&#39;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">else</span> {<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">include</span> <span style="color:#a6e22e">ntp</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}</span></span></code></pre></div><p>In this statement, the manifest is determining if the system is virtualized, or if the OS family is Darwin, the base kernel family for Apple Macintosh laptops. If either of those is the case, it will print a warning message. However, if neither of those is true, then it will include the <code>ntp</code> module. We&rsquo;ll talk about modules later in the video. An &ldquo;if&rdquo; statement such as this, combined with the information that can be gleaned from a system using Facter, allows you to create manifest files that could be applied on a variety of different systems.</p>
<p>One caveat to be aware of: make sure you are careful about your data types. In Puppet, as in many other languages, the boolean value <code>false</code> and the string value <code>&quot;false&quot;</code> are different. In fact, Puppet treats non-empty strings as the boolean value true by default. In addition, all of the facts from Facter are strings, so you must be careful how you use them.</p>
<p>Consider this example:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-pp" data-lang="pp"><span style="display:flex;"><span>$boolean <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;false&#34;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">if</span> $boolean {<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">notify</span>{<span style="color:#e6db74">&#34;This is true&#34;</span>:}<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">else</span> {<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">notify</span>{<span style="color:#e6db74">&#34;This is false&#34;</span>:}<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}</span></span></code></pre></div><p>When you run a manifest file containing this code, you&rsquo;ll be notified that the value is true, since is a string. To resolve this problem, you can use the <code>str2bool</code> function included in the Puppet Labs Standard Library. First, install the Puppet Labs Standard Library module using the following command:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>puppet module install puppetlabs-stdlib</span></span></code></pre></div><p>Then, modify the manifest file as follows:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-pp" data-lang="pp"><span style="display:flex;"><span><span style="color:#66d9ef">include</span> <span style="color:#a6e22e">stdlib</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>$boolean <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;false&#34;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">str2bool</span>(<span style="color:#e6db74">&#34;$boolean&#34;</span>) {<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">notify</span>{<span style="color:#e6db74">&#34;This is true&#34;</span>:}<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">else</span> {<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">notify</span>{<span style="color:#e6db74">&#34;This is false&#34;</span>:}<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}</span></span></code></pre></div><p>Now, you&rsquo;ll get the expected result. The Puppet Labs Standard Library includes many other useful functions, so I encourage you to check them out. The documentation is linked in the resources below this video.</p>
<p>In addition to the &ldquo;if&rdquo; statement, Puppet also includes a &ldquo;case&rdquo; statement. The basic syntax is as follows:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-pp" data-lang="pp"><span style="display:flex;"><span><span style="color:#66d9ef">case</span> $operatingsystem {<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#e6db74">&#34;centos&#34;</span>: { $apache <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;httpd&#34;</span> }<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#e6db74">&#34;redhat&#34;</span>: { $apache <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;httpd&#34;</span> }<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#e6db74">&#34;debian&#34;</span>: { $apache <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;apache2&#34;</span> }<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#e6db74">&#34;ubuntu&#34;</span>: { $apache <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;apache2&#34;</span> }<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">default</span>: { <span style="color:#66d9ef">fail</span>(<span style="color:#e6db74">&#34;Unrecognized OS&#34;</span>) }<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}</span></span></code></pre></div><p>The matches here are case-insensitive, which is very helpful. You can also combine some of the labels and use regular expressions, as in this example:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-pp" data-lang="pp"><span style="display:flex;"><span><span style="color:#66d9ef">case</span> $operatingsystem {<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#e6db74">&#34;centos&#34;</span>, <span style="color:#e6db74">&#34;redhat&#34;</span>: { $apache <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;httpd&#34;</span> }<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#f92672">/</span><span style="color:#960050;background-color:#1e0010">^</span>(<span style="color:#a6e22e">Debian</span><span style="color:#f92672">|</span><span style="color:#a6e22e">Ubuntu</span>)$/: { $apache <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;apache2&#34;</span> }<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">default</span>: { <span style="color:#66d9ef">fail</span>(<span style="color:#e6db74">&#34;Unrecognized OS&#34;</span>) }<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}</span></span></code></pre></div><p>When using regular expressions, note that the matching is case-sensitive.</p>
<p>Finally, Puppet code can be further organized into classes. As with most object-oriented languages, a class definition is very simple. Here is one example:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-pp" data-lang="pp"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">myclass</span> (<span style="color:#a6e22e">String</span> $message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Hello&#34;</span>) {<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">notify</span> { <span style="color:#e6db74">&#34;${message} user&#34;</span>: }<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}</span></span></code></pre></div><p>Once the class is defined, you can use the include keyword to declare it in your manifest file, using all default values for parameters:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-pp" data-lang="pp"><span style="display:flex;"><span><span style="color:#66d9ef">include</span> <span style="color:#a6e22e">myclass</span></span></span></code></pre></div><p>Or you may declare it using a resource syntax, allowing you to override default parameter values:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-pp" data-lang="pp"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> { <span style="color:#e6db74">&#39;myclass&#39;</span>:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#a6e22e">message</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;Test&#34;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}</span></span></code></pre></div><p>Either way, it is important to remember that you must always declare a class to use it. A class definition itself is not sufficient for the resources inside the class to be configured.</p>
<p>Finally, on most enterprise Puppet systems, the manifest files have been further organized into a set of modules. Each module is a self-contained set of manifest files, templates, and configuration files, all for a particular use. For example, above the sample code references the <code>ntp</code> module, which is a module available from Puppet for managing NTP servers.</p>
<p>Unfortunately, writing your own modules is a very complex task, and I have decided that it is outside of the scope of what I&rsquo;d like to cover in this class. Feel free to continue following the documentation in the Learning Puppet VM to see more about how to write your own modules.</p>
<p>In many cases, however, there are already modules freely available to perform a variety of common management tasks. So, I highly recommend checking out the available modules on Puppet Forge to see what&rsquo;s out there. As with many system administration tasks, don&rsquo;t try to reinvent the wheel if one already exists!</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="puppet-agent--master-demo">Puppet Agent &amp; Master Demo</h1>


  
  
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Puppet Learning VM Deprecated</div>
  <div class="box-content">

<p><em>As of 2023, the Puppet Learning VM is no longer being maintained. The videos below demonstrate some of the features of Puppet, which can also be done on your Ubuntu VM after installing Puppet Agent. Unfortunately, it is not easily possible to simulate an enterprise Puppet setup without this VM, so I&rsquo;ll keep these videos up for demonstration purposes.</em> &ndash;Russ</p>
</div>
</div>

<a href="https://www.youtube.com/watch?v=M84N1TbRB-g">YouTube Video</a>

<h4 id="resources">Resources</h4>
<ul>
<li><a href="https://puppet.com/docs/puppet/latest/architecture.html" target="_blank">Overview of Puppet&rsquo;s Architecture</a>
 from Puppet</li>
</ul>
<h4 id="video-script">Video Script</h4>
<p>In this video, I&rsquo;ll give a quick demonstration of what a true enterprise Puppet setup might look like. Once again, I&rsquo;m going to be using the Learning Puppet VM, and this time I&rsquo;ll be following the <code>agent_run</code> quest to demonstrate these features.</p>
<p>The <code>agent_run</code> quest gives us a client system already set up and ready to go. We can access it using SSH:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ssh learning@agent.puppet.vm</span></span></code></pre></div><p>Once we are on that system, we can try to force a Puppet Agent run using the following command:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo puppet agent -t</span></span></code></pre></div><p>However, when the Puppet Agent tries to contact the Puppet Master server, it presents an error about client certificates. As a security measure, we must sign the certificate for each agent that tries to contact the server before it will be allowed access. Without this step, any malicious user could gain valuable information about our system configuration by talking with the Puppet Master.</p>
<p>To sign that certificate, we can go back to the Puppet Master by exiting the current SSH session:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>exit</span></span></code></pre></div><p>Then we can use this command to show all the unsigned certificates on the system:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo puppet cert list</span></span></code></pre></div><p>To sign a certificate, we can use this command:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo puppet cert sign agent.puppet.vm</span></span></code></pre></div><p>Now, we can reconnect to our agent node:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ssh learning@agent.puppet.vm</span></span></code></pre></div><p>And try to run the agent again:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo puppet agent -t</span></span></code></pre></div><p>This time, we should be successful. However, we haven&rsquo;t really told Puppet what we want configured on this system. So, let&rsquo;s go back to the Puppet Master and do so:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>exit</span></span></code></pre></div><p>On the Puppet Master, we would like to edit the manifest file used to configure each system. As before, I&rsquo;ll quickly install Nano to make editing files much simpler, but feel free to use Vim if you would like:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo yum install nano</span></span></code></pre></div><p>Next, we&rsquo;ll edit the default site manifest file, which is located at the end of a very long directory path:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nano /etc/puppetlabs/code/environments/production/manifests/site.pp</span></span></code></pre></div><p>This is the default site manifest file for this system. On an actual system, you may define different environments and roles for each system, which may alter the path to this file. For this example, we&rsquo;ll just make a quick edit to show how it can be done.</p>
<p>At the bottom of the file, add the following:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-pp" data-lang="pp"><span style="display:flex;"><span><span style="color:#66d9ef">node</span> <span style="color:#e6db74">&#39;agent.puppet.vm&#39;</span> {<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">notify</span> { <span style="color:#e6db74">&#34;Hello Puppet!&#34;</span>: }<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}</span></span></code></pre></div><p>Then, use <kbd>CTRL</kbd>+<kbd>X</kbd>, then <kbd>Y</kbd>, then <kbd>ENTER</kbd> to save and close the file.</p>
<p>Finally, return to the agent VM:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ssh learning@agent.puppet.vm</span></span></code></pre></div><p>and run Puppet Agent once again:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo puppet agent -t</span></span></code></pre></div><p>If done correctly, you should see a notification of <code>&quot;Hello Puppet!&quot;</code> in the output.</p>
<p>This is a very short demo of the power of Puppet&rsquo;s Master and Agent architecture. The Puppet Learning VM quests go much more in-depth in ways to use Puppet in an organization. I highly encourage you to review that information if you are interested, but it is not required to complete Lab 2.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="hints">Hints</h1>


<a href="https://www.youtube.com/watch?v=td6I_LDL91w">YouTube Video</a>

<h4 id="resources">Resources</h4>
<ul>
<li><a href="https://puppet.com/docs/puppet/latest/types/user.html" target="_blank">Resource Type: User</a>
 from Puppet</li>
<li><a href="https://puppet.com/docs/puppet/latest/resources_package_windows.html" target="_blank">Resource Tips and Examples: Package on Windows</a>
 from Puppet</li>
<li><a href="https://www.puppet.com/docs/pe/2019.7/managing_windows_configurations.html" target="_blank">Managing Windows Configurations</a>
 from Puppet</li>
<li><a href="https://forge.puppet.com/puppetlabs/windows" target="_blank">Puppet on Windows Pack</a>
 from Puppet Forge</li>
<li><a href="https://www.puppet.com/docs/pe/2019.7/installing_and_using_windows_modules.html" target="_blank">Installing and Using Windows Modules</a>
 from Puppet</li>
<li><a href="https://forge.puppet.com/puppet/download_file" target="_blank">download_file Module</a>
 from Puppet Forge</li>
<li><a href="https://www.puppet.com/docs/puppet/latest/services_commands_windows.html" target="_blank">Running Puppet&rsquo;s Commands on Windows</a>
 from Puppet</li>
<li><a href="https://puppet.com/docs/puppet/latest/resources_user_group_windows.html" target="_blank">Using User and Group on Windows</a>
 from Puppet</li>
<li><a href="https://forge.puppet.com/puppetlabs/acl" target="_blank">puppetlabs-acl Module</a>
 on Puppet Forge</li>
</ul>
<h4 id="video-script">Video Script</h4>
<p>Here are a few hints for completing Lab 2, based on the struggles some students have had during previous semesters.</p>
<p>First, let&rsquo;s talk about passwords. On the Puppet documentation for the user resource type, it notes that on Linux, the password given in the configuration file must already be encrypted. Thankfully, it gives you some hints here on using built-in functions, or functions from the Puppet Labs Standard Library, to calculate the correct encrypted password. You can also use the Sensitive data type to redact the plain-text password from log files. Of course, on Windows, you can only use cleartext passwords.</p>
<p>Next, installing packages on Windows can be quite difficult without using a package management program such as Chocolatey. In the resources section below this video, I&rsquo;ve included a few links describing the process for installing and managing packages in Windows in detail. In short, you&rsquo;ll need to be very careful about the title matching the actual <code>DisplayName</code> of the package, as well as the <code>install_options</code> to make them install silently. This may take a bit of trial and error to get it working correctly.</p>
<p>In addition, when you download the installation files for Windows, make sure you get the full installers and not the &ldquo;stub&rdquo; installer that just downloads the real installer in the background. Sometimes you have to dig a bit deeper on the vendor&rsquo;s website to find these. As stated in the assignment sheet, you may also choose to download the files using the <code>download_file</code> Puppet module. Either approach will work.</p>
<p>Another important note: on both Windows and Linux, changes to group membership do not take effect immediately. On Linux, the current user must log-out and log-in to see the change, whereas on Windows a reboot is required in most cases. Because of this, when testing your manifest files, you may find it necessary to apply the manifest, then logout/reboot and apply it again for all resources to be configured correctly. That is fine, provided that it works as intended on the second application.</p>
<p>Finally, you may find that defining permissions in Windows is difficult using the default file resource. You may choose to install the <code>puppetlabs-acl</code> module to configure Windows permissions directly. The resources section below the video includes a link to that module and its documentation as well.</p>
<p>I hope these hints help you successfully complete Lab 2 with minimal frustration. As always, if you have any questions or run into any issues, please post on the course discussion forums before contacting the instructor. Good luck!</p>

            <footer class="footline">

            </footer>
          </article>

    
    
    
    
    
    
    
    
    
    
          </section>

        </div>
      </main>
    
<div class="git-footer">
<p class="theme-version-footer">5.18.0</p>
<p>Last modified by: 
            <i class='fas fa-user'></i> Russell Feldhausen
            <i class='fas fa-calendar'></i> <a href="https://gitlab.cs.ksu.edu/cis-527/cis527online/-/commit/84061ea45bef3eaeed1adfe99c235e8c52dcaff8">Aug 10, 2023</a>
</p>
</div>

    
    </div>
    <script src="https://ksu-cs-textbooks.github.io/cis527/js/clipboard.min.js?1698865467" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis527/js/perfect-scrollbar.min.js?1698865467" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis527/js/theme.js?1698865467" defer></script>
  </body>
</html>
