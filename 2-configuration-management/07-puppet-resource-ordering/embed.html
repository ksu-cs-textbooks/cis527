<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=html><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.148.1"><meta name=generator content="Relearn 8.0.0"><meta name=description content="Puppet Learning VM Deprecated As of 2023, the Puppet Learning VM is no longer being maintained. The videos below demonstrate some of the features of Puppet, which can also be done on your Ubuntu VM after installing Puppet Agent. Unfortunately, it is not easily possible to simulate an enterprise Puppet setup without this VM, so I’ll keep these videos up for demonstration purposes. –Russ"><meta name=author content="Russell Feldhausen"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://textbooks.cs.ksu.edu/cis527/images/hero.png"><meta name=twitter:title content="Puppet Resource Ordering :: CIS 527 Textbook"><meta name=twitter:description content="Puppet Learning VM Deprecated As of 2023, the Puppet Learning VM is no longer being maintained. The videos below demonstrate some of the features of Puppet, which can also be done on your Ubuntu VM after installing Puppet Agent. Unfortunately, it is not easily possible to simulate an enterprise Puppet setup without this VM, so I’ll keep these videos up for demonstration purposes. –Russ"><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis527/2-configuration-management/07-puppet-resource-ordering/index.html"><meta property="og:site_name" content="CIS 527 Textbook"><meta property="og:title" content="Puppet Resource Ordering :: CIS 527 Textbook"><meta property="og:description" content="Puppet Learning VM Deprecated As of 2023, the Puppet Learning VM is no longer being maintained. The videos below demonstrate some of the features of Puppet, which can also be done on your Ubuntu VM after installing Puppet Agent. Unfortunately, it is not easily possible to simulate an enterprise Puppet setup without this VM, so I’ll keep these videos up for demonstration purposes. –Russ"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="Configuration Management"><meta property="article:modified_time" content="2023-08-15T14:59:11-05:00"><meta property="og:image" content="https://textbooks.cs.ksu.edu/cis527/images/hero.png"><meta itemprop=name content="Puppet Resource Ordering :: CIS 527 Textbook"><meta itemprop=description content="Puppet Learning VM Deprecated As of 2023, the Puppet Learning VM is no longer being maintained. The videos below demonstrate some of the features of Puppet, which can also be done on your Ubuntu VM after installing Puppet Agent. Unfortunately, it is not easily possible to simulate an enterprise Puppet setup without this VM, so I’ll keep these videos up for demonstration purposes. –Russ"><meta itemprop=dateModified content="2023-08-15T14:59:11-05:00"><meta itemprop=wordCount content="672"><meta itemprop=image content="https://textbooks.cs.ksu.edu/cis527/images/hero.png"><title>Puppet Resource Ordering :: CIS 527 Textbook</title><link href=https://textbooks.cs.ksu.edu/cis527/2-configuration-management/07-puppet-resource-ordering/index.html rel=canonical type=text/html title="Puppet Resource Ordering :: CIS 527 Textbook"><link href=/cis527/2-configuration-management/07-puppet-resource-ordering/index.xml rel=alternate type=application/rss+xml title="Puppet Resource Ordering :: CIS 527 Textbook"><link href=/cis527/2-configuration-management/07-puppet-resource-ordering/index.print.html rel=alternate type=text/html title="Puppet Resource Ordering :: CIS 527 Textbook"><link href=/cis527/2-configuration-management/07-puppet-resource-ordering/tele.html rel=alternate type=text/html title="Puppet Resource Ordering :: CIS 527 Textbook"><link href=/cis527/css/auto-complete/auto-complete.min.css?1755629944 rel=stylesheet><script src=/cis527/js/auto-complete/auto-complete.min.js?1755629944 defer></script><script src=/cis527/js/search-lunr.min.js?1755629944 defer></script><script src=/cis527/js/search.min.js?1755629944 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/cis527/searchindex.en.js?1755629944"</script><script src=/cis527/js/lunr/lunr.min.js?1755629944 defer></script><script src=/cis527/js/lunr/lunr.stemmer.support.min.js?1755629944 defer></script><script src=/cis527/js/lunr/lunr.multi.min.js?1755629944 defer></script><script src=/cis527/js/lunr/lunr.en.min.js?1755629944 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/cis527/fonts/fontawesome/css/fontawesome-all.min.css?1755629944 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis527/fonts/fontawesome/css/fontawesome-all.min.css?1755629944 rel=stylesheet></noscript><link href=/cis527/css/perfect-scrollbar/perfect-scrollbar.min.css?1755629944 rel=stylesheet><link href=/cis527/css/theme.min.css?1755629944 rel=stylesheet><link href=/cis527/css/format-html.min.css?1755629944 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/2-configuration-management/07-puppet-resource-ordering/index.html",window.relearn.relBasePath="../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis527",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!1,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["light-theme"],window.relearn.customvariantname="my-custom-variant",window.relearn.writeVariant=!1,window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.writeVariant&&window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><link href=/cis527/css/custom.css?1755629944 rel=stylesheet></head><body class="mobile-support embed html" data-url=/cis527/2-configuration-management/07-puppet-resource-ordering/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><div id=R-main-overlay></div><main id=R-body-inner class="highlightable 2-configuration-management" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=puppet-resource-ordering>Puppet Resource Ordering</h1><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Puppet Learning VM Deprecated</summary><div class=box-content><p><em>As of 2023, the Puppet Learning VM is no longer being maintained. The videos below demonstrate some of the features of Puppet, which can also be done on your Ubuntu VM after installing Puppet Agent. Unfortunately, it is not easily possible to simulate an enterprise Puppet setup without this VM, so I&rsquo;ll keep these videos up for demonstration purposes.</em> &ndash;Russ</p></div></details><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/RywZUa_x3oA style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><h4 id=resources>Resources</h4><ul><li><a href=https://puppet.com/docs/puppet/latest/lang_relationships.html rel=external target=_blank>Language: Relationships and Ordering</a> from Puppet</li></ul><h4 id=video-script>Video Script</h4><p>Now that we&rsquo;ve seen Puppet Manifest files, let&rsquo;s discuss some of the caveats of such a system. On the Learning Puppet VM, during the <code>hello_puppet</code> quest as described in the earlier videos, I&rsquo;m going to continue to create manifest files on the <code>hello.puppet.vm</code> node.</p><p>Using Nano, create the following manifest file:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-pp data-lang=pp><span style=display:flex><span><span style=color:#66d9ef>file</span> <span style=color:#75715e>{ &#39;/tmp/test1&#39;:
</span></span></span><span style=display:flex><span><span style=color:#75715e>  ensure =&gt; &#39;file&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>file</span> <span style=color:#75715e>{ &#39;/tmp/test2&#39;:
</span></span></span><span style=display:flex><span><span style=color:#75715e>  ensure =&gt; &#39;file&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>file</span> <span style=color:#75715e>{ &#39;/tmp/test3&#39;:
</span></span></span><span style=display:flex><span><span style=color:#75715e>  ensure =&gt; &#39;file&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>notify <span style=color:#75715e>{ &#34;First Notification&#34;: }</span>
</span></span><span style=display:flex><span>notify <span style=color:#75715e>{ &#34;Second Notification&#34;: }</span>
</span></span><span style=display:flex><span>notify <span style=color:#75715e>{ &#34;Third Notification&#34;: }</span></span></span></code></pre></div><p>Once that is done, apply the manifest:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo puppet apply test.pp</span></span></code></pre></div><p>When you do, you may see things applied out of order. Since a Puppet Manifest file only defines the desired configuration, it is up to the Puppet Agent tool to determine which steps are necessary and in what order. This is because Puppet considers each resource definition to be <strong>atomic</strong>, meaning that it is independent of all other resources. In some cases, however, we want to make sure that some resources are configured before others. Thankfully, Puppet gives us many ways to do so.</p><p>The first uses the before and require keywords. Here is an example from the Puppet documentation linked in the resources section below the video:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-pp data-lang=pp><span style=display:flex><span><span style=color:#66d9ef>package</span> <span style=color:#75715e>{ &#39;openssh-server&#39;:
</span></span></span><span style=display:flex><span><span style=color:#75715e>  ensure =&gt; present,
</span></span></span><span style=display:flex><span><span style=color:#75715e>  before =&gt; File[&#39;/etc/ssh/sshd_config&#39;],
</span></span></span><span style=display:flex><span><span style=color:#75715e>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>file</span> <span style=color:#75715e>{ &#39;/etc/ssh/sshd_config&#39;:
</span></span></span><span style=display:flex><span><span style=color:#75715e>  ensure =&gt; file,
</span></span></span><span style=display:flex><span><span style=color:#75715e>  mode =&gt; &#39;0600&#39;,
</span></span></span><span style=display:flex><span><span style=color:#75715e>  source =&gt; &#39;puppet:///modules/sshd/sshd_config&#39;,
</span></span></span><span style=display:flex><span><span style=color:#75715e>  require =&gt; Package[&#39;openssh-server&#39;],
</span></span></span><span style=display:flex><span><span style=color:#75715e>}</span></span></span></code></pre></div><p>Each of these elements creates the same relationship. You only need to include either the before or require keyword in one of the resources, but both are not required.</p><p>Similarly, the notify and subscribe keywords create a similar relationship. From the documentation:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-pp data-lang=pp><span style=display:flex><span><span style=color:#66d9ef>file</span> <span style=color:#75715e>{ &#39;/etc/ssh/sshd_config&#39;:
</span></span></span><span style=display:flex><span><span style=color:#75715e>  ensure =&gt; file,
</span></span></span><span style=display:flex><span><span style=color:#75715e>  mode =&gt; &#39;0600&#39;,
</span></span></span><span style=display:flex><span><span style=color:#75715e>  source =&gt; &#39;puppet:///modules/sshd/sshd_config&#39;,
</span></span></span><span style=display:flex><span><span style=color:#75715e>  notify =&gt; Service[&#39;sshd&#39;],
</span></span></span><span style=display:flex><span><span style=color:#75715e>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>service <span style=color:#75715e>{ &#39;sshd&#39;:
</span></span></span><span style=display:flex><span><span style=color:#75715e>  ensure =&gt; running,
</span></span></span><span style=display:flex><span><span style=color:#75715e>  enable =&gt; true,
</span></span></span><span style=display:flex><span><span style=color:#75715e>  subscribe =&gt; File[&#39;/etc/ssh/sshd_config&#39;],
</span></span></span><span style=display:flex><span><span style=color:#75715e>}</span></span></span></code></pre></div><p>Again, only one or the other is required. However, unlike with the before and require keywords, in this case the second item will only be refreshed if the prior resource has changed. In this example, if the <code>sshd_config</code> file is changed, then the <code>sshd</code> service will be restarted so it will read the newly changed file. This is a very powerful tool for making changes to configuration files and making sure the services immediately restart and load the new configuration.</p><p>Finally, the third method is through the use of chaining arrows. This tells the Puppet Agent to apply resources in the order they are written in the manifest. One of the most powerful and common uses of this is to create a &ldquo;Package, File, Service&rdquo; chain. Here is the example from the Puppet documentation:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-pp data-lang=pp><span style=display:flex><span><span style=color:#ae81ff>#</span> first<span style=color:#f92672>:</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>package</span> <span style=color:#75715e>{ &#39;openssh-server&#39;:
</span></span></span><span style=display:flex><span><span style=color:#75715e>  ensure =&gt; present,
</span></span></span><span style=display:flex><span><span style=color:#75715e>}</span> <span style=color:#f92672>-&gt;</span> <span style=color:#ae81ff>#</span> <span style=color:#66d9ef>and</span> <span style=color:#66d9ef>then</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>file</span> <span style=color:#75715e>{ &#39;/etc/ssh/sshd_config&#39;:
</span></span></span><span style=display:flex><span><span style=color:#75715e>  ensure =&gt; file,
</span></span></span><span style=display:flex><span><span style=color:#75715e>  mode =&gt; &#39;0600&#39;,
</span></span></span><span style=display:flex><span><span style=color:#75715e>  source =&gt; &#39;puppet:///modules/sshd/sshd_config&#39;,
</span></span></span><span style=display:flex><span><span style=color:#75715e>}</span> <span style=color:#960050;background-color:#1e0010>~</span><span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>#</span> <span style=color:#66d9ef>and</span> <span style=color:#66d9ef>then</span>, <span style=color:#66d9ef>if</span> the previous <span style=color:#66d9ef>file</span> was updated<span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>service <span style=color:#75715e>{ &#39;sshd&#39;:
</span></span></span><span style=display:flex><span><span style=color:#75715e>  ensure =&gt; running,
</span></span></span><span style=display:flex><span><span style=color:#75715e>  enable =&gt; true,
</span></span></span><span style=display:flex><span><span style=color:#75715e>}</span></span></span></code></pre></div><p>This manifest will ensure the <code>openssh-server</code> package is installed first. Then, once it is installed, it will place the desired configuration file on the system. The first arrow with a simple hyphen creates a before/require relationship. Then, if that file is modified in any way, the second arrow, using a tilde <code>~</code> character, will enforce a notify/subscribe relationship and cause the <code>sshd</code> service to refresh.</p><p>As you work on your Puppet Manifest files for Lab 2, it is helpful to keep in mind that some resources may need to be chained together to work properly. However, do not try to chain together your entire manifest file, as that defeats much of the flexibility of Puppet itself.</p><footer class=footline></footer></article></div></main></div><script src=/cis527/js/clipboard/clipboard.min.js?1755629944 defer></script><script src=/cis527/js/perfect-scrollbar/perfect-scrollbar.min.js?1755629944 defer></script><script src=/cis527/js/theme.min.js?1755629944 defer></script><script src=/cis527/js/embed-iframe.min.js?1755629944 defer></script></body></html>