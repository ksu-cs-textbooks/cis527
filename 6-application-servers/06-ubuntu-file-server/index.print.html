<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content="YouTube Video Resources File Server from Ubuntu Documentation Samba Server Guide from Ubuntu Community Help Wiki How to Set Up a Samba Share for a Small Organization on Ubuntu 16.04 from DigitalOcean (works for 20.04) Access User’s Home Folders via Samba on Ubuntu 17.04 from Website for Students (works for 20.04) Mount Windows Shares Permanently from Ubuntu Wiki How Do I Access Windows Shares from Bash on Ask Ubuntu Forums Use of pam-mount to Mount Home from Server on Ubuntu Forums Video Transcript In this video, I’ll walk you through the steps to set up a file server on Ubuntu using Samba."><meta name=author content="Russell Feldhausen"><meta name=twitter:card content="summary"><meta name=twitter:title content="Ubuntu File Server :: CIS 527 Textbook"><meta name=twitter:description content="YouTube Video Resources File Server from Ubuntu Documentation Samba Server Guide from Ubuntu Community Help Wiki How to Set Up a Samba Share for a Small Organization on Ubuntu 16.04 from DigitalOcean (works for 20.04) Access User’s Home Folders via Samba on Ubuntu 17.04 from Website for Students (works for 20.04) Mount Windows Shares Permanently from Ubuntu Wiki How Do I Access Windows Shares from Bash on Ask Ubuntu Forums Use of pam-mount to Mount Home from Server on Ubuntu Forums Video Transcript In this video, I’ll walk you through the steps to set up a file server on Ubuntu using Samba."><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis527/6-application-servers/06-ubuntu-file-server/"><meta property="og:site_name" content="CIS 527 Textbook"><meta property="og:title" content="Ubuntu File Server :: CIS 527 Textbook"><meta property="og:description" content="YouTube Video Resources File Server from Ubuntu Documentation Samba Server Guide from Ubuntu Community Help Wiki How to Set Up a Samba Share for a Small Organization on Ubuntu 16.04 from DigitalOcean (works for 20.04) Access User’s Home Folders via Samba on Ubuntu 17.04 from Website for Students (works for 20.04) Mount Windows Shares Permanently from Ubuntu Wiki How Do I Access Windows Shares from Bash on Ask Ubuntu Forums Use of pam-mount to Mount Home from Server on Ubuntu Forums Video Transcript In this video, I’ll walk you through the steps to set up a file server on Ubuntu using Samba."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="Application Servers"><meta property="article:modified_time" content="2020-05-12T15:13:48-05:00"><meta itemprop=name content="Ubuntu File Server :: CIS 527 Textbook"><meta itemprop=description content="YouTube Video Resources File Server from Ubuntu Documentation Samba Server Guide from Ubuntu Community Help Wiki How to Set Up a Samba Share for a Small Organization on Ubuntu 16.04 from DigitalOcean (works for 20.04) Access User’s Home Folders via Samba on Ubuntu 17.04 from Website for Students (works for 20.04) Mount Windows Shares Permanently from Ubuntu Wiki How Do I Access Windows Shares from Bash on Ask Ubuntu Forums Use of pam-mount to Mount Home from Server on Ubuntu Forums Video Transcript In this video, I’ll walk you through the steps to set up a file server on Ubuntu using Samba."><meta itemprop=dateModified content="2020-05-12T15:13:48-05:00"><meta itemprop=wordCount content="1643"><title>Ubuntu File Server :: CIS 527 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis527/6-application-servers/06-ubuntu-file-server/ rel=canonical type=text/html title="Ubuntu File Server :: CIS 527 Textbook"><link href=/cis527/6-application-servers/06-ubuntu-file-server/index.xml rel=alternate type=application/rss+xml title="Ubuntu File Server :: CIS 527 Textbook"><link href=/cis527/6-application-servers/06-ubuntu-file-server/tele.html rel=alternate type=text/html title="Ubuntu File Server :: CIS 527 Textbook"><link href=/cis527/6-application-servers/06-ubuntu-file-server/embed.html rel=alternate type=text/html title="Ubuntu File Server :: CIS 527 Textbook"><link href=/cis527/css/fontawesome-all.min.css?1725979268 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis527/css/fontawesome-all.min.css?1725979268 rel=stylesheet></noscript><link href=/cis527/css/nucleus.css?1725979268 rel=stylesheet><link href=/cis527/css/auto-complete.css?1725979268 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis527/css/auto-complete.css?1725979268 rel=stylesheet></noscript><link href=/cis527/css/perfect-scrollbar.min.css?1725979268 rel=stylesheet><link href=/cis527/css/fonts.css?1725979268 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis527/css/fonts.css?1725979268 rel=stylesheet></noscript><link href=/cis527/css/theme.css?1725979268 rel=stylesheet><link href=/cis527/css/theme-auto.css?1725979268 rel=stylesheet id=R-variant-style><link href=/cis527/css/chroma-auto.css?1725979268 rel=stylesheet id=R-variant-chroma-style><link href=/cis527/css/variant.css?1725979268 rel=stylesheet><link href=/cis527/css/print.css?1725979268 rel=stylesheet media=print><link href=/cis527/css/format-print.css?1725979268 rel=stylesheet><script src=/cis527/js/variant.js?1725979268></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis527",window.index_js_url="/cis527/index.search.js",window.variants&&variants.init(["auto","light-theme","dark-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis527/css/custom.css?1725979268 rel=stylesheet></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/cis527/6-application-servers/06-ubuntu-file-server/><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/cis527/6-application-servers/><span itemprop=name>Application Servers</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Ubuntu File Server</span><meta itemprop=position content="2"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis527/6-application-servers/05-windows-file-server/ title="Windows File Server (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis527/6-application-servers/07-web-servers-overview/ title="Web Servers Overview (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=ubuntu-file-server>Ubuntu File Server</h1><a href="https://www.youtube.com/watch?v=xgqUcsNId20">YouTube Video</a><h4 id=resources>Resources</h4><ul><li><a href=https://ubuntu.com/server/docs/samba-file-server rel=external target=_blank>File Server</a> from Ubuntu Documentation</li><li><a href=https://help.ubuntu.com/community/Samba/SambaServerGuide rel=external target=_blank>Samba Server Guide</a> from Ubuntu Community Help Wiki</li><li><a href=https://www.digitalocean.com/community/tutorials/how-to-set-up-a-samba-share-for-a-small-organization-on-ubuntu-16-04 rel=external target=_blank>How to Set Up a Samba Share for a Small Organization on Ubuntu 16.04</a> from DigitalOcean (works for 20.04)</li><li><a href=https://websiteforstudents.com/access-user-home-folders-via-samba-on-ubuntu-17-04-17-10/ rel=external target=_blank>Access User&rsquo;s Home Folders via Samba on Ubuntu 17.04</a> from Website for Students (works for 20.04)</li><li><a href=https://wiki.ubuntu.com/MountWindowsSharesPermanently rel=external target=_blank>Mount Windows Shares Permanently</a> from Ubuntu Wiki</li><li><a href=https://askubuntu.com/questions/434358/how-do-i-access-windows-shares-from-bash rel=external target=_blank>How Do I Access Windows Shares from Bash</a> on Ask Ubuntu Forums</li><li><a href="https://ubuntuforums.org/showthread.php?t=1375653" rel=external target=_blank>Use of pam-mount to Mount Home from Server</a> on Ubuntu Forums</li></ul><h4 id=video-transcript>Video Transcript</h4><p>In this video, I&rsquo;ll walk you through the steps to set up a file server on Ubuntu using Samba. You&rsquo;ll learn how to share a particular folder, and I&rsquo;ll discuss what it takes to share the home folders for each user as well. Finally, I&rsquo;ll show you a bit of the process for making those shared folders available to your users on an Ubuntu client.</p><p>As before, I&rsquo;ll continue to use the VMs from Lab 4 for this example. Let&rsquo;s start on the server VM. First, if you haven&rsquo;t already, you&rsquo;ll need to install the Samba server:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt update
</span></span><span class=line><span class=cl>sudo apt install samba</span></span></code></pre></div><p>Next, I&rsquo;ll need to create a folder to share, as well as a file in that folder just so it isn&rsquo;t empty:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo mkdir /shared
</span></span><span class=line><span class=cl>sudo touch /shared/file.txt</span></span></code></pre></div><p>Finally, since that folder should be accessible to everyone, I&rsquo;ll set the permissions on that folder accordingly:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo chmod -R <span class=m>777</span> /shared</span></span></code></pre></div><p>Now that I have created my folder, I can work with Samba to share it with users on the network. There are a couple of different ways to accomplish this task. First, just like in Windows, you can right-click on the folder in Nautilus and access the sharing options there. For many users, this is the quickest and easiest way to share a folder on the network. However, for this example I&rsquo;ll show you how to share the folder directly in the Samba configuration file, which will give you a bit more control over the configuration.</p><p>So, let&rsquo;s open the Samba configuration file in Nano:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nano /etc/samba/smb.conf</span></span></code></pre></div><p>As you scroll through that file, you&rsquo;ll see that there are many different settings that you can customize on your Samba server. Pay special attention to the section for sharing user home directories, as that will be very useful as you complete the lab assignment later.</p><p>To add a new share, I&rsquo;m going to add a few lines at the bottom of the file:</p><div class=highlight><pre tabindex=0><code class=language-conf data-lang=conf>[shared]
  comment = Shared Files
  path = /shared
  browseable = yes
  guest ok = no
  read only = no
  create mask = 0755</code></pre></div><p>Once you&rsquo;ve made your edits, you should test your configuration file&rsquo;s syntax:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>testparm</span></span></code></pre></div><p>If everything looks as it should, then you can restart the Samba server to enable your new configuration:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart smbd</span></span></code></pre></div><p>At this point, you may also need to adjust your firewall configuration to allow other systems on the network to access these shared resources. For this example, I have disabled my firewall for simplicity, but you&rsquo;ll need to make sure it is configured properly to receive full credit on your lab assignment.</p><p>Finally, we need to add users to our Samba server so they can access the resource remotely. Samba maintains a separate database of users since it cannot directly decrypt the password hashes stored in <code>/etc/shadow</code>, so it takes an extra step to enable our existing users to access shared resources via Samba. It is possible to configure Samba to use OpenLDAP for authentication, but the process is quite complex. I chose to leave that out of this exercise, but in an enterprise setting you may choose to do so.</p><p>To create and enable the <code>cis527</code> user in Samba, you can use the following commands:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo smbpasswd -a cis527
</span></span><span class=line><span class=cl>sudo smbpasswd -e cis527</span></span></code></pre></div><p>The first command will ask you to enter a password for this user. This password can be different from the user&rsquo;s password on the system. However, I recommend setting this to be the same password that the user would use to login via LDAP or locally on their system. This will allow the system to automatically mount that user&rsquo;s home folder shared from Samba, as we&rsquo;ll see later in this video.</p><p>Now, let&rsquo;s switch over to our Ubuntu client and see how to access a shared folder. First, in Nautilus, you can click the <strong>Other Locations</strong> option on the left to see the available servers on the network. If network discovery is working properly, you may see your Ubuntu server listed there and be able to click on it.</p><p>If not, you can search for the server just like you would on Windows. At the bottom of Nautilus, there should be a <strong>Connect to Server</strong> box. In that box, you would enter <code>smb://</code> followed by the name or IP address of the system you&rsquo;d like to connect to. So, in my example network, I would enter <code>smb://192.168.40.41</code> to find my server.</p><p>Once you can see the shares on the server, you can double-click a shared folder to mount it on your system. It should pop up a window asking for a username and password. If your shared folder supports guest access, you can select the &ldquo;Anonymous&rdquo; option at the top to open the folder as a guest user. Otherwise, choose the &ldquo;Registered User&rdquo; option and enter your Samba username and password in the appropriate boxes. You can generally leave the Domain box alone unless you have a specific domain or workgroup configured on your Samba server.</p><p>Also, note that if you enter the incorrect username and/or password, you might get a strange error stating &ldquo;Failed to mount Windows share: File Exists.&rdquo; This error simply means that it was unable to access the shared resource, and most likely it is due to an authentication error. It isn&rsquo;t really a helpful error message, is it?</p><p>Once you&rsquo;ve connected to the shared folder, you should see a shortcut to that folder appear on your Ubuntu desktop. You can also access that folder via Terminal, but it is quite buried. The folder is typically mounted in <code>/run/user/&lt;UID>/gvfs/</code> where <code>&lt;UID></code> is the numerical user ID of your user on Ubuntu.</p><p>Thankfully, there are a few other ways to mount these shared folders on your system. First, using the Terminal, you&rsquo;ll need to install the <code>cifs-utils</code> package:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt update
</span></span><span class=line><span class=cl>sudo apt install cifs-utils</span></span></code></pre></div><p>Then, you can mount that shared folder to the location of your choosing. I recommend first creating an empty folder in <code>/mnt</code> to act as a mount point:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo mkdir /mnt/shared</span></span></code></pre></div><p>Then, you can use the <code>mount</code> command to mount the shared folder as a drive. For my example setup, I would use this command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo mount -t cifs -o <span class=nv>username</span><span class=o>=</span>cis527,dir_mode<span class=o>=</span>0777,file_mode<span class=o>=</span><span class=m>0777</span> //192.168.40.41/shared /mnt/shared</span></span></code></pre></div><p>Of course, you&rsquo;ll have to adjust the command to fit your setup. Now, I can access those shared files at <code>/mnt/shared</code> in Terminal as well.</p><p>Once I am finished, I can unmount that share using the Terminal as well:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo umount /mnt/shared</span></span></code></pre></div><p>To further automate this process, you can add an entry to the <code>/etc/fstab</code> file that gives the details for a shared folder that should be mounted automatically for each user on the system. You&rsquo;ll do just that for your lab assignment, so I won&rsquo;t cover the specific details here. As long as you are able to mount it using the commands above, it should be pretty straight-forward to adapt those settings to work in the <code>/etc/fstab</code> file.</p><p>Finally, you can also use <code>libpam-mount</code> to automatically mount drives on a per-user basis at login. This is especially useful if you want to automatically mount a user&rsquo;s home folder from a Samba server directly into their own home folder locally. To start, you&rsquo;ll need to install that library:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt update
</span></span><span class=line><span class=cl>sudo apt install libpam-mount</span></span></code></pre></div><p>Next, you can configure it by editing its configuration file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nano /etc/security/pam_mount.conf.xml</span></span></code></pre></div><p>As you look through that file, you&rsquo;ll see quite a few default options already in place. Unfortunately, since the file is in an XML format, it is a bit difficult to read. You&rsquo;ll need to make a couple of changes. First, look for the entry:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;debug</span> <span class=na>enable=</span><span class=s>&#34;0&#34;</span> <span class=nt>/&gt;</span></span></span></code></pre></div><p>and change it to</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;debug</span> <span class=na>enable=</span><span class=s>&#34;1&#34;</span> <span class=nt>/&gt;</span></span></span></code></pre></div><p>to enable debugging. By doing so, you&rsquo;ll be able to see output in <code>/var/log/syslog</code> if this process doesn&rsquo;t work, and hopefully you&rsquo;ll be able to diagnose the error using that information.</p><p>Next, look for the line:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=c>&lt;!-- Volume definitions --&gt;</span></span></span></code></pre></div><p>and, right below that line, you&rsquo;ll add a line to define the shared folder you&rsquo;d like to mount automatically. For my example setup, I would use the following definition:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;volume</span> <span class=na>fstype=</span><span class=s>&#34;cifs&#34;</span> <span class=na>server=</span><span class=s>&#34;192.168.40.41&#34;</span> <span class=na>path=</span><span class=s>&#34;homes&#34;</span> <span class=na>mountpoint=</span><span class=s>&#34;/home/%(USER)/server&#34;</span> <span class=nt>/&gt;</span></span></span></code></pre></div><p>You&rsquo;ll have to adjust the options in that line to match your particular environment. Once you&rsquo;ve added your information, save and close the file.</p><p>Next, we&rsquo;ll need to make sure that the system is configured to use that module. To do so, examine the <code>common-session</code> configuration file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /etc/pam.d/common-session</span></span></code></pre></div><p>and look for this line in that file:</p><div class=highlight><pre tabindex=0><code>session optional    pam_mount.so</code></pre></div><p>If it isn&rsquo;t there, you&rsquo;ll need to add that line to the bottom of that file.</p><p>That should do it! To test your configuration, simply log out and log in again. If it works, you should now be able to see that user&rsquo;s home folder from the Samba server in the <code>server</code> folder in the home directory. It should also create shortcut on the Ubuntu desktop as well.</p><p>If it doesn&rsquo;t work, you&rsquo;ll want to review any error messages in the system log, The easiest way to find them is to search the system log for <code>mount</code> using the following command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /var/log/syslog <span class=p>|</span> grep mount</span></span></code></pre></div><p>For the lab assignment, you&rsquo;ll perform these steps for your environment in much the same way. It can be very tricky to get this working the first time, so be very careful as you edit these configuration files. If you aren&rsquo;t able to get it working, please post in the course discussion forums on Canvas to get assistance.</p><footer class=footline></footer></article></div></main><div class=git-footer><p class=theme-version-footer>6.0.0</p><p>Last modified by:
<i class='fas fa-user'></i> Russell Feldhausen
<i class='fas fa-calendar'></i> <a href=https://github.com/ksu-cs-textbooks/cis527/commit/3f7de853b5559d023cd8f54500543d0abc272658>May 12, 2020</a></p></div></div><script src=/cis527/js/clipboard.min.js?1725979268 defer></script><script src=/cis527/js/perfect-scrollbar.min.js?1725979268 defer></script><script src=/cis527/js/theme.js?1725979268 defer></script></body></html>