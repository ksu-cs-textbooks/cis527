




	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.117.0">
    <meta name="generator" content="Relearn 5.18.0">
    <meta name="description" content="CIS 527 Textbook">
    <meta name="author" content="Russell Feldhausen">
    <title>Ubuntu LDAP Installation :: CIS 527 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cis527/4-directory-services/07-ubuntu-ldap-installation/index.html" rel="canonical" type="text/html" title="Ubuntu LDAP Installation :: CIS 527 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis527/4-directory-services/07-ubuntu-ldap-installation/index.xml" rel="alternate" type="application/rss+xml" title="Ubuntu LDAP Installation :: CIS 527 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis527/4-directory-services/07-ubuntu-ldap-installation/index.print.html" rel="alternate" type="text/html" title="Ubuntu LDAP Installation :: CIS 527 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis527/4-directory-services/07-ubuntu-ldap-installation/embed.html" rel="alternate" type="text/html" title="Ubuntu LDAP Installation :: CIS 527 Textbook">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/fontawesome-all.min.css?1693321932" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis527/css/fontawesome-all.min.css?1693321932" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/nucleus.css?1693321932" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/auto-complete.css?1693321932" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis527/css/auto-complete.css?1693321932" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/perfect-scrollbar.min.css?1693321932" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/fonts.css?1693321932" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis527/css/fonts.css?1693321932" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/theme.css?1693321932" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/theme-auto.css?1693321932" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/variant.css?1693321932" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/print.css?1693321932" rel="stylesheet" media="print">
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/ie.css?1693321932" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cis527/js/url.js?1693321932"></script>
    <script src="https://ksu-cs-textbooks.github.io/cis527/js/variant.js?1693321932"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="https://ksu-cs-textbooks.github.io/cis527/index.search.js";
      var root_url="https://ksu-cs-textbooks.github.io/cis527/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cis527/';
      window.variants && variants.init( [ 'auto', 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/custom.css?1693321932" rel="stylesheet">

  </head>
  <body class="mobile-support tele disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cis527/4-directory-services/07-ubuntu-ldap-installation/index.html">
    
    <div id="tele" class="tele mirror">
    
    <div id="body" class="default-animation">
      
      
      
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>
<h1 id="ubuntu-ldap-installation">Ubuntu LDAP Installation</h1>


<a href="https://www.youtube.com/watch?v=zIUDIiAMGrg">YouTube Video</a>

<!-- BFvknNpAAIM -->
<h4 id="resources">Resources</h4>
<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-openldap-and-phpldapadmin-on-ubuntu-16-04" target="_blank">How To Install and Configure OpenLDAP and phpLDAPadmin on Ubuntu 16.04</a>
 from DigitalOcean (works for 18.04 and 20.04 as well)</li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-a-basic-ldap-server-on-an-ubuntu-12-04-vps#add-organizational-units-groups-and-users" target="_blank">Add Organizational Units, Groups and Users</a>
 from DigitalOcean</li>
<li><a href="https://ubuntu.com/server/docs/service-ldap-with-tls" target="_blank">LDAP &amp; TLS</a>
 from the Ubuntu Server Guide</li>
<li><a href="https://www.youtube.com/watch?v=T4Df5_cojAs" target="_blank">How Does HTTPS Work</a>
 from kubucation on YouTube (a good overview of CAs and certificates)</li>
<li><strong><a href="https://ksu-cs-textbooks.github.io/cis527/3-core-networking-services/15-security/">Core Networking Services - Security</a>
</strong></li>
<li><strong><a href="https://ksu-cs-textbooks.github.io/cis527/5-the-cloud/06-certificates/">The Cloud - Certificates</a>
</strong></li>
</ul>
<h4 id="video-transcript">Video Transcript</h4>
<p>As we did earlier with setting up Active Directory on Windows, let&rsquo;s take a look at the steps required to install and configure OpenLDAP on Linux. The goal of this video isn&rsquo;t to show you all the steps of the process, but provide commentary on some of the more confusing steps you&rsquo;ll perform.</p>
<p>For this example, I&rsquo;m using the Ubuntu VM labelled Server from Lab 3. I have chosen to disable the DHCP server on this system, and instead have replaced it with the VMware DHCP server. In practice, that change should not affect any of this process. Also, I&rsquo;ll generally be following the guide from DigitalOcean, which is linked in the resources section below the video.</p>
<p>At this point, I have also already performed the first steps of the guide, which is to install the <code>slapd</code> and <code>ldap-utils</code> packages on this system. Now, I&rsquo;ll step through the configuration process for <code>slapd</code> and discuss the various options it presents.</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo dpkg-reconfigure slapd</span></span></code></pre></div><p>First, it will ask you if you want to omit the OpenLDAP server configuration. Make sure you select <code>&lt;No&gt;</code> for that option. You can use the arrow keys (<kbd>←</kbd> and <kbd>→</kbd>) to move the red-shaded selector to the option you&rsquo;d like to select, then press <kbd>ENTER</kbd> to confirm it.</p>
<p>Next, it will ask for your domain name. For this example, I&rsquo;ll just use <code>ldap.cis527russfeld.cs.ksu.edu</code>. You&rsquo;ll need to adjust these settings to match the required configuration for the lab assignment. This matches the DNS configuration I made in Lab 3, which is very important later on in this process.</p>
<p>Next, it will also ask for your organization name. I&rsquo;ll just use <code>cis527</code> here.</p>
<p>Then, it will ask for your Administrator password. This is the equivalent of the <code>root</code> account within the domain. It is able to change all domain settings, and therefore the password for this account should be very complex and well protected. For this example, I&rsquo;ll just use the same password we are using for everything else, but in practice you&rsquo;ll want to carefully consider this password.</p>
<p>The next option is whether you want to have the database removed if you purge the <code>slapd</code> package. Selecting <code>&lt;yes&gt;</code> on this option would delete your LDAP database if you ever chose to reinstall the <code>slapd</code> package. For most uses, you&rsquo;ll always want to select <code>&lt;no&gt;</code> here, which is what I&rsquo;ll do.</p>
<p>Since there are some existing configuration files in place, the installer asks if you&rsquo;d like those to be moved. Unless you are reinstalling <code>slapd</code> on an existing server, you can select <code>&lt;yes&gt;</code> for this option.</p>
<p>That should complete the configuration for the OpenLDAP server. For this example, I have disabled the firewall on this system, but for your lab assignment you&rsquo;ll need to do a bit of firewall configuration at this point.</p>
<hr>
<p>Next, I&rsquo;m going to configure <code>phpldapadmin</code> on this server. It is a useful web interface for managing your OpenLDAP server. We can install it using <code>apt</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt install phpldapadmin</span></span></code></pre></div><p>Once it has been installed, we&rsquo;ll just need to configure it by editing its configuration file.</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo nano /etc/phpldapadmin/config.php</span></span></code></pre></div><p>In that file, you&rsquo;ll need scroll down to around line 286 to find the configuration for your LDAP servers. You&rsquo;ll need to set the server name, host address, and login information. You can roughly follow the first guide from DigitalOcean linked below this video for these changes as well. For my system, I&rsquo;ll configure the following lines (you may need to uncomment some of them as well):</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span>$servers<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setValue</span>(<span style="color:#e6db74">&#39;server&#39;</span>, <span style="color:#e6db74">&#39;name&#39;</span>, <span style="color:#e6db74">&#39;CIS 527 LDAP&#39;</span>);
</span></span><span style="display:flex;"><span>$servers<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setValue</span>(<span style="color:#e6db74">&#39;server&#39;</span>, <span style="color:#e6db74">&#39;host&#39;</span>, <span style="color:#e6db74">&#39;127.0.0.1&#39;</span>);
</span></span><span style="display:flex;"><span>$servers<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setValue</span>(<span style="color:#e6db74">&#39;server&#39;</span>, <span style="color:#e6db74">&#39;base&#39;</span>, <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#39;dc=ldap,dc=cis527russfeld,dc=cs,dc=ksu,dc=edu&#39;</span>));
</span></span><span style="display:flex;"><span>$servers<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setValue</span>(<span style="color:#e6db74">&#39;login&#39;</span>, <span style="color:#e6db74">&#39;bind_id&#39;</span>, <span style="color:#e6db74">&#39;cn=admin,dc=ldap,dc=cis527russfeld,dc=cs,dc=ksu,dc=edu&#39;</span>);</span></span></code></pre></div><p>At last, you can load the website by navigating to <code>http://localhost/phpldapadmin</code> in your web browser.</p>
<hr>
<p>Once we&rsquo;ve loaded the interface, we&rsquo;ll need to add a few items to make this server fully useable. The second guide linked below this video gives the steps for adding some organizational units, groups, and users to the server. I&rsquo;ve already performed the steps to add the <code>users</code> and <code>groups</code> organizational units, as well as the <code>admin</code> group. For this video, I am going to discuss a few issues related to creating LDAP users.</p>
<p>To begin, I&rsquo;ll click on the &ldquo;ou=users&rdquo; link on the left, then the &ldquo;Create a child entry&rdquo; link on the right. I&rsquo;ll choose the &ldquo;Generic: User Account&rdquo; template next. On this page, I&rsquo;ll enter the information for my user account. Note that the &ldquo;Common Name&rdquo; field must be unique, so it is a good idea to input the user&rsquo;s username here, instead of the default of their first and last name. I&rsquo;ll leave the home directory as the default, choose the &ldquo;admin&rdquo; group, and the Bash login shell. Finally, I&rsquo;ll enter a password, and click the &ldquo;Create Object&rdquo; button to create it. Once it is created, I&rsquo;ll edit the UID number to be 10000 instead of 1000. This is very important, because by default accounts on Ubuntu start at UID 1000, so this could create a UID conflict.</p>
<hr>
<p>Finally, let&rsquo;s add some encryption to this server to protect the information shared across the network. This step was not required in previous versions of this lab, but it has always been a good idea. Now that Ubuntu uses SSSD, or System Security Services Daemon, for authentication, it requires us to provide TLS encryption on our LDAP server. So, let&rsquo;s do that now.</p>
<p>For these steps, we&rsquo;ll be closely following the Ubuntu Server Guide linked below this video. We&rsquo;ll be adjusting a few of the items to match our configuration, but most of the commands are exactly the same.</p>
<p>First, we&rsquo;ll need to install a couple of packages to allow us to create and manipulate security certificates</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt update
</span></span><span style="display:flex;"><span>sudo apt install gnutls-bin ssl-cert</span></span></code></pre></div><p>Next, we need to create our own certificate authority, or CA. In a production system, you would instead work with an actual CA to obtain a security certificate from them, but that can be time consuming and expensive. So, for this example, we&rsquo;ll just create our own. Also, contrary to what your browser may lead you to believe, using your own CA certificates will result in an encrypted connection, it just may not be &ldquo;trusted&rdquo; since your browser doesn&rsquo;t recognize the CA certificate.</p>
<p>If you want to know more about CAs and certificates, check out the handy YouTube video I&rsquo;ve linked below this video. It gives a great description of how certificates work in much more detail. I&rsquo;ve also included links to the lectures in Module 3 and Module 5 that deal with TLS certificates.</p>
<p>So, we&rsquo;ll first create a private key for our CA:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo certtool --generate-privkey --bits <span style="color:#ae81ff">4096</span> --outfile /etc/ssl/private/mycakey.pem</span></span></code></pre></div><p>Then, we&rsquo;ll create a template file that contains the options we need for creating this certificate. Notice here that I&rsquo;ve modified this information from what is provided in the Ubuntu Server Guide document to match our setup:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo nano /etc/ssl/ca.info</span></span></code></pre></div><p>and put the following text into that file.</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tex" data-lang="tex"><span style="display:flex;"><span>cn = CIS 527
</span></span><span style="display:flex;"><span>ca
</span></span><span style="display:flex;"><span>cert_signing_key
</span></span><span style="display:flex;"><span>expiration_days = 3650</span></span></code></pre></div><p>Then, we can use that template to create our self-signed certificate authority certificate:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo certtool --generate-self-signed --load-privkey /etc/ssl/private/mycakey.pem --template /etc/ssl/ca.info --outfile /usr/local/share/ca-certificates/mycacert.crt</span></span></code></pre></div><p>This will create a certificate called <code>mycacert.crt</code> that is stored in <code>/usr/local/share/ca-certificates/</code>. <strong>This is our self-signed CA certificate</strong>. So, whenever we want any system to trust one of our self-signed certificates that we make from our CA, we&rsquo;ll need to make sure that system has a copy of this CA certificate in its list of trusted certificates.</p>
<p>To do that, we simply place the certificate in <code>/usr/local/share/ca-certificates/</code>, and then run the following command to add it to the list of trusted certificates:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo update-ca-certificates</span></span></code></pre></div><p>If that command works correctly, it should tell us that it has added 1 certificate to our list.</p>
<p>Before we move on, let&rsquo;s make a copy of our <code>mycacert.crt</code> file in our <code>cis527</code> users&rsquo;s home directory. We&rsquo;ll use this file in the next part of this lab when we are configuring our client system to authenticate using LDAP.</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cp /usr/local/share/ca-certificates/mycacert.crt ~/</span></span></code></pre></div><p>Now that we&rsquo;ve created our own self-signed CA, we can use it to create a certificate for our LDAP server. So, we&rsquo;ll start by creating yet another private key:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo certtool --generate-privkey --bits <span style="color:#ae81ff">2048</span> --outfile /etc/ldap/ldap01_slapd_key.pem</span></span></code></pre></div><p>Then, we&rsquo;ll create another template file to give the information about the certificate that we&rsquo;d like to create:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo nano /etc/ssl/ldap01.info</span></span></code></pre></div><p>and place the following tex in that file:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tex" data-lang="tex"><span style="display:flex;"><span>organization = CIS 527
</span></span><span style="display:flex;"><span>cn = ldap.cis527russfeld.cs.ksu.edu
</span></span><span style="display:flex;"><span>tls_www_server
</span></span><span style="display:flex;"><span>encryption_key
</span></span><span style="display:flex;"><span>signing_key
</span></span><span style="display:flex;"><span>expiration_days = 365</span></span></code></pre></div><p>Notice that in that file, we entered the fully qualified domain name for our LDAP server on the second line. This is the most important part that makes all of this work. On our client machine, we must have a DNS entry that links this domain name to our LDAP server&rsquo;s IP address, and then the certificate the server uses must match that domain name. So, if we don&rsquo;t get this step right, the whole system may not work correctly until we fix it!</p>
<p>Finally, we can use this long and complex command to create and sign our server&rsquo;s certificate:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo certtool --generate-certificate --load-privkey /etc/ldap/ldap01_slapd_key.pem --load-ca-certificate /etc/ssl/certs/mycacert.pem --load-ca-privkey /etc/ssl/private/mycakey.pem --template /etc/ssl/ldap01.info --outfile /etc/ldap/ldap01_slapd_cert.pem</span></span></code></pre></div><p>Once the certificate has been created, we just need to do a couple of tweaks so that it has the correct permissions. This will allow the LDAP server to properly access the file:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo chgrp openldap /etc/ldap/ldap01_slapd_key.pem
</span></span><span style="display:flex;"><span>sudo chmod <span style="color:#ae81ff">0640</span> /etc/ldap/ldap01_slapd_key.pem</span></span></code></pre></div><p>Finally, at long last, we are ready to tell our LDAP server to use the certificate. To do that, we&rsquo;ll create an LDIF file:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nano ~/certinfo.ldif</span></span></code></pre></div><p>and in that file we&rsquo;ll put the information about our certificate:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tex" data-lang="tex"><span style="display:flex;"><span>dn: cn=config
</span></span><span style="display:flex;"><span>add: olcTLSCACertificateFile
</span></span><span style="display:flex;"><span>olcTLSCACertificateFile: /etc/ssl/certs/mycacert.pem
</span></span><span style="display:flex;"><span>-
</span></span><span style="display:flex;"><span>add: olcTLSCertificateFile
</span></span><span style="display:flex;"><span>olcTLSCertificateFile: /etc/ldap/ldap01_slapd_cert.pem
</span></span><span style="display:flex;"><span>-
</span></span><span style="display:flex;"><span>add: olcTLSCertificateKeyFile
</span></span><span style="display:flex;"><span>olcTLSCertificateKeyFile: /etc/ldap/ldap01_slapd_key.pem</span></span></code></pre></div><p>Once that file is created, we can use the <code>ldapmodify</code> tool to import it into our server:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo ldapmodify -Y EXTERNAL -H ldapi:/// -f certinfo.ldif</span></span></code></pre></div><p>Whew! That was a lot of work! Now, if we did everything correctly, we should be able to query this LDAP server using TLS. The best way to check that is by using the following command:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ldapwhoami -x -ZZ -h ldap.cis527russfeld.cs.ksu.edu</span></span></code></pre></div><p>The <code>-ZZ</code> part of that command tells it to use TLS, and if it works correctly it should return <code>anonymous</code> as the result. If this step fails, then you may need to do some troubleshooting to see what the problem is.</p>
<p>That should do it! In the next video, I&rsquo;ll show how to configure another Ubuntu VM to use this LDAP server for authentication.</p>

            <footer class="footline">

            </footer>
          </article>
        </div>
      </main>
    </div>
    
    </div>
    
    
    
    
    <script src="https://ksu-cs-textbooks.github.io/cis527/js/clipboard.min.js?1693321933" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis527/js/perfect-scrollbar.min.js?1693321933" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis527/js/theme.js?1693321933" defer></script>
    
    <script src="https://ksu-cs-textbooks.github.io/cis527/js/tele-scroll.js?1693321933 defer"></script>
    
  </body>
</html>
