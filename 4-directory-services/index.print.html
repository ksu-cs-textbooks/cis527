<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content="Consistent usernames across devices."><meta name=author content="Russell Feldhausen"><meta name=twitter:card content="summary"><meta name=twitter:title content="Directory Services :: CIS 527 Textbook"><meta name=twitter:description content="Consistent usernames across devices."><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis527/4-directory-services/"><meta property="og:site_name" content="CIS 527 Textbook"><meta property="og:title" content="Directory Services :: CIS 527 Textbook"><meta property="og:description" content="Consistent usernames across devices."><meta property="og:locale" content="en-us"><meta property="og:type" content="website"><meta itemprop=name content="Directory Services :: CIS 527 Textbook"><meta itemprop=description content="Consistent usernames across devices."><meta itemprop=datePublished content="2018-08-24T10:53:05-05:00"><meta itemprop=dateModified content="2023-08-10T17:06:42-05:00"><meta itemprop=wordCount content="4"><title>Directory Services :: CIS 527 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis527/4-directory-services/ rel=canonical type=text/html title="Directory Services :: CIS 527 Textbook"><link href=/cis527/4-directory-services/index.xml rel=alternate type=application/rss+xml title="Directory Services :: CIS 527 Textbook"><link href=/cis527/4-directory-services/tele.html rel=alternate type=text/html title="Directory Services :: CIS 527 Textbook"><link href=/cis527/4-directory-services/embed.html rel=alternate type=text/html title="Directory Services :: CIS 527 Textbook"><link href=/cis527/css/fontawesome-all.min.css?1727902057 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis527/css/fontawesome-all.min.css?1727902057 rel=stylesheet></noscript><link href=/cis527/css/nucleus.css?1727902057 rel=stylesheet><link href=/cis527/css/auto-complete.css?1727902057 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis527/css/auto-complete.css?1727902057 rel=stylesheet></noscript><link href=/cis527/css/perfect-scrollbar.min.css?1727902057 rel=stylesheet><link href=/cis527/css/fonts.css?1727902057 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis527/css/fonts.css?1727902057 rel=stylesheet></noscript><link href=/cis527/css/theme.css?1727902057 rel=stylesheet><link href=/cis527/css/theme-auto.css?1727902057 rel=stylesheet id=R-variant-style><link href=/cis527/css/chroma-auto.css?1727902057 rel=stylesheet id=R-variant-chroma-style><link href=/cis527/css/variant.css?1727902057 rel=stylesheet><link href=/cis527/css/print.css?1727902057 rel=stylesheet media=print><link href=/cis527/css/format-print.css?1727902057 rel=stylesheet><script src=/cis527/js/variant.js?1727902057></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="..",window.relearn.relBaseUri="../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis527",window.index_js_url="/cis527/index.search.js",window.variants&&variants.init(["auto","light-theme","dark-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis527/css/custom.css?1727902057 rel=stylesheet></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/cis527/4-directory-services/><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Directory Services</span><meta itemprop=position content="1"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis527/3-core-networking-services/19-lab3-networking/ title="Lab 3 Networking Diagrams (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis527/4-directory-services/01-introduction/ title="Introduction (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable chapter narrow" tabindex=-1><div class=flex-block-wrapper><article class=chapter><header class=headline></header><div class=article-subheading>Chapter 4</div><h1 id=directory-services>Directory Services</h1><p>Consistent usernames across devices.</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Directory Services</h1><article class=default><header class=headline></header><h1 id=introduction>Introduction</h1><a href="https://www.youtube.com/watch?v=rafsbXXkuTQ">YouTube Video</a><h4 id=resources>Resources</h4><ul><li><strong><a href=/cis527/4-directory-services/01-introduction-slides/>Slides</a></strong></li></ul><h4 id=video-transcript>Video Transcript</h4><p>Welcome to Module 4! In this module, we&rsquo;ll discuss how to use directory services to provide consistent user accounts and permissions across a number of systems. Specifically, we&rsquo;ll look at the Active Directory Domain Services for Windows, and the OpenLDAP implementation of the Lightweight Directory Access Protocol (LDAP) for Ubuntu Linux.</p><p>In addition, we&rsquo;ll see how to configure clients to connect to each of those servers. Finally, I&rsquo;ll discuss some implementation concerns for interoperability, for instances where you&rsquo;ll have a heterogeneous network environment.</p><p>Many students have reported to me that this is one of the most difficult lab assignments in this course, as it can be very frustrating to get everything set up and working correctly the first time. As always, if you have any questions or run into issues, please post in the course discussion forums to get help. Good luck!</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=directory-services-overview>Directory Services Overview</h1><a href="https://www.youtube.com/watch?v=1p4Q_82Pb-I">YouTube Video</a><h4 id=resources>Resources</h4><ul><li><strong><a href=/cis527/4-directory-services/02-directory-services-overview-slides/>Slides</a></strong></li><li><a href=https://en.wikipedia.org/wiki/Active_Directory rel=external target=_blank>Active Directory</a> on Wikipedia</li><li><a href=https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol rel=external target=_blank>Lightweight Directory Access Protocol (LDAP)</a> on Wikipedia</li><li><a href=https://en.wikipedia.org/wiki/Samba_(software) rel=external target=_blank>Samba (Software)</a> on Wikipedia</li><li><a href=https://en.wikipedia.org/wiki/NetIQ_eDirectory rel=external target=_blank>NetIQ eDirectory</a> on Wikipedia (previously Novell Directory Services)<ul><li><a href=http://support.novell.com/techcenter/articles/dnd19970304.html rel=external target=_blank>Overview of Novell Directory Services</a> from Novell</li></ul></li><li><a href=https://en.wikipedia.org/wiki/Kerberos_(protocol) rel=external target=_blank>Kerberos (Protocol)</a> on Wikipedia<ul><li><a href=https://tools.ietf.org/html/rfc1510 rel=external target=_blank>RFC 1510 - Kerberos</a> from IETF</li></ul></li><li><a href=https://directory.apache.org/apacheds/basic-ug/1.2-some-background.html rel=external target=_blank>Directories, Directory Services, and LDAP</a> from Apache</li><li><a href=http://etutorials.org/Microsoft+Products/microsoft+windows+xp+professional+training+kit/Chapter+1+-+Introduction+to+Windows+XP+Professional/Lesson+3nbspUnderstanding+Workgroups+and+Domains/ rel=external target=_blank>Understanding Workgroups and Domains</a> from eTutorials.org</li></ul><h4 id=video-transcript>Video Transcript</h4><p>This video presents a brief overview of directory services and related concepts. This information is very helpful in understanding the larger role that many of these services play in modern computer networks.</p><p>At its core, a directory service is simply a piece of software that can store and retrieve information. The information stored could take many forms, including user accounts, groups, system information, resources, security settings, and more. By providing a centralized location to store that information, it becomes much simpler to share that information across a large enterprise network.</p><p>We&rsquo;ve already worked with one example of a directory service in this course. The modern Domain Name Service is, at its core, a directory service. It stores a directory of domain names matched to IP addresses, as well as additional information about a domain such as the location of the mail server. It can then provide that information to the systems on a large network, providing a level of consistency that is difficult to achieve if each computer has to store a local version of the same information.</p><p>Directory services for computers have also been around for quite a while. This page gives a brief timeline of events, starting in the late 1980s and culminating with the release of Microsoft&rsquo;s Active Directory Domain Services in 1999. Let&rsquo;s look at each of these items in detail.</p><p>First, the X.500 set of standards was released in 1988, and was one of the first projects that aimed to provide a consistent directory of user account information. It was actually developed as a directory for the X.400 set of standards for email, which at that time was the dominant way that email was handled on the internet. Those standards were developed using the OSI networking protocols. However, with the rise of the TCP/IP set of internet protocols, these systems were quickly made obsolete. X.400 was replaced by the SMTP standards used today to send email between MTAs, while X.500 forms the basis of many later protocols. What is most notable about X.500 is that it actually defined several underlying protocols, including a Directory Access Protocol (DAP), as well as a Directory System Protocol (DSP) and others. Today, we primarily use protocols based on the original DAP defined by X.500.</p><p>Soon after the release of the X.500 standards, work began on an implementation of the DAP protocol using the TCP/IP internet protocols. It was eventually named the Lightweight Directory Access Protocol, or LDAP. LDAP is the underlying protocol used by many of todays directory services, including Microsoft Active Directory.</p><p>However, it is very important to understand that LDAP is not a complete implementation of the original X.500 DAP. Instead, it implements a core set of features, and then adds some additional features not present in the original protocol, while several parts of the original protocol are not implemented. The maintainers of the X.500 standard are very quick to point out this difference, but in practice most systems fully support LDAP as it stands today.</p><p>LDAP also has uses beyond just a directory service for user accounts on workstations. For example, LDAP can be used to provide a user lookup service to an email client, or it can be linked with a website to provide user authentication from a central repository of users.</p><p>LDAP, along with many other directory services, defines a tree structure for the data. In this way, the data can be organized in a hierarchical manner, closely resembling the real relationships between people, departments, and organizations in an enterprise. For example, in this diagram, you can clearly see nodes in the tree for the overarching organization, the organizational unit, and the individual user.</p><p>LDAP uses several short abbreviations for different fields and types of data, and at times they can be a bit confusing to new system administrators. This slide lists a few of the most common ones, as well as a good way to remember them. For example, an <code>ou</code> in LDAP is an organizational unit, which could be a department, office, or some other collection of users and systems.</p><p>You can see these abbreviations clearly in this sample LDAP entry. Here, we can see the distinguished name includes the canonical name, as well as the domain components identifying its location in the tree. We can also see the common name and surname for this user, as well as the distinguished name for his supervisor. As you work with LDAP throughout this module, you&rsquo;ll see data presented in this format several times.</p><p>Switching gears a bit, in the early 1990s, there were many different software programs developed to help share files and users between systems. One of the first was Samba. Samba is an open source project that originally reverse engineered the SMB (hence the name) and CIFS file sharing protocols used by Windows. By doing so, they were able to enable file sharing between Linux based systems, including Macs, and Windows. Eventually, Microsoft worked with the developers of the project to allow them to fully implement the protocol, and in more recent versions, a computer running Samba can even act as part of an Active Directory domain. We&rsquo;ll work with Samba a bit later this semester when we deal with application servers.</p><p>Around the same time, Novell released their Directory Services software. This was one of the first directory services targeted at large organizations, and for many years it was the dominant software in that area. It was built on top of the IPX/SPX internet protocols, so it required computers to run special software in order to use the directory service.</p><p>Much like the LDAP example earlier, NDS also supported a tree structure for storing information in the directory. It also had some novel features for assigning permissions across different users and <code>ou</code>s, which made it a very powerful tool. Many older system administrators have probably worked with Novell in the past. I remember that both my high school, as well as some departments at K-State, used NDS until they switched to Microsoft Active Directory in the mid 2000s.</p><p>Before we discuss Active Directory, we should first discuss Windows Workgroups and Homegroups. Most home networks don&rsquo;t need a full directory service, but it is very helpful to have a way to share files easily between a few computers connected to the same network. Prior to Windows 7, Windows used a &ldquo;Workgroup&rdquo; to share these files.</p><p>Computers with the same Workgroup name would be able to discover each other across a local network, and any shared files or resources would be available. However, user accounts were not shared, so you wanted to access a resource shared from a particular computer, you&rsquo;d have to know a username and password for that system as well. For smaller networks, this usually wasn&rsquo;t a problem at all. However, as the network grows larger, it becomes more and more difficult to maintain consistent user accounts across all systems.</p><p>That all changed in 1999 with the introduction of Microsoft Active Directory. It coincided with the release of Windows 2000, one of the first major Windows releases directly targeted at large enterprises. Active Directory uses LDAP and Kerberos to handle authentication, and provides not only a central repository of user accounts and systems, but it can also be used to share security configurations across those systems as well. It was really ideal for large enterprise networks, and gave administrators the level of control they desired. Active Directory quickly became the dominant directory service, and most enterprises today use Active Directory to manage user accounts for their Windows systems. In fact, both K-State and K-State Computer Science primarily use Active Directory to manage their user accounts across a variety of systems and platforms.</p><p>With a shared domain, the user account information is stored on the central domain controller, instead of the individual workstations. In this way, any user who has a valid account on the domain and permissions to access a resource can do so, regardless of which system they are connected to. This is what allows you to use the same user account to log on to computers across campus, as well as online resources such as webmail and Canvas. One of the major activities in this lab will be to install and configure an Active Directory Domain, so you can get first-hand experience of how this works.</p><p>Lastly, no discussion of directory services would be complete without discussing Kerberos. Kerberos is named after Cerberus, the three-headed dog from ancient Greek mythology. It allows a client and a server to mutually authenticate each other&rsquo;s identity through a third party, hence the three-headed mascot.</p><p>Kerberos was originally developed at MIT in the 1980s, and fully released in 1993 as RFC 1510. It is one of the primary ways that directory services today handle authentication, and it is used by many other types of security software on the internet today.</p><p>The Kerberos protocol is quite complex, and it uses many different cryptographic primitives to ensure the communication is properly secured and authenticated. However, this diagram gives a quick overview of the protocol and how it works.</p><ol><li>First, the client will communicate with the authentication server.</li><li>The server responds with two messages, labelled A and B in this diagram. Message A is encrypted by the server using the client&rsquo;s key. When the client receives that message, it attempts to decrypt it. If it is successful, it can use the contents inside the message to prove its identity.</li><li>Then, it can send two new messages, C and D, to the ticket granting server, which in practice is usually the authentication server, but it doesn&rsquo;t have to be. Message C includes the contents of message B along with information about what the client would like to access, and message D is the decrypted contents of the original message A. The ticket granting server then looks at those messages and confirms the user&rsquo;s identity.</li><li>If it is correct, it will then send two more messages, E and F, to the client. Message E is the ticket that can be given to the server containing the desired resource, and message F contains a key that can be used to communicate with that server.</li><li>So, the client finally can contact the destination server, sending along message E, the ticket from earlier, as well as a new message G that is protected with the key contained in message F.</li><li>Finally, the server decrypts message G and uses it to create and send back message H, which can be confirmed by the client to make sure the server is using the same key.</li></ol><p>If everything works correctly, both the client and server know they can trust each other, and they have established keys that allow them to communicate privately and share the requested information. Kerberos is a very powerful protocol, and if you&rsquo;d like to learn more, I highly recommend reading the linked resources below this video. Kerberos is also discussed in several of the cybersecurity courses here at K-State.</p><p>That&rsquo;s all the background information you&rsquo;ll need for this module. Next, you&rsquo;ll work on installing Microsoft Active Directory on Windows and OpenLDAP on Ubuntu, as well as configuring clients to use those systems for authentication.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=assignment>Assignment</h1><h3 id=lab-4---directory-services>Lab 4 - Directory Services</h3><h4 id=instructions>Instructions</h4><p>Create <strong>four</strong> virtual machines meeting the specifications given below. The best way to accomplish this is to treat this assignment like a checklist and check things off as you complete them.</p><p>If you have any questions about these items or are unsure what they mean, please contact the instructor. Remember that part of being a system administrator (and a software developer in general) is working within vague specifications to provide what your client is requesting, so eliciting additional information is a very necessary skill.</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p><em>To be more blunt - this specification may be purposefully designed to be vague, and it is your responsibility to ask questions about any vagaries you find. Once you begin the grading process, you cannot go back and change things, so be sure that your machines meet the expected specification regardless of what is written here. &ndash;Russ</em></p></div></div><p>Also, to complete many of these items, you may need to refer to additional materials and references not included in this document. System administrators must learn how to make use of available resources, so this is a good first step toward that. Of course, there&rsquo;s always <a href=http://www.google.com rel=external target=_blank>Google</a>!</p><h4 id=time-expectation>Time Expectation</h4><p>This lab may take anywhere from <strong>1 - 6 hours</strong> to complete, depending on your previous experience working with these tools and the speed of the hardware you are using. Installing virtual machines and operating systems is very time-consuming the first time through the process, but it will be much more familiar by the end of this course.</p><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div><div class=box-content><p><em>Most students in previous semesters have reported that <strong>this lab is generally the most frustrating and time-consuming</strong> to complete. I recommend setting aside ample amounts of time to work on this lab. This is especially true if the system you are running your VMs on is not very powerful, since running multiple VMs at the same time may slow things down significantly. However, if you find that you are going in circles and not getting it to work, that would be a great time to ask for help. &ndash;Russ</em></p></div></div><hr><h3 id=task-0-create-4-vms>Task 0: Create 4 VMs</h3><p>For this lab, you&rsquo;ll need the following VMs:</p><ol><li>A <strong>Windows 11</strong> VM. You may reuse your existing Windows 11 VM from a previous lab.</li><li>A <strong>Windows Server 2022 Standard (Updated July 2023)</strong> (or newer) VM. See <strong>Task 1</strong> below for configuration details.</li><li>An <strong>Ubuntu 24.04</strong> VM labelled <strong>CLIENT</strong>. This should be the existing <strong>CLIENT</strong> VM from Lab 3.</li><li>An <strong>Ubuntu 24.04</strong> VM labelled <strong>SERVER</strong>. <em>You have three options to create this VM:</em><ul><li>You can create a copy of your existing <strong>CLIENT</strong> VM from Lab 3, which does not have DHCP and DNS servers installed. Follow the instructions in the Lab 3 assignment to create a copy of that VM. In this case, you&rsquo;ll need to reconfigure the VMware NAT network to handle DHCP duties. Make sure you label this copy <strong>SERVER</strong> in VMWare. <em>This is generally the option that is simplest, and causes the least headaches.</em></li><li>You may continue to use your exiting <strong>SERVER</strong> VM from Lab 3, with DHCP and DNS servers installed. You may choose to continue to use this server as your primary DNS and DHCP server for your VM network, which would truly mimic what an enterprise network would be like. Remember that you&rsquo;ll need to have this VM running at all times to provide those services to other systems on your network. You may also choose instead to disable them and reconfigure the VMware NAT network to handle DHCP duties. Either approach is fine. <em>This option is generally a bit closer to an actual enterprise scenario, but can also cause many headaches, especially if your system doesn&rsquo;t have enough power to run several VMs simultaneously.</em></li><li>You may create a new Ubuntu 24.04 VM from scratch, label it <strong>SERVER</strong>, and configure it as defined either in Lab 1 or using the Puppet manifest files from Lab 2. <em>This is effectively the same as copying your <strong>CLIENT</strong> VM from Lab 3, but you get additional practice installing and configuring an Ubuntu VM, I guess.</em></li></ul></li></ol><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div><div class=box-content><p>Before starting this lab, make a <strong>snapshot</strong> in each VM labelled &ldquo;Before Lab 4&rdquo; that you can restore to later if you have any issues. In most cases, it is simpler to restore a snapshot and try again instead of debugging an error when setting up an LDAP or AD server. In addition, Task 6 below will ask you to restore to a snapshot in at least one VM before starting that step.</p></div></div><hr><h3 id=task-1-install-windows-server-2022-standard>Task 1: Install Windows Server 2022 Standard</h3><p>Create a new virtual machine for <strong>Windows Server 2022 Standard</strong> using the &ldquo;Windows Server 2022 Standard (Updated July 2023)&rdquo; installation media (you may choose a newer option if available, but this lab was tested on that specific version). You can download the installation files and obtain a product key from the <a href=https://support.cs.ksu.edu/CISDocs/wiki/FAQ#MSDNAA rel=external target=_blank>Microsoft Azure Student Portal</a> discussed in Module 1.</p><ul><li>File Name: <code>en-us_windows_server_2022_updated_july_2023_x64_dvd_541692c3.iso</code></li><li>SHA 256 Hash: <code>e215493d331ebd57ea294b2dc96f9f0d025bc97b801add56ef46d8868d810053</code></li></ul><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-lightbulb"></i> Tip</div><div class=box-content><p>For this system, I recommend giving the VM ample resources, usually at least 2 GB RAM and multiple processor cores if you can spare them. You may need to adjust the VM settings as needed to balance the performance of this VM against the available resources on your system.</p></div></div><p>When installing the operating system, configure it as specified below:</p><ul><li><p>Make sure you choose the <strong>Desktop Experience</strong> option when installing, unless you want a real challenge! It is possible to perform these steps without a GUI, but it is <em>much</em> more difficult.</p></li><li><p><strong>Computer Name:</strong> <code>cis527d-&lt;your eID></code> (example: <code>cis527d-russfeld</code>)<div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p><em>This is very important, as it allows us to track your virtual machine on the K-State network in case something goes wrong in a later lab. By including both the class and your eID, support staff will know who to contact. A majority of students have missed this step in previous semesters, so don&rsquo;t forget! The computer name must be changed <strong>after</strong> the Windows installation is complete &ndash;Russ</em></p></div></div></p></li><li><p><strong>Passwords:</strong> Use <code>cis527_windows</code> as the password for the built-in Administrator account</p></li><li><p><strong>Install Software</strong></p><ul><li><a href=https://docs.vmware.com/en/VMware-Tools/12.4.0/com.vmware.vsphere.vmwaretools.doc/GUID-391BE4BF-89A9-4DC3-85E7-3D45F5124BC7.html rel=external target=_blank>VMware Tools</a></li><li><a href=https://www.mozilla.org/en-US/firefox/new/ rel=external target=_blank>Mozilla Firefox</a> (<em>you&rsquo;ll thank me later</em>)</li></ul></li><li><p><strong>Install Windows Updates:</strong> Run Windows Update and reboot as necessary until all available updates are installed.</p></li><li><p><strong>Automatic Updates:</strong> Make sure the system is set to download and install security updates automatically.</p></li></ul><p>Make a <strong>snapshot</strong> of this VM once it is fully configured and updated. You can restore to this snapshot if you have issues installing Active Directory.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-lightbulb"></i> Tip</div><div class=box-content><p>You can use <kbd>CTRL</kbd>+<kbd>ALT</kbd>+<kbd>Insert</kbd> to send a <kbd>CTRL</kbd>+<kbd>ALT</kbd>+<kbd>Delete</kbd> to your VM in VMware without affecting your host OS.</p></div></div><hr><h3 id=task-2-configure-an-active-directory-domain-controller>Task 2: Configure an Active Directory Domain Controller</h3><p>Configure your Windows Server as an Active Directory Domain Controller. Follow the steps and configuration details below:</p><ol><li><p>First, set a static IP address on your Windows Server VM. Use the IP address ending in <code>42</code> that was reserved for this use in Lab 3. For the static DNS entries, use that same IP address or the localhost IP address (<code>127.0.0.1</code>) as the first entry, and then use the IP address of your DNS server (either your Ubuntu Server from Lab 3 or VMware&rsquo;s default gateway address, whichever option you are using) as the second DNS entry. In this way, the server will use itself as a DNS server first, and if that fails then it will use the other server. This is very important when dealing with Active Directory Domains, as the Domain Controller is also a DNS server.</p></li><li><p>Follow the instructions in the resources section below to install and configure the Active Directory Domain Services role on the server.</p><ul><li><strong>Domain Name:</strong> <code>ad.&lt;your eID>.cis527.org</code> (example: <code>ad.russfeld.cis527.org</code>)</li><li><strong>NETBIOS Domain Name:</strong> <code>AD</code> (this should be the default that is presented by the wizard)</li><li><strong>Passwords:</strong> Use <code>cis527_windows</code> for all passwords</li></ul></li><li><p>Add a User Account to your Active Directory</p><ul><li>Use your own eID for the username here, and <code>cis527_windows</code> as the password.</li></ul></li></ol><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-lightbulb"></i> Tip</div><div class=box-content><p>As of Summer 2021, there was a bug in Windows Server that prevented the built-in Administrator account from changing some settings, specifically network settings, once the server is promoted to a domain controller. This can make it difficult to fix networking issues in this or future labs. The easy fix for this is to copy the Administrator account in the Active Directory User and Computers tool and give the new copy a different name, such as &ldquo;Admin&rdquo;, and then use that account to log on to the server.</p></div></div><h4 id=resources>Resources</h4><ul><li><a href=https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/deploy/install-active-directory-domain-services--level-100- rel=external target=_blank>Install Active Directory Domain Services (Level 100)</a> from Microsoft</li><li><a href="https://www.server-world.info/en/note?os=Windows_Server_2016&p=active_directory&f=3" rel=external target=_blank>Add User Accounts on Active Directory</a> from Server-World</li><li><a href=https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/deploy/ad-ds-installation-and-removal-wizard-page-descriptions rel=external target=_blank>AD DS Installation and Removal Wizard Page Descriptions</a> from Microsoft</li></ul><hr><h3 id=task-3-join-the-domain-with-windows-11>Task 3: Join the Domain with Windows 11</h3><p>Join your Windows 11 VM to the Active Directory Domain created in Task 2. Follow the steps and configuration details below:</p><ol><li><p>First, set static DNS entries on your Windows 11 VM. You <strong>SHOULD NOT</strong> set a static IP, just static DNS entries. Use the Windows Server IP address ending in <code>42</code> as the first entry, and the second entry should be the same one used on the server earlier (either your Ubuntu Server from Lab 3 or VMware&rsquo;s default gateway, whichever option you are using).</p></li><li><p>Join the system to the domain, following the instructions linked in the resources section below.</p></li><li><p>Once the system reboots, you should be able to log in using the user account you created in Task 2.</p></li></ol><h4 id=resources-1>Resources</h4><ul><li><a href=https://learn.microsoft.com/en-us/windows-server/identity/ad-fs/deployment/join-a-computer-to-a-domain rel=external target=_blank>Join a Computer to a Domain</a> from Microsoft Support</li></ul><hr><h3 id=task-4-configure-an-openldap-server>Task 4: Configure an OpenLDAP Server</h3><p>Install OpenLDAP on your Ubuntu VM labelled <strong>SERVER</strong>. Follow the steps and configuration details below:</p><ol><li><p>First, set a static IP address on your Ubuntu VM labelled <strong>SERVER</strong>, if it does not have one already. Use the IP address ending in <code>41</code> that was reserved for this use in Lab 3. For the static DNS entries, use that same IP address as the first entry to reference your DNS server from Lab 3 (see the provided model solutions if your server was not working in Lab 3), and then use the IP address for VMware&rsquo;s default gateway address as the second DNS entry. In this way, the server will use itself as a DNS server first, and if that fails then it will use the other server. This is very important when dealing with LDAP domains, so that the server can properly resolve the <code>ldap.&lt;your eID>.cis527.org</code> address.</p></li><li><p>If you haven&rsquo;t already, make a <strong>snapshot</strong> of this VM that you can restore if you run into issues setting up an OpenLDAP server.</p></li><li><p>Set up and configure an OpenLDAP server, following the first part of the instructions in the guide linked in the resources section below.</p><ul><li><strong>Domain Name:</strong> <code>ldap.&lt;your eID>.cis527.org</code> (example: <code>ldap.russfeld.cis527.org</code>)</li><li><strong>Base DN:</strong> <code>dc=ldap,dc=&lt;your eID>,dc=cis527,dc=org</code> (example: <code>dc=ldap,dc=russfeld,dc=cis527,dc=org</code>)</li><li><strong>Passwords:</strong> Use <code>cis527_linux</code> for all passwords</li><li>You <strong>DO NOT</strong> have to perform the other steps in the guide to configure TLS at this point</li></ul></li><li><p>Install LDAP Account Manager (LAM). See the documentation linked below for how to install and configure LDAP Account Manager.</p></li><li><p>Add a User Account to your OpenLDAP Directory</p><ul><li>Follow the instructions in the guide below to create <code>ou</code>s for <code>users</code>, <code>groups</code>, and create an <code>admin</code> group as well.</li><li>Use your own eID for the username, and <code>cis527_linux</code> as the password.</li></ul></li><li><p>Configure the server to use TLS. You should follow the Ubuntu Server Guide to create and sign your own certificates. Make sure you use the correct domain name!</p><ul><li>You should make a <strong>snapshot</strong> of your Ubuntu Server VM before attempting to add TLS. It is <em>very</em> difficult to undo any errors in this process, therefore it is much easier to just roll back to a previous snapshot and try again.</li><li>At the end of the process, copy the certificate at <code>/usr/local/share/ca-certificates/mycacert.crt</code> to the home directory of the <code>cis527</code> user for the next step.</li></ul></li></ol><p>Of course, you may need to modify your firewall configuration to allow incoming connections to the LDAP server! <strong>If your firewall is disabled and/or not configured, there will be a deduction of up to 10% of the total points on this lab</strong></p><h4 id=resources-2>Resources</h4><ul><li><a href=https://www.howtoforge.com/how-to-install-openldap-on-ubuntu-22-04/ rel=external target=_blank>How to Install OpenLDAP on Ubuntu 22.04</a> from HowToForge (works for Ubuntu 24.04)<ul><li>Note: In this document, you can skip the steps of manually adding groups and users to LDAP before install LDAP Account Manager. Once LAM is configured, it will automatically add the default OUs for groups and users.</li></ul></li><li><a href=https://ubuntu.com/server/docs/ldap-and-transport-layer-security-tls rel=external target=_blank>LDAP & TLS</a> from the Ubuntu Server Guide</li></ul><hr><h3 id=task-5-configure-ubuntu-to-authenticate-via-ldap>Task 5: Configure Ubuntu to Authenticate via LDAP</h3><p>On your Ubuntu VM labelled <strong>CLIENT</strong>, configure the system to authenticate against the OpenLDAP server created in Task 4.</p><ol><li><p>First, confirm that you are able to resolve <code>ldap.&lt;your eID>.cis527.org</code> using <code>dig</code> on your client VM. If that doesn&rsquo;t work, you may need to set a static DNS entry to point to your Ubuntu VM labelled <strong>SERVER</strong> as configured in Lab 3, or add a manual entry to your <a href=https://www.ionos.com/digitalguide/server/configuration/hosts-file/ rel=external target=_blank>hosts file</a>.</p></li><li><p>Next, copy the <code>mycacert.crt</code> file from the home directory on your <strong>SERVER</strong> to the <code>/usr/local/share/ca-certificates/</code> directory on the <strong>CLIENT</strong>, and then run <code>sudo update-ca-certificates</code> to install it.</p><ol><li>If you have configured SSH properly, you can copy the file from one server to another using <code>scp</code>. The command may be something like <code>scp -P 23456 ldap.&lt;your eID>.cis527.org:~/mycacert.crt ./</code>.</li><li>You&rsquo;ll need to use <code>sudo</code> to copy that file into the apporpriate directory on the client. Read the output from the commands to ensure it is installed properly!</li></ol></li><li><p>Then, make sure that you can connect to the LDAP server using TLS. You can use <code>ldapwhoami -x -ZZ -H ldap://ldap.&lt;your eID>.cis527.org</code> and it should return <code>anonymous</code> if it works.</p></li><li><p>Before you configure SSSD, make a <strong>snapshot</strong> of this VM. If your SSSD configuration does not work, you can restore this snapshot and try again.</p></li><li><p>To test your SSSD configuration, use the command <code>getent passwd &lt;username></code> (example: <code>getent passwd russfeld</code>) and confirm that it returns an entry for your LDAP user.</p></li><li><p>To log in as the LDAP user, use the <code>su &lt;username></code> command (example: <code>su russfeld</code>).</p></li><li><p>Finally, <strong>reboot the system</strong>, and make sure you can log in graphically by choosing the &ldquo;Not listed?&rdquo; option on the login screen and entering your LDAP user&rsquo;s credentials.</p></li></ol><h4 id=resources-3>Resources</h4><ul><li><a href=https://ubuntu.com/server/docs/ldap-and-transport-layer-security-tls rel=external target=_blank>SSSD and LDAP</a> on Ubuntu Server Guide</li></ul><hr><h3 id=task-6-interoperability---ubuntu-client-on-windows-domain>Task 6: Interoperability - Ubuntu Client on Windows Domain</h3><ol><li>On your Ubuntu VM labelled <strong>CLIENT</strong>, make a <strong>snapshot</strong> labelled &ldquo;OpenLDAP&rdquo; to save your configuration you performed for Task 5.</li><li>Open the Snapshot Manager (VM > Snapshot > Snapshot Manager) for that VM</li><li>Restore the &ldquo;Before Lab 4&rdquo; Snapshot. This should take you back to the state of this VM prior to setting it up as an OpenLDAP client.</li><li>Follow the instructions in the video in this module to join your Windows Active Directory Domain with your Ubuntu VM. You&rsquo;ll want to confirm that you are able to resolve <code>ad.&lt;your eID>.cis527.cs.ksu.edu</code> using <code>dig</code> on your client VM. If that doesn&rsquo;t work, you may need to set a static DNS entry to point to your Windows server as configured earlier in this lab, or add a manual entry to your <a href=https://www.ionos.com/digitalguide/server/configuration/hosts-file/ rel=external target=_blank>hosts file</a>.<div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div><div class=box-content><p>If you get errors like &ldquo;Insufficient permissions to join the domain&rdquo;, you may need to install <code>krb5-user</code> and then add <code>rdns=false</code> to the <code>[libdefaults]</code> section of the <code>/etc/krb5.conf</code> file, as described in <a href=https://access.redhat.com/discussions/3370851 rel=external target=_blank>this thread</a>. That seemed to fix the error for me.</p></div></div></li><li>Make a <strong>snapshot</strong> labelled &ldquo;ActiveDirectory&rdquo; to save your configuration for this task. You can switch between snapshots to have this VM act as a client for either directory service.</li></ol><h4 id=resources-4>Resources</h4><ul><li><a href=https://ubuntu.com/server/docs/how-to-set-up-sssd-with-active-directory rel=external target=_blank>SSSD and Active Directory</a> from Ubuntu</li><li><a href="https://www.server-world.info/en/note?os=Ubuntu_20.04&p=realmd" rel=external target=_blank>Join in Active Directory Domain</a> from Server-World (works for 24.04)</li><li><a href=https://computingforgeeks.com/join-ubuntu-debian-to-active-directory-ad-domain/ rel=external target=_blank>How to Join Ubuntu 18.04 / Debian 10 To Active Directory (AD) Domain</a> from Computingforgeeks (works for 24.04)</li></ul><hr><h3 id=task-7-query-servers-using-ldapsearch>Task 7: Query Servers Using LDAPSearch</h3><p>From your Ubuntu VM labelled <strong>CLIENT</strong>, use the <code>ldapsearch</code> command (in the <code>ldap-utils</code> package) to query your Active Directory and OpenLDAP servers. Take a <strong>screenshot</strong> of the output from each command.</p><p>Below are example commands from a working solution. You&rsquo;ll need to adapt them to match your environment. There are also sample screenshots of expected output.</p><ul><li>Active Directory Example <a href=/cis527/images/lab4_win.png>Screenshot</a> (instructive, but using old data)</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ldapsearch -LLL -H ldap://192.168.40.42:389 -b <span class=s2>&#34;dc=ad,dc=russfeld,dc=cis527,dc=cs,dc=ksu,dc=edu&#34;</span> -D <span class=s2>&#34;ad\Administrator&#34;</span> -w <span class=s2>&#34;cis527_windows&#34;</span></span></span></code></pre></div><ul><li>OpenLDAP Example <a href=/cis527/images/lab4_ubu.png>Screenshot</a> (instructive, but using old data)</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ldapsearch -LLL -H ldap://192.168.40.41:389 -b <span class=s2>&#34;dc=ldap,dc=russfeld,dc=cis527,dc=cs,dc=ksu,dc=edu&#34;</span> -D <span class=s2>&#34;cn=admin,dc=ldap,dc=russfeld,dc=cis527,dc=cs,dc=ksu,dc=edu&#34;</span> -w <span class=s2>&#34;cis527_linux&#34;</span></span></span></code></pre></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-lightbulb"></i> Tip</div><div class=box-content><p><em>You&rsquo;ll be asked to perform each of these commands as part of the grading process, but the screenshots provide good insurance in case you aren&rsquo;t able to get them to work &ndash;Russ</em></p></div></div><hr><h3 id=task-8-make-snapshots>Task 8: Make Snapshots</h3><p>In each of the virtual machines created above, create a snapshot labelled &ldquo;Lab 4 Submit&rdquo; before you submit the assignment. The grading process may require making changes to the VMs, so this gives you a restore point before grading starts. Also, you may have multiple Lab 4 snapshots on some VMs, so feel free to label them accordingly.</p><h3 id=task-9-schedule-a-grading-time>Task 9: Schedule A Grading Time</h3><p>Contact the instructor and schedule a time for interactive grading. You may continue with the next module once grading has been completed.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=windows-active-directory-installation>Windows Active Directory Installation</h1><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p><em>This video uses Windows Server 2016, but the process should be functionally identical in Windows Server 2019. Also make sure you refer to the Lab 4 assignment for the correct root domain name. &ndash;Russ</em></p></div></div><a href="https://www.youtube.com/watch?v=mXcbSisLVao">YouTube Video</a><h4 id=resources>Resources</h4><ul><li><a href=https://blogs.technet.microsoft.com/canitpro/2017/02/22/step-by-step-setting-up-active-directory-in-windows-server-2016/ rel=external target=_blank>Step-By-Step: Setting Up Active Directory in Windows Server 2016</a> from Microsoft</li><li><a href="https://www.server-world.info/en/note?os=Windows_Server_2016&p=active_directory&f=3" rel=external target=_blank>Add User Accounts on Active Directory</a> from Server-World</li><li><a href=https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/deploy/ad-ds-installation-and-removal-wizard-page-descriptions rel=external target=_blank>AD DS Installation and Removal Wizard Page Descriptions</a> from Microsoft</li><li><a href=https://en.wikipedia.org/wiki/NetBIOS rel=external target=_blank>NetBIOS</a> on Wikipedia</li></ul><h4 id=video-transcript>Video Transcript</h4><p>In this video, I&rsquo;ll go through some of the process of configuring a Windows Server 2016 VM to act as an Active Directory Domain Controller. The goal of this video isn&rsquo;t to show you all the steps of the process, but provide commentary on some of the more confusing steps you&rsquo;ll perform.</p><p>In general, I&rsquo;ll be following the two guides linked in the resources section below this video. The third guide gives quite a bit of additional information about each option in the Active Directory Domain Services installation wizard, and is a very handy reference as you work through this process.</p><p>First, I&rsquo;ll need to set a static IP address on this system. I&rsquo;ll be using the IP address ending in <code>42</code> for this server, which was reserved in in the DNS server configured in Lab 3. I&rsquo;ll also need to configure some static DNS entries. For a Domain Controller, you&rsquo;ll always want to make the first DNS entry the IP address of the server itself. This is because a Domain Controller also acts as a DNS server for the domain, so you&rsquo;ll need to tell this system to refer to itself for some DNS lookups. For the other entry, I&rsquo;ll use the VMware router, which is the same as the default gateway address in my setup.</p><p>Next, I&rsquo;m going to follow the steps to add the &ldquo;Active Directory Domain Services&rdquo; role to this server. This process is pretty straightforward, so I&rsquo;ll leave it to you to follow the guide.</p><hr><p>Once the installation is complete, you&rsquo;ll be prompted to promote the server to a domain controller. This is the step where you&rsquo;ll actually configure the Active Directory installation. For this setup, we&rsquo;re going to create a new forest, using the <code>cis527.local</code> root domain name. You&rsquo;ll need to adjust these settings to match the required configuration for the lab assignment. By using a <code>.local</code> top-level domain, we can guarantee that this will never be routable on the global internet. The use of a <code>.local</code> suffix here doesn&rsquo;t actually comply with current DNS standards, but for our internal VM network it will work just fine. Of course, if you are doing this on an actual enterprise system, you may actually use your company&rsquo;s internet domain name here, with a custom prefix for your directory. For example, the K-State Computer Science department might use a domain name of <code>ldap.cs.ksu.edu</code> for this server.</p><p>Next, you&rsquo;ll need to configure the functional level of the domain. If you have older systems in your network, you will want to choose the option here for the oldest domain controller in the domain. Since we&rsquo;re just creating a new system, we can use the latest option here.</p><p>You&rsquo;ll also need to input a password here for Directory Services Restore Mode. In an enterprise setting, this is the password that you&rsquo;ll use if you ever have to restore your domain from a backup, or work with a domain controller that will not boot correctly. So, you&rsquo;d generally make this a unique password, and store it in a safe location. For our example, I&rsquo;m just going to use the password we&rsquo;ve been using for all of our Windows systems, but in practice you would make it much more secure.</p><p>Next are the DNS options. If you are running a separate DNS server in your organization, you&rsquo;ll need to checkmark this box to create a DNS delegation. However, for this lab assignment you won&rsquo;t need to do that, since we aren&rsquo;t trying to combine our Windows and Linux environments.</p><p>Following that, you&rsquo;ll need to configure the NetBIOS name for the domain. In general, this is just the first part of your fully domain name. NetBIOS is a very old protocol that is not commonly used, but some Windows systems will still use it to find resources on a network. You can just accept the default option here, unless a different name would be more reasonable.</p><p>In addition, you&rsquo;ll be able to configure the storage paths on your system. For this example, we&rsquo;ll just keep the default paths. However, on a production server, it might make more sense to store these on a different drive, just in case you have to reinstall the operating system in the future. These are the folders that store the actual database and information for the Active Directory domain.</p><p>Finally, you&rsquo;ll be able to review the options before applying them. If you&rsquo;d like, you can click the &ldquo;View script&rdquo; button to view a PowerShell script that you could use to perform these steps on a Windows Server without a GUI installed.</p><p>With all the settings in place, you can continue with the configuration process. The first step is a prerequisites check to make sure that the server is able to complete the installation. You may get a couple of warnings about weaker cryptography algorithms and DNS server delegation, but you can ignore those for this example. If the prerequisites check is passed, you can click &ldquo;Install&rdquo; to install the service.</p><hr><p>Once it has installed and rebooted, you&rsquo;ll notice that you are now prompted to log in as a domain user. On Windows systems, the domain name is shown before the <code>\</code>, followed by your username. So, in this example, it now wants me to log in as <code>CIS527\Administrator</code>. This is a different account than the Administrator account on the computer itself, which we were using previously. To log in as a local account, you can use the computer name, followed by a <code>\</code> and then the username. If you don&rsquo;t remember the computer name, you can click the &ldquo;How do I sign in to another domain?&rdquo; link below the prompt to find it. For now, we&rsquo;ll log in as the domain administrator account.</p><p>Once you&rsquo;ve logged in, you&rsquo;ll need to create at least one user on the Active Directory domain. You can find the <strong>Active Directory Users and Computers</strong> application under the <strong>Tools</strong> menu on the Server Manager. Thankfully, adding a user here is very similar to adding a user in the Computer Management interface on a Windows computer. As before, make sure you uncheck the box labeled &ldquo;User must change password at next logon&rdquo; and checkmark the &ldquo;Password never expires&rdquo; box for now.</p><p>That should get the server all set up! Next, we&rsquo;ll look at adding a Windows 10 computer to your new Active Directory Domain.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=windows-client-configuration>Windows Client Configuration</h1><a href="https://www.youtube.com/watch?v=DL2FyuTx2_8">YouTube Video</a><h4 id=resources>Resources</h4><ul><li><a href=https://learn.microsoft.com/en-us/windows-server/identity/ad-fs/deployment/join-a-computer-to-a-domain rel=external target=_blank>Join a Computer to a Domain</a> from Microsoft Support</li></ul><h4 id=video-transcript>Video Transcript</h4><p>Once you have completely set up your Active Directory Domain, you can begin to add Windows clients to the domain. This video will walk through some of that process, and I&rsquo;ll discuss a few of the steps as we go.</p><p>For this example, I have my Windows 10 VM from the earlier labs. It is on the same network as the domain controller. Before I begin, I&rsquo;ll need to set some static DNS settings on this computer. First, and most importantly, I&rsquo;ll add a DNS entry for the domain controller first, and the second entry can be any of the other working DNS servers on the network. In this case, I&rsquo;ll just use the VMware default gateway.</p><p>Next, I&rsquo;m going to right-click on the Start button and choose the System option. Before adding it to the domain, I need to make sure it is named correctly. If not, I&rsquo;ll need to rename it and reboot before adding it to the domain. Once a computer is on a domain, it is very difficult to rename it.</p><p>Once I&rsquo;m sure it is correct, I&rsquo;m going to click the <strong>System Info</strong> link to get to the old System options in the Control Panel. Here I should be able to see the current workgroup. To add the system to a domain, click the <strong>Change settings</strong> button to the right of the computer name. Then, I&rsquo;ll click the <strong>Change</strong> button to add it to the domain.</p><p>On this window, I&rsquo;ll choose the <strong>Domain</strong> option, and enter the name of the domain, in this case <code>cis527.local</code>, and click OK. You may get a message about the NetBIOS name of the computer being too long, but you can safely ignore that message.</p><p>If everything works correctly, you should see a pop up asking you to enter the username and password of an account with permissions to add a computer to the domain. In this case, the only account we&rsquo;ve set up with those permissions is the domain administrator account, so we&rsquo;ll enter those credentials here. Once you enter it, it should welcome you to the domain, and prompt you to restart.</p><p>If your computer is unable to contact the domain at this step, it is usually a problem with your network configuration. To diagnose the problem, try to ping the domain name using the command-line <code>ping</code> utility and see what the response is. If it cannot find it, then check your network settings and DNS settings and make sure you can ping the domain controller as well. In many cases, this can be one of the more frustrating errors to debug if it happens to you.</p><p>Once the system reboots, you&rsquo;ll be able to log in using any valid credentials for a domain user. As you experienced with the domain controller, you can enter the domain or computer name, followed by a slash, and then the user name to choose which user account to use. Thankfully, here you can always use <code>.\</code> to log in as the local computer. In this case, let&rsquo;s use our domain user account.</p><p>Once you log in, let&rsquo;s take a look at the <strong>Computer Management</strong> interface to see what changed about the users and groups on the system. If you open up the Administrators group, you&rsquo;ll notice that it now includes an entry for <code>CIS527\Domain Admins</code>, and likewise the Users group contains a new entry for <code>CIS527\Domain Users</code>. That means, by default, any user on the domain can now log on to the computer as a user, and anyone on the domain with administrative privileges can log on to any computer on the domain and gain administrator permissions there as well. It is very important to understand these default permissions, so that you can assign them accordingly. For example, in many organizations, you may want to immediately remove the Domain Users entry from the Users group, and add a smaller group instead. You probably don&rsquo;t need folks from the Accounting department logging on to systems in Human Resources, right?</p><p>That&rsquo;s really all there is to it! You&rsquo;ve successfully set up a Windows Active Directory Domain and added your first client computer to it. The next few videos will walk you through the same process on Ubuntu with OpenLDAP.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=windows-group-policy>Windows Group Policy</h1><a href="https://www.youtube.com/watch?v=p6f41Qq6FBM">YouTube Video</a><h4 id=resources>Resources</h4><ul><li><strong><a href=/cis527/4-directory-services/06-windows-group-policy-slides/>Slides</a></strong></li><li><a href=https://en.wikipedia.org/wiki/Group_Policy rel=external target=_blank>Group Policy</a> on Wikipedia</li><li><a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc785665(v=ws.10)" rel=external target=_blank>Group Policy Processing and Precedence</a> from Microsoft Docs</li><li><a href=https://redmondmag.com/articles/2016/01/12/group-policy-fundamentals.aspx rel=external target=_blank>Group Policy Fundamentals in Active Directory</a> by Troy Thompson in Redmond Magazine</li><li><a href=https://www.howtogeek.com/125171/htg-explains-what-group-policy-is-and-how-you-can-use-it/ rel=external target=_blank>What is Group Policy in Windows</a> from How-To Geek</li><li><a href=https://www.csoonline.com/article/562485/the-10-windows-group-policy-settings-you-need-to-get-right-2.html rel=external target=_blank>The 10 Windows Group Policy Settings you Need to Get Right</a> from CSO Online</li><li><a href=https://www.globalknowledge.com/us-en/content/articles/in-the-trenches-eight-tips-n-tricks-for-microsoft-windows-group-policy/ rel=external target=_blank>In the Trenches: Eight Tips-n-Tricks for Microsoft Windows Group Policy</a> by Mark Mizrahi on Global Knowledge</li><li><a href=https://www.lepide.com/blog/top-10-most-important-group-policy-settings-for-preventing-security-breaches/ rel=external target=_blank>Top 10 Most Important Group Policy Settings for Preventing Security Breaches</a> by Abhishek Rai on Lepide Blog</li><li><a href=https://activedirectorypro.com/group-policy-best-practices/ rel=external target=_blank>Group Policy Best Practices</a> by Robert Allen on Active Directory Pro</li><li><a href=https://technet.microsoft.com/en-us/library/2008.01.gpperf.aspx rel=external target=_blank>Optimizing Group Policy Performance</a> by Darren Mar-Elia on Microsoft TechNet</li></ul><h4 id=video-transcript>Video Transcript</h4><p>One of the major features of Microsoft&rsquo;s Active Directory is the ability to use Group Policy Objects, or GPOs, to enforce specific security settings on any Windows client added to the domain. For large enterprises, this is a major tool in their arsenal to ensure that Windows PCs are properly configured and secured in their organization.</p><p>Group Policy can be set at both the local computer level, as well as via Active Directory. The settings themselves are hierarchical in nature, so you can easily browse through related settings when using the Group Policy Editor tool. In addition, GPOs are inheritable, and multiple GPOs can be applied to a group or OU in a domain.</p><p>When group policies are applied, they follow this order. First, any policies set locally on the machine are applied, then policies from the Active Directory site, then the global domain itself, and finally any policies applied to the OU containing this computer or user are applied. At each level, any previous settings can be overridden, so in essence, the policies applied at the OU level take precedence over others.</p><p>Some examples of things you can control via Group Policy are shown here. You can create mapped drives, which we will see in a later module. You can also set power options, which could be used in an organization to save money by reducing energy usage. In addition, you can use group policy to enforce password restrictions, and even install printers and printer drivers as well.</p><p>Let&rsquo;s take a look at one quick demonstration, setting a password policy for the domain. This tutorial is from Infoworld, and is linked in the resources section below the video.</p><p>Here I have opened my Windows 2016 Server VM as configured for Lab 4. First, I&rsquo;ll open the Group Policy Management Console, which is available on the Tools menu in Windows Server Manager. Next, I&rsquo;ll find my domain, and right-click it to create a GPO in this domain. I&rsquo;ll also give the GPO a helpful name, and click OK to create it.</p><p>Next, I can right-click the policy and choose Edit. In the policy editor, I&rsquo;ll need to dig down the following path:</p><div class=highlight><pre tabindex=0><code>&lt;name&gt;\Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy</code></pre></div><p>In that window, we&rsquo;ll right-click the &ldquo;Password Must Meet Complexity Requirements&rdquo; option, and choose <strong>Properties</strong>. Then, we&rsquo;ll enable the setting by checkmarking the box and clicking Enable. You can find more information about the policy by clicking the <strong>Explain</strong> tab at the top.</p><p>Finally, once the policy is configured, you&rsquo;ll need to right-click on it once again, and select the <strong>Enforced</strong> option to enforce it on the domain itself.</p><p>That&rsquo;s all there is to it! Now, any new password created on this domain must meet those complexity requirements. While you won&rsquo;t have to work with Group Policy for this lab assignment, we&rsquo;ll come back to it in a later module as we work with application and file servers.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=ubuntu-ldap-installation>Ubuntu LDAP Installation</h1><a href="https://www.youtube.com/watch?v=zIUDIiAMGrg">YouTube Video</a><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>PHPLDAPAdmin no longer works on Ubuntu 24.04 since it has several incompatibility issues with PHP 8+. The assignment has been updated to use the new LDAP Account Manager (LAM) software instead. You may ignore the part of this video showing how to configure PHPLDAPAdmin and instead refer to the guide linked from the assignment page to configure LAM.</p></div></div><h4 id=resources>Resources</h4><ul><li><a href=https://www.howtoforge.com/how-to-install-openldap-on-ubuntu-22-04/ rel=external target=_blank>How to Install OpenLDAP on Ubuntu 22.04</a> from HowToForge (works for Ubuntu 24.04)<ul><li>Note: In this document, you can skip the steps of manually adding groups and users to LDAP before install LDAP Account Manager. Once LAM is configured, it will automatically add the default OUs for groups and users.</li></ul></li><li><a href=https://ubuntu.com/server/docs/ldap-and-transport-layer-security-tls rel=external target=_blank>LDAP & TLS</a> from the Ubuntu Server Guide</li><li><a href="https://www.youtube.com/watch?v=T4Df5_cojAs" rel=external target=_blank>How Does HTTPS Work</a> from kubucation on YouTube (a good overview of CAs and certificates)</li><li><strong><a href=/cis527/3-core-networking-services/15-security/>Core Networking Services - Security</a></strong></li><li><strong><a href=/cis527/5-the-cloud/06-certificates/>The Cloud - Certificates</a></strong></li></ul><h4 id=video-transcript>Video Transcript</h4><p>As we did earlier with setting up Active Directory on Windows, let&rsquo;s take a look at the steps required to install and configure OpenLDAP on Linux. The goal of this video isn&rsquo;t to show you all the steps of the process, but provide commentary on some of the more confusing steps you&rsquo;ll perform.</p><p>For this example, I&rsquo;m using the Ubuntu VM labelled Server from Lab 3. I have chosen to disable the DHCP server on this system, and instead have replaced it with the VMware DHCP server. In practice, that change should not affect any of this process. Also, I&rsquo;ll generally be following the guide from DigitalOcean, which is linked in the resources section below the video.</p><p>At this point, I have also already performed the first steps of the guide, which is to install the <code>slapd</code> and <code>ldap-utils</code> packages on this system. Now, I&rsquo;ll step through the configuration process for <code>slapd</code> and discuss the various options it presents.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo dpkg-reconfigure slapd</span></span></code></pre></div><p>First, it will ask you if you want to omit the OpenLDAP server configuration. Make sure you select <code>&lt;No></code> for that option. You can use the arrow keys (<kbd>←</kbd> and <kbd>→</kbd>) to move the red-shaded selector to the option you&rsquo;d like to select, then press <kbd>ENTER</kbd> to confirm it.</p><p>Next, it will ask for your domain name. For this example, I&rsquo;ll just use <code>ldap.cis527russfeld.cs.ksu.edu</code>. You&rsquo;ll need to adjust these settings to match the required configuration for the lab assignment. This matches the DNS configuration I made in Lab 3, which is very important later on in this process.</p><p>Next, it will also ask for your organization name. I&rsquo;ll just use <code>cis527</code> here.</p><p>Then, it will ask for your Administrator password. This is the equivalent of the <code>root</code> account within the domain. It is able to change all domain settings, and therefore the password for this account should be very complex and well protected. For this example, I&rsquo;ll just use the same password we are using for everything else, but in practice you&rsquo;ll want to carefully consider this password.</p><p>The next option is whether you want to have the database removed if you purge the <code>slapd</code> package. Selecting <code>&lt;yes></code> on this option would delete your LDAP database if you ever chose to reinstall the <code>slapd</code> package. For most uses, you&rsquo;ll always want to select <code>&lt;no></code> here, which is what I&rsquo;ll do.</p><p>Since there are some existing configuration files in place, the installer asks if you&rsquo;d like those to be moved. Unless you are reinstalling <code>slapd</code> on an existing server, you can select <code>&lt;yes></code> for this option.</p><p>That should complete the configuration for the OpenLDAP server. For this example, I have disabled the firewall on this system, but for your lab assignment you&rsquo;ll need to do a bit of firewall configuration at this point.</p><hr><p>Finally, let&rsquo;s add some encryption to this server to protect the information shared across the network. This step was not required in previous versions of this lab, but it has always been a good idea. Now that Ubuntu uses SSSD, or System Security Services Daemon, for authentication, it requires us to provide TLS encryption on our LDAP server. So, let&rsquo;s do that now.</p><p>For these steps, we&rsquo;ll be closely following the Ubuntu Server Guide linked below this video. We&rsquo;ll be adjusting a few of the items to match our configuration, but most of the commands are exactly the same.</p><p>First, we&rsquo;ll need to install a couple of packages to allow us to create and manipulate security certificates</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt update
</span></span><span class=line><span class=cl>sudo apt install gnutls-bin ssl-cert</span></span></code></pre></div><p>Next, we need to create our own certificate authority, or CA. In a production system, you would instead work with an actual CA to obtain a security certificate from them, but that can be time consuming and expensive. So, for this example, we&rsquo;ll just create our own. Also, contrary to what your browser may lead you to believe, using your own CA certificates will result in an encrypted connection, it just may not be &ldquo;trusted&rdquo; since your browser doesn&rsquo;t recognize the CA certificate.</p><p>If you want to know more about CAs and certificates, check out the handy YouTube video I&rsquo;ve linked below this video. It gives a great description of how certificates work in much more detail. I&rsquo;ve also included links to the lectures in Module 3 and Module 5 that deal with TLS certificates.</p><p>So, we&rsquo;ll first create a private key for our CA:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo certtool --generate-privkey --bits <span class=m>4096</span> --outfile /etc/ssl/private/mycakey.pem</span></span></code></pre></div><p>Then, we&rsquo;ll create a template file that contains the options we need for creating this certificate. Notice here that I&rsquo;ve modified this information from what is provided in the Ubuntu Server Guide document to match our setup:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nano /etc/ssl/ca.info</span></span></code></pre></div><p>and put the following text into that file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tex data-lang=tex><span class=line><span class=cl>cn = CIS 527
</span></span><span class=line><span class=cl>ca
</span></span><span class=line><span class=cl>cert<span class=nb>_</span>signing<span class=nb>_</span>key
</span></span><span class=line><span class=cl>expiration<span class=nb>_</span>days = 3650</span></span></code></pre></div><p>Then, we can use that template to create our self-signed certificate authority certificate:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo certtool --generate-self-signed --load-privkey /etc/ssl/private/mycakey.pem --template /etc/ssl/ca.info --outfile /usr/local/share/ca-certificates/mycacert.crt</span></span></code></pre></div><p>This will create a certificate called <code>mycacert.crt</code> that is stored in <code>/usr/local/share/ca-certificates/</code>. <strong>This is our self-signed CA certificate</strong>. So, whenever we want any system to trust one of our self-signed certificates that we make from our CA, we&rsquo;ll need to make sure that system has a copy of this CA certificate in its list of trusted certificates.</p><p>To do that, we simply place the certificate in <code>/usr/local/share/ca-certificates/</code>, and then run the following command to add it to the list of trusted certificates:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo update-ca-certificates</span></span></code></pre></div><p>If that command works correctly, it should tell us that it has added 1 certificate to our list.</p><p>Before we move on, let&rsquo;s make a copy of our <code>mycacert.crt</code> file in our <code>cis527</code> users&rsquo;s home directory. We&rsquo;ll use this file in the next part of this lab when we are configuring our client system to authenticate using LDAP.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cp /usr/local/share/ca-certificates/mycacert.crt ~/</span></span></code></pre></div><p>Now that we&rsquo;ve created our own self-signed CA, we can use it to create a certificate for our LDAP server. So, we&rsquo;ll start by creating yet another private key:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo certtool --generate-privkey --bits <span class=m>2048</span> --outfile /etc/ldap/ldap01_slapd_key.pem</span></span></code></pre></div><p>Then, we&rsquo;ll create another template file to give the information about the certificate that we&rsquo;d like to create:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nano /etc/ssl/ldap01.info</span></span></code></pre></div><p>and place the following tex in that file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tex data-lang=tex><span class=line><span class=cl>organization = CIS 527
</span></span><span class=line><span class=cl>cn = ldap.cis527russfeld.cs.ksu.edu
</span></span><span class=line><span class=cl>tls<span class=nb>_</span>www<span class=nb>_</span>server
</span></span><span class=line><span class=cl>encryption<span class=nb>_</span>key
</span></span><span class=line><span class=cl>signing<span class=nb>_</span>key
</span></span><span class=line><span class=cl>expiration<span class=nb>_</span>days = 365</span></span></code></pre></div><p>Notice that in that file, we entered the fully qualified domain name for our LDAP server on the second line. This is the most important part that makes all of this work. On our client machine, we must have a DNS entry that links this domain name to our LDAP server&rsquo;s IP address, and then the certificate the server uses must match that domain name. So, if we don&rsquo;t get this step right, the whole system may not work correctly until we fix it!</p><p>Finally, we can use this long and complex command to create and sign our server&rsquo;s certificate:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo certtool --generate-certificate --load-privkey /etc/ldap/ldap01_slapd_key.pem --load-ca-certificate /etc/ssl/certs/mycacert.pem --load-ca-privkey /etc/ssl/private/mycakey.pem --template /etc/ssl/ldap01.info --outfile /etc/ldap/ldap01_slapd_cert.pem</span></span></code></pre></div><p>Once the certificate has been created, we just need to do a couple of tweaks so that it has the correct permissions. This will allow the LDAP server to properly access the file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo chgrp openldap /etc/ldap/ldap01_slapd_key.pem
</span></span><span class=line><span class=cl>sudo chmod <span class=m>0640</span> /etc/ldap/ldap01_slapd_key.pem</span></span></code></pre></div><p>Finally, at long last, we are ready to tell our LDAP server to use the certificate. To do that, we&rsquo;ll create an LDIF file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nano ~/certinfo.ldif</span></span></code></pre></div><p>and in that file we&rsquo;ll put the information about our certificate:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tex data-lang=tex><span class=line><span class=cl>dn: cn=config
</span></span><span class=line><span class=cl>add: olcTLSCACertificateFile
</span></span><span class=line><span class=cl>olcTLSCACertificateFile: /etc/ssl/certs/mycacert.pem
</span></span><span class=line><span class=cl>-
</span></span><span class=line><span class=cl>add: olcTLSCertificateFile
</span></span><span class=line><span class=cl>olcTLSCertificateFile: /etc/ldap/ldap01<span class=nb>_</span>slapd<span class=nb>_</span>cert.pem
</span></span><span class=line><span class=cl>-
</span></span><span class=line><span class=cl>add: olcTLSCertificateKeyFile
</span></span><span class=line><span class=cl>olcTLSCertificateKeyFile: /etc/ldap/ldap01<span class=nb>_</span>slapd<span class=nb>_</span>key.pem</span></span></code></pre></div><p>Once that file is created, we can use the <code>ldapmodify</code> tool to import it into our server:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo ldapmodify -Y EXTERNAL -H ldapi:/// -f certinfo.ldif</span></span></code></pre></div><p>Whew! That was a lot of work! Now, if we did everything correctly, we should be able to query this LDAP server using TLS. The best way to check that is by using the following command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ldapwhoami -x -ZZ -h ldap.cis527russfeld.cs.ksu.edu</span></span></code></pre></div><p>The <code>-ZZ</code> part of that command tells it to use TLS, and if it works correctly it should return <code>anonymous</code> as the result. If this step fails, then you may need to do some troubleshooting to see what the problem is.</p><p>That should do it! In the next video, I&rsquo;ll show how to configure another Ubuntu VM to use this LDAP server for authentication.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=ubuntu-client-configuration>Ubuntu Client Configuration</h1><a href="https://www.youtube.com/watch?v=sTDsiX90KCQ">YouTube Video</a><h4 id=resources>Resources</h4><ul><li><a href=https://ubuntu.com/server/docs/ldap-and-transport-layer-security-tls rel=external target=_blank>SSSD and LDAP</a> on Ubuntu Server Guide</li></ul><h4 id=video-transcript>Video Transcript</h4><p>Once we&rsquo;ve set up and configured our OpenLDAP server on Linux, we can configure another VM to act as an LDAP client and use that server for authentication. Thankfully, now that Ubuntu 20.04 uses SSSD, this process is pretty simple.</p><p>For the most part, we&rsquo;ll be following the instructions in the Ubuntu Server Guide page linked below this video. It is a pretty in-depth overview of how to configure SSSD to use LDAP for authentication. In fact, if you&rsquo;ve done the Windows portions of this assignment already, you&rsquo;ll be familiar with several of these steps.</p><p>First, we&rsquo;ll need to install a couple of packages on this system to allow us to interact with LDAP systems via SSSD:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt update
</span></span><span class=line><span class=cl>sudo apt install sssd-ldap ldap-utils</span></span></code></pre></div><p>Next, we&rsquo;ll need to get a copy of our certificate authority, or CA, certificate from our Ubuntu 20.04 VM labelled <strong>SERVER</strong>. If we followed the instructions in the previous video correctly, we should have created a copy of that file in the home directory of the <code>cis527</code> user on our server.</p><p>If not, you can do so by logging on to the <strong>SERVER</strong> VM as <code>cis527</code> and using the following command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cp /usr/local/share/ca-certificates/mycacert.crt ~/</span></span></code></pre></div><p>Then, from the <strong>CLIENT</strong> VM, we can use <code>scp</code> to copy that file using SSH. Hopefully you were able to get the SSH portion of the lab set up and working correctly. If not, you may have to copy this from the <strong>SERVER</strong> VM to your host system, and then from your host system back to the <strong>CLIENT</strong> VM. To copy the file using <code>scp</code>, use a command similar to the following</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>scp -P <span class=m>22222</span> cis527@192.168.40.41:~/mycacert.crt ~/</span></span></code></pre></div><p>Let&rsquo;s break that command down. First, the <code>-P 22222</code> tells us the we are using port 22222 to connect to the system, which is how it was configured in Lab 3. Then, we have <code>cis527@</code>, which is the username we&rsquo;d like to use on the remote system, followed by <code>192.168.40.41</code>, which is the IP address of our <strong>SERVER</strong> VM. Next, there is a colon, and a file path, which is <code>~/mycacert.crt</code>, which is the path to the certificate file on the <strong>SERVER</strong> VM. Finally, we have a space, and another path <code>~/</code> showing where we&rsquo;d like to place the file on our <strong>CLIENT</strong> VM.</p><p>Of course, if you want to learn more about SSH and SCP, check out the video in the Extras section for more information.</p><p>Once we have a copy of the certificate on our <strong>CLIENT</strong> VM, we can install it using the following commands:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo cp ~/mycacert.crt /usr/local/share/ca-certificates/
</span></span><span class=line><span class=cl>sudo update-ca-certificates</span></span></code></pre></div><p>If that command works correctly, it should tell us that it has added 1 certificate to our list. That means that our <strong>CLIENT</strong> VM now includes our own self-signed CA in its list of trusted CA certificates. That&rsquo;s what we want!</p><hr><p>Next, we&rsquo;ll need to create an SSSD configuration file. Unfortunately, unlike the example we&rsquo;ll see later with Windows and Active Directory, we&rsquo;ll have to create this one manually. Here&rsquo;s an example of what that would look like. First, we&rsquo;ll open the file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nano /etc/sssd/sssd.conf</span></span></code></pre></div><p>and then put the following contents inside of it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tex data-lang=tex><span class=line><span class=cl>[sssd]
</span></span><span class=line><span class=cl>config<span class=nb>_</span>file<span class=nb>_</span>version = 2
</span></span><span class=line><span class=cl>domains = ldap.cis527russfeld.cs.ksu.edu
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[domain/ldap.cis527russfeld.cs.ksu.edu]
</span></span><span class=line><span class=cl>id<span class=nb>_</span>provider = ldap
</span></span><span class=line><span class=cl>auth<span class=nb>_</span>provider = ldap
</span></span><span class=line><span class=cl>ldap<span class=nb>_</span>uri = ldap://ldap.cis527russfeld.cs.ksu.edu
</span></span><span class=line><span class=cl>cache<span class=nb>_</span>credentials = True
</span></span><span class=line><span class=cl>ldap<span class=nb>_</span>search<span class=nb>_</span>base = dc=ldap,dc=cis527russfeld,dc=cs,dc=ksu,dc=edu</span></span></code></pre></div><p>Notice that we&rsquo;ve customized this file to match our LDAP configuration information from the previous video.</p><p>Also, we must make sure that that file is owned by <code>root:root</code> and only the user has permission to access that file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo chown root:root /etc/sssd/sssd.conf
</span></span><span class=line><span class=cl>sudo chmod <span class=m>600</span> /etc/sssd/sssd.conf</span></span></code></pre></div><p>Finally, we can restart the SSSD service to load the new settings:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart sssd</span></span></code></pre></div><p>If this command returns an error, it usually either means that there is a typo in the <code>sssd.conf</code> file created earlier, or that the file&rsquo;s permissions are incorrect. So, make sure you double-check that if you run into an error at this point.</p><p>Now, let&rsquo;s tackle the creation of home directories. This is handled by the Pluggable Authentication Modules, or PAM, framework. There are many ways to do this, including editing a config file manually. However, there is a quick and easy way to do this as well, using the <code>pam-auth-update</code> command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo pam-auth-update</span></span></code></pre></div><p>In the menu, press the <kbd>SPACE</kbd> key to enable the &ldquo;Create home directory on login&rdquo; option, then press <kbd>ENTER</kbd> to save the changes.</p><p>Finally, we can do some testing to make sure that things are working correctly. First, we&rsquo;ll need to be able to access our LDAP server using its DNS name, so we can test that using dig:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dig ldap.cis527russfeld.cs.ksu.edu</span></span></code></pre></div><p>Hopefully you were able to get your LDAP server working in the previous lab. If not, you may load some of the model solution files from Lab 3 provided on Canvas to get this part working.</p><p>Next, we&rsquo;ll make sure we can access the LDAP server</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ldapwhoami -x -h ldap.cis527russfeld.cs.ksu.edu</span></span></code></pre></div><p>This command should return <code>anonymous</code>. If not, your <strong>CLIENT</strong> VM is having trouble contacting your <strong>SERVER</strong> VM or the LDAP server itself. In that case, you may want to check your firewall configuration - did you remember to allow the correct ports for LDAP?</p><p>Once that command works, we can try it again using TLS by adding <code>-ZZ</code> to the command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ldapwhoami -x -ZZ -h ldap.cis527russfeld.cs.ksu.edu</span></span></code></pre></div><p>Hopefully this command should return <code>anonymous</code> just like it did previously. If not, there is probably a configuration issue with your TLS certificates that you&rsquo;ll need to resolve before moving on.</p><p>Finally, if everything looks like it is working, we can try to load information about one of our LDAP users using the <code>getent</code> command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>getent passwd russfeld</span></span></code></pre></div><p>This command should return information about the user we created on our LDAP server. If not, then we may need to check the settings in our <code>sssd.conf</code> file to make sure the LDAP information is correct.</p><p>Thankfully, if that worked, we can try to log on to the system as that user using the <code>su</code> command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>su russfeld</span></span></code></pre></div><p>It works! We can even go to our home directory and see that it was created for us:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/
</span></span><span class=line><span class=cl>pwd</span></span></code></pre></div><p>Now, at this point, I should point out one very important impact of how our system is configured. I am logged in as an LDAP user, but notice that if I try to log in as root, I&rsquo;m able to use <code>sudo</code> without any additional configuration! <strong>Yikes!</strong></p><p>How did that happen? It actually is due to a setting in our <code>sudoers</code> file that is present by default on all Ubuntu systems. Let&rsquo;s take a look at that file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo visudo</span></span></code></pre></div><p>If we look through that file, we&rsquo;ll find a line that says members of the <code>admin</code> group may gain root privileges. In fact, that&rsquo;s exactly what happened! Just because we chose to name our group <code>admin</code> on the LDAP server, our users would automatically gain <code>sudo</code> access on any system they log into. The same would happen for a group named <code>sudo</code> as well. So, it is very important to make sure your groups on your LDAP server use unique names, otherwise you may inadvertently create a major security hole in your systems.</p><p>To test the graphical login, you&rsquo;ll need to fully reboot your computer. Once that is done, you can click the &ldquo;Not listed?&rdquo; option at the bottom of the list of users, then enter the credentials for your LDAP user to log in. If everything is configured correctly, it should let you log in directly to the system.</p><p>You have now successfully configured your system to allow Ubuntu to use LDAP servers for user accounts. This should be enough information to help you complete that section of Lab 4. As always, if you have any questions, feel free to post in the course discussion forums on Canvas. Good luck!</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=linux-client-on-windows-domain>Linux Client on Windows Domain</h1><a href="https://www.youtube.com/watch?v=uyie_GWK2zw">YouTube Video</a><h4 id=resources>Resources</h4><ul><li><a href=https://ubuntu.com/server/docs/how-to-set-up-sssd-with-active-directory rel=external target=_blank>SSSD and Active Directory</a> from Ubuntu</li><li><a href="https://www.server-world.info/en/note?os=Ubuntu_20.04&p=realmd" rel=external target=_blank>Join in Active Directory Domain</a> from Server-World (works for 24.04)</li><li><a href=https://computingforgeeks.com/join-ubuntu-debian-to-active-directory-ad-domain/ rel=external target=_blank>How to Join Ubuntu 18.04 / Debian 10 To Active Directory (AD) Domain</a> from Computingforgeeks (works for 24.04)</li></ul><h4 id=video-transcript>Video Transcript</h4><p>In the following two videos, we&rsquo;ll look at how to enable interoperability between our Windows- and Linux-based systems. In many organizations today, you&rsquo;ll have a mix of many different operating systems, so it is very helpful to understand how to integrate them together in a single directory service.</p><p>In this video, I&rsquo;ll show you how to add an Ubuntu VM to a Windows Active Directory Domain. This is by far the most common use-case for interoperability, and has been used by many organizations including K-State. For most users, Windows Active Directory provides a great set of features for Windows-based systems, and it is simple to integrate Linux and Mac clients into that environment.</p><p>For this example, I&rsquo;m using the Windows 2019 server set up as defined in Lab 4&rsquo;s assignment. I&rsquo;ve reconfigured the domain to have the fully qualified domain name <code>ad.cis527russfeld.cs.ksu.edu</code> for this example, as you would in a real environment. This is due to the fact that many Linux packages do not accept the <code>.local</code> top-level domain I used in the previous video as an example.</p><p>For the client, I am using a copy of my Ubuntu 20.04 VM labelled <strong>CLIENT</strong> from Lab 3. For this assignment, you&rsquo;ll use that same VM, but restored to a snapshot taken before it was configured as a client for OpenLDAP. Remember that you&rsquo;ll need create this snapshot before you start the Lab 4 assignment, or else you may need to create a new VM for this activity.</p><p>Finally, I&rsquo;ve found there really isn&rsquo;t a great guide for doing this online, but I&rsquo;m generally following the instructions in the Server-World guide linked below this video. I&rsquo;ll do my best to clarify what parts are important and what parts I leave out and why.</p><p>First, as with any client I wish to add to a domain, I&rsquo;ll need to set a static DNS entry to point to the domain controller itself. For the second entry, I&rsquo;ll just use the VMware router as always. Once I&rsquo;ve done that, I&rsquo;ll disable and enable the network connection so that my changes take effect.</p><p>Then, I&rsquo;ll need to install the <code>realmd</code> package. This package allows us to interface with Active Directory Domain servers.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt update
</span></span><span class=line><span class=cl>sudo apt install realmd</span></span></code></pre></div><p>The instructions found online typically have you install a large number of packages at this step, but don&rsquo;t do a good job of describing what they are used for. Thankfully, Ubuntu 20.04 includes a special program called <code>packagekit</code> by default, which allows us to automatically install the packages we need as we need them. So, we&rsquo;ll start by just installing <code>realmd</code> and going from there.</p><p>Once we have <code>realmd</code> installed, we can use it to query our Active Directory domain using the <code>realm discover</code> command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>realm discover ad.cis527russfeld.cs.ksu.edu</span></span></code></pre></div><p>If that command works correctly, you should see output giving information about the Active Directory Domain we just queried. However, if you get an error at this step, that usually means that something isn&rsquo;t working correctly. In that case, double-check that you have properly set your DNS entries, and that you can ping your Windows 2019 server using both the IP address and the Active Directory Domain name. You&rsquo;ll need to be able to use DNS to resolve that domain name in order for this system to join the domain.</p><p>Once we are ready to join the domain, we can simply using the <code>sudo realm join</code> command.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo realm join ad.cis527russfeld.cs.ksu.edu</span></span></code></pre></div><p>Once we enter that command, we&rsquo;ll be prompted for the password for the <code>Administrator</code> account. This is the <code>Administrator</code> account of our Active Directory domain, so we&rsquo;ll have to provide the correct password here.</p><p>Here&rsquo;s where the cool part happens. The <code>realmd</code> program is smart enough to know what packages we need in order to interface with an Active Directory domain, and because we have <code>packagekit</code> installed on Ubuntu 20.04 by default, the <code>realmd</code> command can automatically install those packages when we use the <code>realm join</code> command. So, we don&rsquo;t have to worry about remembering to install all of these packages manually - it is done for us automatically! Very handy!</p><p>Ok, now that we have joined the domain, we can see if we can get information about an Active Directory user account using the <code>id</code> command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>id russfeld@ad.cis527russfeld.cs.ksu.edu</span></span></code></pre></div><p>If everything is working correctly, you should see some information about that user printed to the screen. If not, you&rsquo;ll need to do some troubleshooting.</p><p>Now, we can even log in as that user using the <code>su</code>, or &ldquo;switch user&rdquo; command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>su russfeld@ad.cis527russfeld.cs.ksu.edu</span></span></code></pre></div><p>There we go! We are now logged in to this system as one of our Active Directory users. However, there are couple of things we can do to improve this experience. First, notice that we have to enter our fully qualified domain name for our Active Directory domain to log in. That can get really annoying, espeically with a long domain like ours. Also, what if we try to check our home directory:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/</span></span></code></pre></div><p>We find out that this user doesn&rsquo;t even have a home directory to store files in. That&rsquo;s no good!</p><p>So, let&rsquo;s log out of this user and try to fix these issues.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>exit</span></span></code></pre></div><p>First, let&rsquo;s change a setting so that we don&rsquo;t have to enter the full Active Directory Domain name each time we want to log in as one of those users. To do that, we&rsquo;ll edit the <code>sssd</code> configuration file. The <code>sssd</code> package helps provide access to authentication resources across many different sources.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nano /etc/sssd/sssd.conf</span></span></code></pre></div><p>In that file, we&rsquo;ll see a line like the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tex data-lang=tex><span class=line><span class=cl>use<span class=nb>_</span>fully<span class=nb>_</span>qualified<span class=nb>_</span>names = True</span></span></code></pre></div><p>We&rsquo;ll simply set that setting to <code>False</code> and then save the file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tex data-lang=tex><span class=line><span class=cl>use<span class=nb>_</span>fully<span class=nb>_</span>qualified<span class=nb>_</span>names = False</span></span></code></pre></div><p>Finally, we can restart the <code>sssd</code> daemon to load the new settings.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart sssd</span></span></code></pre></div><p>Now, we can use the <code>id</code> command with just the username:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>id russfeld</span></span></code></pre></div><p>and we should get the correct info. We can even use that username to log in to the system using the <code>su</code> command.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>su russfeld
</span></span><span class=line><span class=cl>exit</span></span></code></pre></div><p>Yay! Now, let&rsquo;s tackle the creation of home directories. This is handled by the Pluggable Authentication Modules, or PAM, framework. There are many ways to do this, including editing a config file manually. However, there is a quick and easy way to do this as well, using the <code>pam-auth-update</code> command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo pam-auth-update</span></span></code></pre></div><p>In the menu, press the <kbd>SPACE</kbd> key to enable the &ldquo;Create home directory on login&rdquo; option, then press <kbd>ENTER</kbd> to save the changes.</p><p>There we go! Now, when we log in as our domain user, it will automatically create a home directory for us:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>su russfeld
</span></span><span class=line><span class=cl><span class=nb>cd</span> ~/
</span></span><span class=line><span class=cl>pwd</span></span></code></pre></div><p>Awesome! Now, one interesting thing to discuss at this point is the fact that many online tutorials require us to install the <code>oddjob</code> and <code>oddjob-mkhomedir</code> packages. As far as I can tell, these are only required if we are using <code>selinux</code> instead of <code>apparmor</code> to protect our system. Since we aren&rsquo;t doing that, we&rsquo;ll just leave this out for now. However, if you do decide to use <code>selinux</code> on your system, you may have to do some additional configuration in order for your home directories to be properly created.</p><p>Ok, the last thing we may want to tackle on this system is the ability for our domain users to log on graphically. In previous versions of Ubuntu, this required a bit more configuration. However, in Ubuntu 20.04, all we have to do is restart the system to reload a few of the changes we just made. Then, we can click the &ldquo;Not listed?&rdquo; option at the bottom of the login window, and enter our domain username and password.</p><p>Voila! That&rsquo;s all it takes to log on graphically using an Active Directory domain user account on Ubuntu 20.04. The process has gotten much simpler over the years, to the point where it isn&rsquo;t that much more difficult than adding a Windows 10 client to a domain.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=windows-client-on-linux-domain>Windows Client on Linux Domain</h1><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p><em>This portion is no longer part of the Lab 4 assignment, but I left it here because it is interesting to know that it can be done. &ndash;Russ</em></p></div></div><a href="https://www.youtube.com/watch?v=t3ESN_EXGGw">YouTube Video</a><h4 id=resources>Resources</h4><ul><li><a href=https://www.techrepublic.com/article/how-to-configure-ubuntu-linux-server-as-a-domain-controller-with-samba-tool/ rel=external target=_blank>How to Configure Ubuntu Linux Server as a Domain Controller with Samba-tool</a> by Jack Wallen on TechRepublic</li><li><a href=https://unix.stackexchange.com/questions/341226/samba-not-starting-on-ubuntu-server-16-10 rel=external target=_blank>Samba Not Starting on Ubuntu Server 16.10</a> from StackExchange</li><li><a href=https://askubuntu.com/questions/907246/how-to-disable-systemd-resolved-in-ubuntu rel=external target=_blank>How to Disable Systemd-resolved in Ubuntu</a> from AskUbuntu</li></ul><h4 id=video-transcript>Video Transcript</h4><p>In this video, I&rsquo;ll show you how to set up an Ubuntu VM to act as a Windows Active Directory Domain Controller using Samba. Unfortunately, at this time it is not straightforward at all to use OpenLDAP as the server, hence the decision to use Samba instead. This is a much more complicated process than adding Ubuntu as a client to an existing Active Directory Domain, but I feel that it is important to see that it is indeed possible. This is helpful if your organization is primarily Linux-based, but you wish to include a few Windows clients on the network as well.</p><p>For this example, I&rsquo;m using the Ubuntu VM labelled <strong>Client</strong> from earlier in this lab. I&rsquo;ve created a snapshot to store the work done previously to add it to an OpenLDAP domain, but now I&rsquo;ve restored the snapshot labelled &ldquo;Before Lab 4&rdquo; and will use that snapshot to create a Samba server. The reason I am doing this on the VM labelled <strong>Client</strong> and not the one labelled <strong>Server</strong> is because the Samba installation will directly conflict with Bind9, OpenLDAP, and many other tools we&rsquo;ve already installed on the server. So, this allows us to avoid any conflicts with those tools.</p><p>For the client, I have restored my Windows 10 VM to a snapshot taken before it was added to my Active Directory Domain. Remember that you&rsquo;ll need to create this snapshot before you start the Lab 4 assignment, or else you may need to create a new VM for this activity.</p><p>Finally, I&rsquo;ll generally be following the great guide by Jack Wallen that is linked in the resources section below this video, but I&rsquo;ll be making a few minor changes to match our environment and clarifying a few things that he leaves out.</p><p>Before we begin, we&rsquo;ll need to set a static IP on this system, since it will be acting as a server. I&rsquo;m going to use the IP ending in <code>45</code> in my local subnet. For the DNS entries, we&rsquo;ll also need to set the first entry to be this system itself, just like we did with the Windows Domain Controller. The second DNS entry can be the VMware router or any other valid DNS server.</p><p>First, we&rsquo;ll need to install Samba as well as a few supporting tools:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt update
</span></span><span class=line><span class=cl>sudo apt install samba libpam-winbind smbclient</span></span></code></pre></div><p>This will install many supporting packages as well.</p><p>Next, we need to make a few edits to our <code>hosts</code> file as well as update our hostname. This will help Samba find the correct settings as we configure it in a later step. First, let&rsquo;s edit the <code>hosts</code> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nano /etc/hosts</span></span></code></pre></div><p>I&rsquo;ll need to add or edit a few entries at the top of this file. Here&rsquo;s what mine currently looks like:</p><div class=highlight><pre tabindex=0><code>127.0.0.1       localhost.localdomain
127.0.1.1       dc
192.168.40.41   localhost
192.168.40.41   smbrussfeld.cis527.cs.ksu.edu       smbrussfeld
192.168.40.41   dc.smbrussfeld.cis527.cs.ksu.edu    dc</code></pre></div><p>The first line is updated to be <code>localhost.localdomain</code>, just to make it clear that that IP address is for the loopback adapter. The second line gives the new hostname for this system. In this case, I&rsquo;m calling it <code>dc</code> for domain controller. The third line redirects the <code>localhost</code> domain name to the external IP address. Finally, the fourth and fifth lines give the name of the domain as well as the fully qualified domain name for this system, respectively.</p><p>To go along with this change, we&rsquo;ll edit the <code>hostname</code> file as well:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nano /etc/hostname</span></span></code></pre></div><p>It should now be the same as the hostname used in the <code>hosts</code> file:</p><div class=highlight><pre tabindex=0><code>dc</code></pre></div><p>Finally, we&rsquo;ll need to restart the computer for these changes to take effect.</p><p>Once it has restarted, we&rsquo;ll need to remove any existing Samba configuration files and database files.</p><p>Thankfully, there are some great commands for finding the location of those files. First, you can find the location of the config file using this command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>smbd -b <span class=p>|</span> grep <span class=s2>&#34;CONFIGFILE&#34;</span></span></span></code></pre></div><p>It is usually at <code>/etc/samba/smb.conf</code>. So, to delete it, you&rsquo;ll use:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo rm -f /etc/samba/smb.conf</span></span></code></pre></div><p>Next, you can find the locations of all database files using this command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>smbd -b <span class=p>|</span> egrep <span class=s2>&#34;LOCKDIR|STATEDIR|CACHEDIR|PRIVATE_DIR&#34;</span></span></span></code></pre></div><p>It should give you four different directory paths. So, for each of those directories, you&rsquo;ll need to enter that directory, then delete all files with the <code>.tdb</code> and <code>.ldb</code> file extensions. So, for the first one, you could use these commands:</p><div class=highlight><pre tabindex=0><code>cd /var/run/samba
sudo rm -f *.tdb *.ldb</code></pre></div><p>Repeat that process for the other three directories to make sure they are all clear.</p><p>Once that is done, it is time to create our new domain. We&rsquo;ll use the <code>samba-tool</code> command to do this in interactive mode:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo samba-tool domain provision --use-rfc2307 --interactive</span></span></code></pre></div><p>First, it will ask you for the realm. For this example, I&rsquo;ll use the name <code>smbrussfeld.cis527.cs.ksu.edu</code>. Following that, it should ask you for the NetBIOS name of your domain. The default should be <code>smbrussfeld</code>, which is fine. You can also accept the defaults of <code>dc</code> for the server role, and <code>SAMBA_INTERNAL</code> for the DNS backend. For the DNS forwarder address, you can use the VMware router&rsquo;s IP address, or any other valid DNS server address from Lab 3. Finally, you&rsquo;ll need to enter a password for the Administrator account. I&rsquo;ll use the same password as always.</p><p>Once you&rsquo;ve entered that information, your domain will be configured. Now, we&rsquo;ll need to add a user to Samba and enable it using the following commands:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo smbpasswd -a &lt;username&gt;
</span></span><span class=line><span class=cl>sudo smbpasswd -e &lt;username&gt;</span></span></code></pre></div><p>Next, we&rsquo;ll need to disable the <code>systemd-resolved</code> service. This service is installed by default on Ubuntu 18.04, and is responsible for caching local DNS queries. However, since it binds to port 53, it will prevent our Samba server from binding to that port. To disable it, we&rsquo;ll use the following commands:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl disable systemd-resolved
</span></span><span class=line><span class=cl>sudo systemctl stop systemd-resolved</span></span></code></pre></div><p>We&rsquo;ll also need to disable the existing Samba services, and enable the Samba Domain Controller service:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl disable nmbd
</span></span><span class=line><span class=cl>sudo systemctl stop nmbd
</span></span><span class=line><span class=cl>sudo systemctl disable smbd
</span></span><span class=line><span class=cl>sudo systemctl stop smbd
</span></span><span class=line><span class=cl>sudo systemctl unmask samba-ad-dc
</span></span><span class=line><span class=cl>sudo systemctl <span class=nb>enable</span> samba-ad-dc
</span></span><span class=line><span class=cl>sudo systemctl start samba-ad-dc</span></span></code></pre></div><p>Lastly, we&rsquo;ll need to replace any existing Kerberos configuration file with the one created by Samba. So, you&rsquo;ll perform these commands to delete the existing file (if any) and create a symbolic link to the one from Samba.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo mv /etc/krb5.conf /etc/krb5.conf.orig
</span></span><span class=line><span class=cl>​sudo ln -sf /var/lib/samba/private/krb5.conf /etc/krb5.conf</span></span></code></pre></div><p>If you get an error from the first command, you can safely ignore it.</p><p>Finally, if everything is configured correctly, we can query our domain using the <code>smbclient</code> command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>smbclient -L localhost -U%</span></span></code></pre></div><p>Hopefully you should get output from that command giving information about your domain. If not, you&rsquo;ll probably need to review the Samba log file stored in <code>/var/log/samba/log.samba</code> to see what the error is.</p><p>If everything is working correctly, you can then add your Windows 10 VM to the domain. First, as with any client I wish to add to a domain, I&rsquo;ll need to set a static DNS entry to point to the domain controller itself. For the second entry, I&rsquo;ll just use the VMware router as always. Then, I can add it to the domain following the instructions in the earlier video.</p><p>After a reboot, it should allow you to log in as the domain user created earlier.</p><p>It is quite a process, but hopefully this demonstrates what it takes to create an Active Directory Domain using Samba. I highly recommend that you try this process at least once, even if you don&rsquo;t plan on completing it as part of Lab 4, just to see how it all works together.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=ad-and-netbios-names>AD and NETBIOS Names</h1><p>It appears that I have managed to confuse lots of people with the Windows AD portion of this lab. That&rsquo;s not my intent, and any confusion is totally my fault here. This is mostly due to the fact that I reused an older video showing how to set up an Active Directory server and not clearly describing how things should be changed. I&rsquo;ll do my best to clarify what you need to know and how you can adapt any existing setup you may have so that it works.</p><p>When configuring an Active Directory (AD) domain, there are two important settings: the <strong>root domain name</strong> (numbered 1 in the screenshots below) and the <strong>NETBIOS domain name</strong> (numbered 2 in the screenshots below).</p><p>In an ideal setup, those names are closely related. Typically, if the <strong>root domain name</strong> is <code>ad.russfeld.cis527.org</code> then the <strong>NETBIOS domain name</strong> would be <code>ad</code> - the first part of the <strong>root domain name</strong>. In most cases, you <em>should not change</em> the <strong>NETBIOS domain name</strong> from the default that is proposed by the setup process. (<em>If you did, that&rsquo;s fine - keep reading!</em>)</p><p>In the video for setting up an AD domain, I used a simplified root domain name <code>cis527.local</code>, which meant that my NETBIOS domain name would be <code>cis527</code> as shown in the screenshots below:</p><p><a href=#R-image-f0369e9c20c8db099c5ae784e367e2c8 class=lightbox-link><img alt="Root Domain Name" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis527/images/adds1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f0369e9c20c8db099c5ae784e367e2c8><img alt="Root Domain Name" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis527/images/adds1.png></a></p><p><a href=#R-image-a9e4dc08dc2a3cb582af5382905befac class=lightbox-link><img alt="NETBIOS Domain Name" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis527/images/adds2.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a9e4dc08dc2a3cb582af5382905befac><img alt="NETBIOS Domain Name" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis527/images/adds2.png></a></p><p>For the lab assignment itself, I give you a more concrete desired <strong>root domain name</strong> such as <code>ad.&lt;your eID>.cis527.org</code>. However, I do not specify the <strong>NETBIOS domain name</strong>, which should default to <code>ad</code>. However, you can freely change it, and I believe that the video is leading many students to change that value to either <code>cis527</code> or <code>&lt;your eID></code>. To be clear, you <em>should not change</em> the <strong>NETBIOS domain name</strong> at this step - whatever is proposed by the configuration wizard is correct.</p><p><em><strong>If you&rsquo;ve changed this, that&rsquo;s fine! You&rsquo;ll just have to adapt a couple of things further down the line.</strong></em></p><p>To see how your domain is set up, open the <strong>Active Directory Users and Computers</strong> tool in your Windows Server VM, and find the user you created in the <strong>Users</strong> folder and open it. There should be an <strong>Account</strong> tab that looks like the following screenshot (this is from a different VM setup, so the domain names are purposefully different than what the lab specifies):</p><p><a href=#R-image-829c193cb9fa7e5286096e2c86700b40 class=lightbox-link><img alt="AD Account Tab" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis527/images/adds3.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-829c193cb9fa7e5286096e2c86700b40><img alt="AD Account Tab" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis527/images/adds3.png></a></p><p>In that screenshot, you can clearly see the <strong>root domain name</strong> labelled with the number 1, which is <code>adrussfeld.cis527.cs.ksu.edu</code>, and the <strong>NETBIOS domain name</strong> labelled with number 2 is <code>ADRUSSFELD</code>. This is the VM that I used for creating the <a href=/cis527/4-directory-services/09-linux-client-on-windows-domain/>Linux Client on Windows Domain</a> video that was new for Summer 2020. So, make note of both of these settings in your AD configuration, as you&rsquo;ll need them when trying to log on to the domain or run commands.</p><p>When referencing usernames on an AD domain, there are two basic methods:</p><ol><li><code>&lt;username>@&lt;root domain name></code></li><li><code>&lt;NETBIOS domain name>\&lt;username></code></li></ol><p>So, when I want to log in as that user on Ubuntu, I would use method 1 with the <strong>root domain name</strong> (this is before we change the <code>sssd</code> configuration file to not require the full domain name):</p><p><a href=#R-image-74f1326118400de77713f62400def6c4 class=lightbox-link><img alt="Ubuntu AD Login" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis527/images/adds4.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-74f1326118400de77713f62400def6c4><img alt="Ubuntu AD Login" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis527/images/adds4.png></a></p><p>However, if I want to do the <code>ldapsearch</code> command to search the Windows AD, I&rsquo;ll need to use method 2 with the <strong>NETBIOS domain name</strong>:</p><p><a href=#R-image-c7bc1a9b93aefb933428e397eaf04860 class=lightbox-link><img alt="Ubuntu LDAPSearch" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis527/images/adds5.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c7bc1a9b93aefb933428e397eaf04860><img alt="Ubuntu LDAPSearch" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis527/images/adds5.png></a></p><p>So, you should be able to adapt to whichever method is required, making changes where necessary to make the commands work.</p><p><em><strong>Q: What if my root domain name and NETBIOS domain name are different? For example, my root domain name is <code>ad.&lt;eID>.cis527.org</code> but I set my NETBIOS domain name to <code>cis527&lt;eID></code>.</strong></em></p><p>As far as I can tell, you should still be able to complete Lab 4 with an AD domain configured in this way. The only issues you may run into are when using the <code>realm join</code> command and the <code>ldapsearch</code> commands on Ubuntu. You&rsquo;ll have to pay close attention to which method is being used, and adjust the commands as necessary to fit the situation. So far, I&rsquo;ve worked with at least two students who ran into this issue but were able to get it to work with minimal problems.</p><p>It may also be very important to make sure that both your Windows client and Ubuntu client are configured to use the Windows AD server as the first DNS entry. I usually just set a static DNS entry on each of those systems before joining the domain as directed in the video - in the real world you&rsquo;d have your DHCP server do this for you.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=lab-4-networking-diagrams>Lab 4 Networking Diagrams</h1><p>Here are some helpful networking diagrams to better explain the desired state before and after the end of Lab 4. In all of these diagrams, I am using a sample network with the IP address <code>192.168.40.0</code>. You will have to adapt the IPs to match your network configuration. In addition, each network address will need to be updated with your unique eID as directed in the lab assignment.</p><h3 id=after-lab-3>After Lab 3</h3><p><a href=#R-image-caecc6851513eddce2cc60941c281e6c class=lightbox-link><img alt="After Lab 3" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis527/images/net-afterlab3.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-caecc6851513eddce2cc60941c281e6c><img alt="After Lab 3" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis527/images/net-afterlab3.png></a></p><p>Once you&rsquo;ve completed all of Lab 3, your network diagram should resemble the one shown above. Recall that all systems are currently configured to get DHCP and DNS information from your Ubuntu VM labelled Server, so in general it must be running at all times for this network to function. In addition, the Ubuntu VM labelled Server does not use itself for DNS, but still uses the VMare built-in DNS server, though you may have configured an alternate entry so it can refer to itself for DNS as well. This is the most likely starting point for this lab if you completed Lab 3.</p><h3 id=starting-lab-4-with-a-working-lab-3-solution>Starting Lab 4 with a Working Lab 3 Solution</h3><p><a href=#R-image-b0178900eb0534ad7a5803fb6a151342 class=lightbox-link><img alt="Before Lab 4 with Working Lab 3" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis527/images/net-beforelab4working3.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b0178900eb0534ad7a5803fb6a151342><img alt="Before Lab 4 with Working Lab 3" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis527/images/net-beforelab4working3.png></a></p><p>This diagram shows what an ideal network setup would look like, provided you have a working Lab 3 solution. In Lab 4, most of the changes required to get from the final Lab 3 network to this configuration are spread across multiple tasks. However, here are the major highlights:</p><ol start=0><li><strong>VMware NAT Network</strong> - the built-in DHCP server should still be disabled as it was in Lab 3.</li><li><strong>Ubuntu Server VM</strong> - now uses itself as a primary DNS entry, with an alternate entry set to the VMware DNS server (Lab 4, Task 4). Must be able to resolve <code>ldap.&lt;your eID>.cis527.org</code></li><li><strong>Ubuntu Client VM</strong> - no changes, still gets both DNS and DHCP from the Ubuntu Server VM (Lab 4, Task 5). Must be able to resolve <code>ldap.&lt;your eID>.cis527.org</code></li><li><strong>Windows Server VM</strong> - new VM (Lab 4, Task 1). Should have a static IP address of <code>192.168.40.42</code> and a primary static DNS entry pointing to itself, with an alternate entry set to the Ubuntu Server VM or the VMware DNS server (Lab 4, Task 2). Once the Active Directory server is installed, it should be able to resolve <code>ad.&lt;your eID>.cis527.org</code>.</li><li><strong>Windows 10 VM</strong> - now has a static DNS entry to point to the Windows Server VM, with an alternate entry set to the Ubuntu Server VM or the VMware DNS server (Lab 4, Task 3). Once the Active Directory server is installed, it should be able to resolve <code>ad.&lt;your eID>.cis527.org</code>.</li><li><strong>Ubuntu Client VM - Windows Snapshot</strong> - when configuring the Ubuntu Client VM to connect to Windows Active Directory, it should have a static DNS entry pointing to the Windows Server VM, with an alternate entry set to the Ubuntu Server VM or the VMware DNS server (Lab 4, Task 6). Once the Active Directory server is installed, it should be able to resolve <code>ad.&lt;your eID>.cis527.org</code>.</li></ol><p>This is the ideal setup for a this lab, but it depends on a fully working Lab 3 solution. In addition, you&rsquo;ll need to keep the Ubuntu Server VM running at all times, which may present a problem on systems that struggle to run multiple VMs concurrently. So, below I discuss two alternative options.</p><h4 id=lab-4-alternative-network-setup---option-1-static-dns-entries>Lab 4 Alternative Network Setup - Option 1 (Static DNS Entries)</h4><p><a href=#R-image-e73d428958fa579fefddcb12e336af89 class=lightbox-link><img alt="Before Lab 4 Alternate 1" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis527/images/net-beforelab4alt1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e73d428958fa579fefddcb12e336af89><img alt="Before Lab 4 Alternate 1" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis527/images/net-beforelab4alt1.png></a></p><p>In this diagram, we are bypassing the DHCP server configured in Lab 3, and reverting our network back to using the VMware DHCP server. In addition, we are avoiding using our own DNS server running on the Ubuntu Server VM unless absolutely necessary. So, the following changes are made to the network from Lab 3:</p><ol start=0><li><strong>VMware NAT Network</strong> - the built-in DHCP server must be re-enabled if it was disabled in Lab 3.</li><li><strong>Ubuntu Server VM</strong> - now uses itself as a primary DNS entry, with an alternate entry set to the VMware DNS server (Lab 4, Task 4). The DHCP server that was configured in Lab 3 is disabled using <code>sudo systemctl disable isc-dhcp-server</code>. Must still be able to resolve <code>ldap.&lt;your eID>.cis527.org</code></li><li><strong>Ubuntu Client VM</strong> - now gets a DHCP address from VMware. We must set a primary static DNS entry to point to the Ubuntu Server VM, with an alternate entry set to the VMware DNS server (Lab 4, Task 5). Must be able to resolve <code>ldap.&lt;your eID>.cis527.org</code></li><li><strong>Windows Server VM</strong> - new VM (Lab 4, Task 1). Should have a static IP address of <code>192.168.40.42</code> and a primary static DNS entry pointing to itself, with an alternate entry set to the the VMware DNS server (Lab 4, Task 2). Once the Active Directory server is installed, it should be able to resolve <code>ad.&lt;your eID>.cis527.org</code>.</li><li><strong>Windows 10 VM</strong> - now has a static DNS entry to point to the Windows Server VM, with an alternate entry set to the VMware DNS server (Lab 4, Task 3). Once the Active Directory server is installed, it should be able to resolve <code>ad.&lt;your eID>.cis527.org</code>.</li><li><strong>Ubuntu Client VM - Windows Snapshot</strong> - when configuring the Ubuntu Client VM to connect to Windows Active Directory, it should have a static DNS entry pointing to the Windows Server VM, with an alternate entry set to the VMware DNS server (Lab 4, Task 6). Once the Active Directory server is installed, it should be able to resolve <code>ad.&lt;your eID>.cis527.org</code>.</li></ol><p>In effect, each system that is getting automatic IP addresses is now using the VMware DHCP server. However, since that DHCP server does not give the correct DNS addresses, we must set static DNS entries on <strong>everything</strong>, with the Ubuntu Server VM and Ubuntu Client VM pointing to the DNS server running on the Ubuntu Server VM, and the Windows Server, Windows 10 Client, and the Ubuntu Client VM&rsquo;s Windows Snapshot pointing to the DNS server running on the Windows Server (after Active Directory is installed). In addition, each of those systems should have an alternate DNS entry that points to the VMware DNS server, allowing them to still access the internet properly.</p><p>However, if you are still having issues with your DNS entries or DNS servers not working correctly, fear not! There is one more alternative option available to you.</p><h4 id=lab-4-alternative-network-setup---option-2-hosts-file-entries>Lab 4 Alternative Network Setup - Option 2 (Hosts File Entries)</h4><p><a href=#R-image-7edeb757a787a843c6815cd73619f5d0 class=lightbox-link><img alt="Before Lab 4 Alternate 2" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis527/images/net-beforelab4alt2.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-7edeb757a787a843c6815cd73619f5d0><img alt="Before Lab 4 Alternate 2" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis527/images/net-beforelab4alt2.png></a></p><p>In this diagram, we are bypassing the DHCP server configured in Lab 3, and reverting our network back to using the VMware DHCP server. In addition, we are avoiding using our own DNS server running on the Ubuntu Server VM unless absolutely necessary. Finally, we are adding entries to the <code>hosts</code> file on each system to bypass DNS completely, ensuring that we can still complete this lab even if our DNS systems are not working at all. So, the following changes are made to the network from Lab 3:</p><ol start=0><li><strong>VMware NAT Network</strong> - the built-in DHCP server must be re-enabled if it was disabled in Lab 3.</li><li><strong>Ubuntu Server VM</strong> - now uses itself as a primary DNS entry, with an alternate entry set to the VMware DNS server (Lab 4, Task 4). The DHCP server that was configured in Lab 3 is disabled using <code>sudo systemctl disable isc-dhcp-server</code>. Must still be able to resolve <code>ldap.&lt;your eID>.cis527.org</code>. If it cannot, add an entry to the <code>/etc/hosts</code> file that links <code>192.168.40.41</code> to <code>ldap.&lt;your eID>.cis527.org</code>.</li><li><strong>Ubuntu Client VM</strong> - now gets a DHCP address from VMware. We must set a primary static DNS entry to point to the Ubuntu Server VM, with an alternate entry set to the VMware DNS server (Lab 4, Task 5). Must be able to resolve <code>ldap.&lt;your eID>.cis527.org</code>. If it cannot, add an entry to the <code>/etc/hosts</code> file that links <code>192.168.40.41</code> to <code>ldap.&lt;your eID>.cis527.org</code>.</li><li><strong>Windows Server VM</strong> - new VM (Lab 4, Task 1). Should have a static IP address of <code>192.168.40.42</code> and a primary static DNS entry pointing to itself, with an alternate entry set to the the VMware DNS server (Lab 4, Task 2). Once the Active Directory server is installed, it should be able to resolve <code>ad.&lt;your eID>.cis527.org</code>. If it cannot, you are better off just rebuilding your AD server - this should always work on a working AD server!</li><li><strong>Windows 10 VM</strong> - now has a static DNS entry to point to the Windows Server VM, with an alternate entry set to the VMware DNS server (Lab 4, Task 3). Once the Active Directory server is installed, it should be able to resolve <code>ad.&lt;your eID>.cis527.org</code>. If it cannot, add an entry to the <code>C:\Windows\System32\drivers\etc\hosts</code> file that links <code>192.168.40.42</code> to <code>ad.&lt;your eID>.cis527.org</code>.</li><li><strong>Ubuntu Client VM - Windows Snapshot</strong> - when configuring the Ubuntu Client VM to connect to Windows Active Directory, it should have a static DNS entry pointing to the Windows Server VM, with an alternate entry set to the VMware DNS server (Lab 4, Task 6). Once the Active Directory server is installed, it should be able to resolve <code>ad.&lt;your eID>.cis527.org</code>. If it cannot, add an entry to the <code>/etc/hosts</code> file that links <code>192.168.40.42</code> to <code>ad.&lt;your eID>.cis527.org</code>.</li></ol><p>In essence, we still configure each system with the correct static DNS entries. However, as a fallback in case those DNS entries are not working properly, we can use entries in the <code>hosts</code> file to bypass DNS completely and guarantee that we&rsquo;re always going to get to the correct system.</p><p>This is a very useful workaround, and while an <em>ideal</em> network in the real world shouldn&rsquo;t require it, many times system administrators include entries in the <code>hosts</code> file to ensure that systems can still be used in the event of DNS failure. Otherwise, an innocuous DNS failure could prevent users from even logging on to the system, either via LDAP or Active Directory.</p><p>As shown in the diagram above, the only DNS entry that <strong>must</strong> work is the Windows Server VM must be able to use itself for DNS. If that does not work, then most likely your Active Directory configuration failed and you will need to try again. Windows Active Directory relies heavily on DNS to function properly. I&rsquo;ve not ever had this happen in my experience, so I highly doubt this failure case will be common.</p><p>You can find more information about how to edit your hosts file at <a href=https://www.ionos.com/digitalguide/server/configuration/hosts-file/ rel=external target=_blank>this resource</a>.</p><footer class=footline></footer></article></section></div></main><div class=git-footer><p class=theme-version-footer>6.0.0</p><p>Last modified by:
<i class='fas fa-user'></i> Russell Feldhausen
<i class='fas fa-calendar'></i> <a href=https://github.com/ksu-cs-textbooks/cis527/commit/84061ea45bef3eaeed1adfe99c235e8c52dcaff8>Aug 10, 2023</a></p></div></div><script src=/cis527/js/clipboard.min.js?1727902057 defer></script><script src=/cis527/js/perfect-scrollbar.min.js?1727902057 defer></script><script src=/cis527/js/theme.js?1727902057 defer></script></body></html>