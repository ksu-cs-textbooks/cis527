




	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.117.0">
    <meta name="generator" content="Relearn 5.18.0">
    <meta name="description" content="CIS 527 Textbook">
    <meta name="author" content="Russell Feldhausen">
    <title>Bind Troubleshooting :: CIS 527 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cis527/3-core-networking-services/17-bind-troubleshooting/index.html" rel="canonical" type="text/html" title="Bind Troubleshooting :: CIS 527 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis527/3-core-networking-services/17-bind-troubleshooting/index.xml" rel="alternate" type="application/rss+xml" title="Bind Troubleshooting :: CIS 527 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis527/3-core-networking-services/17-bind-troubleshooting/index.print.html" rel="alternate" type="text/html" title="Bind Troubleshooting :: CIS 527 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis527/3-core-networking-services/17-bind-troubleshooting/embed.html" rel="alternate" type="text/html" title="Bind Troubleshooting :: CIS 527 Textbook">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/fontawesome-all.min.css?1691705255" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis527/css/fontawesome-all.min.css?1691705255" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/nucleus.css?1691705255" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/auto-complete.css?1691705255" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis527/css/auto-complete.css?1691705255" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/perfect-scrollbar.min.css?1691705255" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/fonts.css?1691705255" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis527/css/fonts.css?1691705255" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/theme.css?1691705255" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/theme-auto.css?1691705255" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/variant.css?1691705255" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/print.css?1691705255" rel="stylesheet" media="print">
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/ie.css?1691705255" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cis527/js/url.js?1691705255"></script>
    <script src="https://ksu-cs-textbooks.github.io/cis527/js/variant.js?1691705255"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="https://ksu-cs-textbooks.github.io/cis527/index.search.js";
      var root_url="https://ksu-cs-textbooks.github.io/cis527/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cis527/';
      window.variants && variants.init( [ 'auto', 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/custom.css?1691705255" rel="stylesheet">

  </head>
  <body class="mobile-support tele disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cis527/3-core-networking-services/17-bind-troubleshooting/index.html">
    
    <div id="tele" class="tele mirror">
    
    <div id="body" class="default-animation">
      
      
      
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>
<h1 id="bind-troubleshooting">Bind Troubleshooting</h1>

<p>As I was reworking this lab for the Summer 2020 semester, I ran into a few issues getting my own bind9 server to work. In doing so, I ended up taking some great screenshots of common misconfigurations of bind9 and the related output from using the <code>dig</code> command to diagnose the issue. I figured it would be helpful to share those screenshots here to give you a nice guide to some common errors you may encounter when working with bind9.</p>
<h2 id="incorrect-screenshots">Incorrect Screenshots</h2>
<h4 id="bad-ptr-response">Bad PTR Response</h4>
<p>
<a href="#image-e443c6f5946c3c3f34fd60bfaae6406a" class="lightbox-link">
<img src="../../images/lab3-badresponse.png" alt="192.168.40.41 bad" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-e443c6f5946c3c3f34fd60bfaae6406a">
<img src="../../images/lab3-badresponse.png" alt="192.168.40.41 bad" class="lightbox-image" loading="lazy">
</a></p>
<p>In this screenshot, I attempted to do a reverse lookup of <code>192.168.40.41</code>, which should resolve to <code>ns.cis527russfeld.cs.ksu.edu</code>. This test was done from the machine with that IP address. Unfortunately, my server was misconfigured, and the reverse zone file was not properly included (the path in my <code>named.conf.local</code> file had a typo, to be exact). Since that file was not availble, my system returned the response from it&rsquo;s local DNS information, showing that the IP address <code>192.168.40.41</code> belongs to <code>cis527U-russfeld.</code>, which is the name of the actual computer and not its name in the DNS system. This can happen if you try to request information about the local system and the DNS server does not contain the correct information.</p>
<h4 id="no-ptr-response">No PTR Response</h4>
<p>
<a href="#image-da877c24b802bdb1af4aed62a261606e" class="lightbox-link">
<img src="../../images/lab3-noresponse.png" alt="192.168.40.42 no response" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-da877c24b802bdb1af4aed62a261606e">
<img src="../../images/lab3-noresponse.png" alt="192.168.40.42 no response" class="lightbox-image" loading="lazy">
</a></p>
<p>With the same misconfiguration as described above, when I query a different system, such as <code>192.168.40.42</code>, I instead get an empty response as shown here. This is the usual situation if the DNS server is misconfigured and the PTR record cannot be found. If the output of <code>dig</code> is missing an answer section, it usually indicates that the lookup failed.</p>
<h4 id="missing-period">Missing Period</h4>
<p>
<a href="#image-e764434cd696ce103302e6d3463e5193" class="lightbox-link">
<img src="../../images/lab3-reversebad1.png" alt="192.168.40.41 no period" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-e764434cd696ce103302e6d3463e5193">
<img src="../../images/lab3-reversebad1.png" alt="192.168.40.41 no period" class="lightbox-image" loading="lazy">
</a></p>
<p>So, I corrected my error and restarted my bind9 server, and once again tried to query one of my reverse lookup addresses. However, in this case, I <em>did</em> get a response from the DNS server, but it was incorrect. The address returned when I queried <code>192.168.40.42</code> as <code>windows.cis527russfeld.cs.ksu.edu.40.168.192.in-addr.arpa</code>, which is not what I wanted. This can happen when you forget to add the <strong>all important period</strong> at the end of an entry in your zone file.</p>
<p>
<a href="#image-46a8f16667bd4717afc5cf432174d23d" class="lightbox-link">
<img src="../../images/lab3-period.png" alt="Period" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-46a8f16667bd4717afc5cf432174d23d">
<img src="../../images/lab3-period.png" alt="Period" class="lightbox-image" loading="lazy">
</a></p>
<p>That one, right there. If you forget that one, the bind9 DNS server will automatically append a whole bunch of domain information after the address. Sometimes we want that, but in this case, we don&rsquo;t. So, be <em>very</em> careful and don&rsquo;t forget the periods.</p>
<h4 id="dns-caching">DNS Caching</h4>
<p>
<a href="#image-3a6ed5e7db0cebc4ad05d5e79e73d516" class="lightbox-link">
<img src="../../images/lab3-flushcache.png" alt="192.168.40.41 fail after fix" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-3a6ed5e7db0cebc4ad05d5e79e73d516">
<img src="../../images/lab3-flushcache.png" alt="192.168.40.41 fail after fix" class="lightbox-image" loading="lazy">
</a></p>
<p>In this screenshot, I had just resolved the error above and restarted my bind9 server to load the newly changed files. Then, I once again used <code>dig</code> to query <code>192.168.40.42</code>, expecting to see the correct output. Instead, I still received the incorrect output as seen in the screenshot above. This is a very common problem!</p>
<p>There can be a couple of causes of this issue. First, whenever you update a zone file, don&rsquo;t forget to change the serial value to a larger number. The DigitalOcean guide just has you start with 2 and go to 3 and so on. I like to use the date, followed by a serial for that day. So, I would use a serial such as <code>202005061</code> for the first update made on May 6th, 2020 (2020-05-06).</p>
<p>Secondly, even if you remember to do that, many modern systems employ some form of <em>DNS caching</em> that stores the responses from previous queries. Both Ubuntu and Windows do this automatically. So, you may also have to clear your DNS cache to make sure it is properly querying the server. On Ubuntu, use <code>sudo systemd-resolve --flush-caches</code> and on Windows use <code>ipconfig /flush-dns</code>.</p>
<p>
<a href="#image-4a669fde5519f14968edaf2d3f24a177" class="lightbox-link">
<img src="../../images/lab3-flushcache2.png" alt="192.168.40.41 fail after fix" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-4a669fde5519f14968edaf2d3f24a177">
<img src="../../images/lab3-flushcache2.png" alt="192.168.40.41 fail after fix" class="lightbox-image" loading="lazy">
</a></p>
<p>Immediately after flushing the DNS cache, I was able to perform the query again and get the correct result.</p>
<h2 id="correct-screenshots">Correct Screenshots</h2>
<p>Below are screenshots showing correct output for various <code>dig</code> commands. You may use these screenshots to help in your debugging process. To take these screenshots, I updated the static IP address configuration for the Ubuntu Server to use it&rsquo;s own IP address <code>192.168.40.41</code> as the only DNS server.</p>
<h4 id="correct-a-records">Correct A Records</h4>
<p>
<a href="#image-b5f761cd43cabc2a7ae2ab513fc1b8b9" class="lightbox-link">
<img src="../../images/lab3-dig1.png" alt="ns.cis527russfeld.cs.ksu.edu" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-b5f761cd43cabc2a7ae2ab513fc1b8b9">
<img src="../../images/lab3-dig1.png" alt="ns.cis527russfeld.cs.ksu.edu" class="lightbox-image" loading="lazy">
</a>

<a href="#image-28b5213a574df19023c4a22ff5b8d006" class="lightbox-link">
<img src="../../images/lab3-dig2.png" alt="windows.cis527russfeld.cs.ksu.edu" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-28b5213a574df19023c4a22ff5b8d006">
<img src="../../images/lab3-dig2.png" alt="windows.cis527russfeld.cs.ksu.edu" class="lightbox-image" loading="lazy">
</a></p>
<h4 id="correct-cname-records">Correct CNAME Records</h4>
<p>
<a href="#image-51e6fd967eead6b0a5a9f614e45e0dff" class="lightbox-link">
<img src="../../images/lab3-dig3.png" alt="ubuntu.cis527russfeld.cs.ksu.edu" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-51e6fd967eead6b0a5a9f614e45e0dff">
<img src="../../images/lab3-dig3.png" alt="ubuntu.cis527russfeld.cs.ksu.edu" class="lightbox-image" loading="lazy">
</a></p>
<h4 id="correct-ptr-record">Correct PTR Record</h4>
<p>
<a href="#image-00657c17a6d24ff8038d648f064cd2af" class="lightbox-link">
<img src="../../images/lab3-reverse1.png" alt="192.168.40.41" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-00657c17a6d24ff8038d648f064cd2af">
<img src="../../images/lab3-reverse1.png" alt="192.168.40.41" class="lightbox-image" loading="lazy">
</a></p>
<h4 id="correct-recursive-lookup-outside-our-dns-server">Correct Recursive Lookup (Outside our DNS Server)</h4>
<p>
<a href="#image-10ae0b2e6ce7646a0843d246679d4c96" class="lightbox-link">
<img src="../../images/lab3-recurse.png" alt="Recursive Lookup" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-10ae0b2e6ce7646a0843d246679d4c96">
<img src="../../images/lab3-recurse.png" alt="Recursive Lookup" class="lightbox-image" loading="lazy">
</a></p>

            <footer class="footline">

            </footer>
          </article>
        </div>
      </main>
    </div>
    
    </div>
    
    
    
    
    <script src="https://ksu-cs-textbooks.github.io/cis527/js/clipboard.min.js?1691705257" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis527/js/perfect-scrollbar.min.js?1691705257" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis527/js/theme.js?1691705257" defer></script>
    
    <script src="https://ksu-cs-textbooks.github.io/cis527/js/tele-scroll.js?1691705257 defer"></script>
    
  </body>
</html>
