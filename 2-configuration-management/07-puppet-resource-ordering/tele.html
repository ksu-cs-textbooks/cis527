<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content="Puppet Learning VM Deprecated As of 2023, the Puppet Learning VM is no longer being maintained. The videos below demonstrate some of the features of Puppet, which can also be done on your Ubuntu VM after installing Puppet Agent. Unfortunately, it is not easily possible to simulate an enterprise Puppet setup without this VM, so I’ll keep these videos up for demonstration purposes. –Russ
YouTube Video Resources Language: Relationships and Ordering from Puppet Video Script Now that we’ve seen Puppet Manifest files, let’s discuss some of the caveats of such a system."><meta name=author content="Russell Feldhausen"><meta name=twitter:card content="summary"><meta name=twitter:title content="Puppet Resource Ordering :: CIS 527 Textbook"><meta name=twitter:description content="Puppet Learning VM Deprecated As of 2023, the Puppet Learning VM is no longer being maintained. The videos below demonstrate some of the features of Puppet, which can also be done on your Ubuntu VM after installing Puppet Agent. Unfortunately, it is not easily possible to simulate an enterprise Puppet setup without this VM, so I’ll keep these videos up for demonstration purposes. –Russ
YouTube Video Resources Language: Relationships and Ordering from Puppet Video Script Now that we’ve seen Puppet Manifest files, let’s discuss some of the caveats of such a system."><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis527/2-configuration-management/07-puppet-resource-ordering/"><meta property="og:site_name" content="CIS 527 Textbook"><meta property="og:title" content="Puppet Resource Ordering :: CIS 527 Textbook"><meta property="og:description" content="Puppet Learning VM Deprecated As of 2023, the Puppet Learning VM is no longer being maintained. The videos below demonstrate some of the features of Puppet, which can also be done on your Ubuntu VM after installing Puppet Agent. Unfortunately, it is not easily possible to simulate an enterprise Puppet setup without this VM, so I’ll keep these videos up for demonstration purposes. –Russ
YouTube Video Resources Language: Relationships and Ordering from Puppet Video Script Now that we’ve seen Puppet Manifest files, let’s discuss some of the caveats of such a system."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="Configuration Management"><meta property="article:modified_time" content="2023-08-15T14:59:11-05:00"><meta itemprop=name content="Puppet Resource Ordering :: CIS 527 Textbook"><meta itemprop=description content="Puppet Learning VM Deprecated As of 2023, the Puppet Learning VM is no longer being maintained. The videos below demonstrate some of the features of Puppet, which can also be done on your Ubuntu VM after installing Puppet Agent. Unfortunately, it is not easily possible to simulate an enterprise Puppet setup without this VM, so I’ll keep these videos up for demonstration purposes. –Russ
YouTube Video Resources Language: Relationships and Ordering from Puppet Video Script Now that we’ve seen Puppet Manifest files, let’s discuss some of the caveats of such a system."><meta itemprop=dateModified content="2023-08-15T14:59:11-05:00"><meta itemprop=wordCount content="669"><title>Puppet Resource Ordering :: CIS 527 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis527/2-configuration-management/07-puppet-resource-ordering/ rel=canonical type=text/html title="Puppet Resource Ordering :: CIS 527 Textbook"><link href=/cis527/2-configuration-management/07-puppet-resource-ordering/index.xml rel=alternate type=application/rss+xml title="Puppet Resource Ordering :: CIS 527 Textbook"><link href=/cis527/2-configuration-management/07-puppet-resource-ordering/index.print.html rel=alternate type=text/html title="Puppet Resource Ordering :: CIS 527 Textbook"><link href=/cis527/2-configuration-management/07-puppet-resource-ordering/embed.html rel=alternate type=text/html title="Puppet Resource Ordering :: CIS 527 Textbook"><link href=/cis527/css/fontawesome-all.min.css?1725376836 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis527/css/fontawesome-all.min.css?1725376836 rel=stylesheet></noscript><link href=/cis527/css/nucleus.css?1725376836 rel=stylesheet><link href=/cis527/css/auto-complete.css?1725376836 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis527/css/auto-complete.css?1725376836 rel=stylesheet></noscript><link href=/cis527/css/perfect-scrollbar.min.css?1725376836 rel=stylesheet><link href=/cis527/css/fonts.css?1725376836 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis527/css/fonts.css?1725376836 rel=stylesheet></noscript><link href=/cis527/css/theme.css?1725376836 rel=stylesheet><link href=/cis527/css/theme-auto.css?1725376836 rel=stylesheet id=R-variant-style><link href=/cis527/css/chroma-auto.css?1725376836 rel=stylesheet id=R-variant-chroma-style><link href=/cis527/css/variant.css?1725376836 rel=stylesheet><link href=/cis527/css/print.css?1725376836 rel=stylesheet media=print><script src=/cis527/js/variant.js?1725376836></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis527",window.index_js_url="/cis527/index.search.js",window.variants&&variants.init(["auto","light-theme","dark-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis527/css/custom.css?1725376836 rel=stylesheet></head><body class="mobile-support tele disableInlineCopyToClipboard" data-url=/cis527/2-configuration-management/07-puppet-resource-ordering/><div id=tele class="tele mirror"><div id=R-body class=default-animation><div id=R-body-overlay></div><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=puppet-resource-ordering>Puppet Resource Ordering</h1><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Puppet Learning VM Deprecated</div><div class=box-content><p><em>As of 2023, the Puppet Learning VM is no longer being maintained. The videos below demonstrate some of the features of Puppet, which can also be done on your Ubuntu VM after installing Puppet Agent. Unfortunately, it is not easily possible to simulate an enterprise Puppet setup without this VM, so I&rsquo;ll keep these videos up for demonstration purposes.</em> &ndash;Russ</p></div></div><a href="https://www.youtube.com/watch?v=RywZUa_x3oA">YouTube Video</a><h4 id=resources>Resources</h4><ul><li><a href=https://puppet.com/docs/puppet/latest/lang_relationships.html rel=external target=_blank>Language: Relationships and Ordering</a> from Puppet</li></ul><h4 id=video-script>Video Script</h4><p>Now that we&rsquo;ve seen Puppet Manifest files, let&rsquo;s discuss some of the caveats of such a system. On the Learning Puppet VM, during the <code>hello_puppet</code> quest as described in the earlier videos, I&rsquo;m going to continue to create manifest files on the <code>hello.puppet.vm</code> node.</p><p>Using Nano, create the following manifest file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-pp data-lang=pp><span class=line><span class=cl><span class=kt>file</span><span class=w> </span><span class=cm>{ &#39;/tmp/test1&#39;:
</span></span></span><span class=line><span class=cl><span class=cm>  ensure =&gt; &#39;file&#39;
</span></span></span><span class=line><span class=cl><span class=cm>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>file</span><span class=w> </span><span class=cm>{ &#39;/tmp/test2&#39;:
</span></span></span><span class=line><span class=cl><span class=cm>  ensure =&gt; &#39;file&#39;
</span></span></span><span class=line><span class=cl><span class=cm>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>file</span><span class=w> </span><span class=cm>{ &#39;/tmp/test3&#39;:
</span></span></span><span class=line><span class=cl><span class=cm>  ensure =&gt; &#39;file&#39;
</span></span></span><span class=line><span class=cl><span class=cm>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>notify<span class=w> </span><span class=cm>{ &#34;First Notification&#34;: }</span>
</span></span><span class=line><span class=cl>notify<span class=w> </span><span class=cm>{ &#34;Second Notification&#34;: }</span>
</span></span><span class=line><span class=cl>notify<span class=w> </span><span class=cm>{ &#34;Third Notification&#34;: }</span></span></span></code></pre></div><p>Once that is done, apply the manifest:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo puppet apply test.pp</span></span></code></pre></div><p>When you do, you may see things applied out of order. Since a Puppet Manifest file only defines the desired configuration, it is up to the Puppet Agent tool to determine which steps are necessary and in what order. This is because Puppet considers each resource definition to be <strong>atomic</strong>, meaning that it is independent of all other resources. In some cases, however, we want to make sure that some resources are configured before others. Thankfully, Puppet gives us many ways to do so.</p><p>The first uses the before and require keywords. Here is an example from the Puppet documentation linked in the resources section below the video:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-pp data-lang=pp><span class=line><span class=cl><span class=k>package</span><span class=w> </span><span class=cm>{ &#39;openssh-server&#39;:
</span></span></span><span class=line><span class=cl><span class=cm>  ensure =&gt; present,
</span></span></span><span class=line><span class=cl><span class=cm>  before =&gt; File[&#39;/etc/ssh/sshd_config&#39;],
</span></span></span><span class=line><span class=cl><span class=cm>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>file</span><span class=w> </span><span class=cm>{ &#39;/etc/ssh/sshd_config&#39;:
</span></span></span><span class=line><span class=cl><span class=cm>  ensure =&gt; file,
</span></span></span><span class=line><span class=cl><span class=cm>  mode =&gt; &#39;0600&#39;,
</span></span></span><span class=line><span class=cl><span class=cm>  source =&gt; &#39;puppet:///modules/sshd/sshd_config&#39;,
</span></span></span><span class=line><span class=cl><span class=cm>  require =&gt; Package[&#39;openssh-server&#39;],
</span></span></span><span class=line><span class=cl><span class=cm>}</span></span></span></code></pre></div><p>Each of these elements creates the same relationship. You only need to include either the before or require keyword in one of the resources, but both are not required.</p><p>Similarly, the notify and subscribe keywords create a similar relationship. From the documentation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-pp data-lang=pp><span class=line><span class=cl><span class=kt>file</span><span class=w> </span><span class=cm>{ &#39;/etc/ssh/sshd_config&#39;:
</span></span></span><span class=line><span class=cl><span class=cm>  ensure =&gt; file,
</span></span></span><span class=line><span class=cl><span class=cm>  mode =&gt; &#39;0600&#39;,
</span></span></span><span class=line><span class=cl><span class=cm>  source =&gt; &#39;puppet:///modules/sshd/sshd_config&#39;,
</span></span></span><span class=line><span class=cl><span class=cm>  notify =&gt; Service[&#39;sshd&#39;],
</span></span></span><span class=line><span class=cl><span class=cm>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>service<span class=w> </span><span class=cm>{ &#39;sshd&#39;:
</span></span></span><span class=line><span class=cl><span class=cm>  ensure =&gt; running,
</span></span></span><span class=line><span class=cl><span class=cm>  enable =&gt; true,
</span></span></span><span class=line><span class=cl><span class=cm>  subscribe =&gt; File[&#39;/etc/ssh/sshd_config&#39;],
</span></span></span><span class=line><span class=cl><span class=cm>}</span></span></span></code></pre></div><p>Again, only one or the other is required. However, unlike with the before and require keywords, in this case the second item will only be refreshed if the prior resource has changed. In this example, if the <code>sshd_config</code> file is changed, then the <code>sshd</code> service will be restarted so it will read the newly changed file. This is a very powerful tool for making changes to configuration files and making sure the services immediately restart and load the new configuration.</p><p>Finally, the third method is through the use of chaining arrows. This tells the Puppet Agent to apply resources in the order they are written in the manifest. One of the most powerful and common uses of this is to create a &ldquo;Package, File, Service&rdquo; chain. Here is the example from the Puppet documentation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-pp data-lang=pp><span class=line><span class=cl><span class=se>#</span><span class=w> </span>first<span class=o>:</span>
</span></span><span class=line><span class=cl><span class=k>package</span><span class=w> </span><span class=cm>{ &#39;openssh-server&#39;:
</span></span></span><span class=line><span class=cl><span class=cm>  ensure =&gt; present,
</span></span></span><span class=line><span class=cl><span class=cm>}</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=se>#</span><span class=w> </span><span class=kr>and</span><span class=w> </span><span class=kr>then</span><span class=o>:</span>
</span></span><span class=line><span class=cl><span class=kt>file</span><span class=w> </span><span class=cm>{ &#39;/etc/ssh/sshd_config&#39;:
</span></span></span><span class=line><span class=cl><span class=cm>  ensure =&gt; file,
</span></span></span><span class=line><span class=cl><span class=cm>  mode =&gt; &#39;0600&#39;,
</span></span></span><span class=line><span class=cl><span class=cm>  source =&gt; &#39;puppet:///modules/sshd/sshd_config&#39;,
</span></span></span><span class=line><span class=cl><span class=cm>}</span><span class=w> </span><span class=err>~</span><span class=o>&gt;</span><span class=w> </span><span class=se>#</span><span class=w> </span><span class=kr>and</span><span class=w> </span><span class=kr>then</span><span class=p>,</span><span class=w> </span><span class=kr>if</span><span class=w> </span>the<span class=w> </span>previous<span class=w> </span><span class=kt>file</span><span class=w> </span>was<span class=w> </span>updated<span class=o>:</span>
</span></span><span class=line><span class=cl>service<span class=w> </span><span class=cm>{ &#39;sshd&#39;:
</span></span></span><span class=line><span class=cl><span class=cm>  ensure =&gt; running,
</span></span></span><span class=line><span class=cl><span class=cm>  enable =&gt; true,
</span></span></span><span class=line><span class=cl><span class=cm>}</span></span></span></code></pre></div><p>This manifest will ensure the <code>openssh-server</code> package is installed first. Then, once it is installed, it will place the desired configuration file on the system. The first arrow with a simple hyphen creates a before/require relationship. Then, if that file is modified in any way, the second arrow, using a tilde <code>~</code> character, will enforce a notify/subscribe relationship and cause the <code>sshd</code> service to refresh.</p><p>As you work on your Puppet Manifest files for Lab 2, it is helpful to keep in mind that some resources may need to be chained together to work properly. However, do not try to chain together your entire manifest file, as that defeats much of the flexibility of Puppet itself.</p><footer class=footline></footer></article></div></main></div></div><script src=/cis527/js/clipboard.min.js?1725376836 defer></script><script src=/cis527/js/perfect-scrollbar.min.js?1725376836 defer></script><script src=/cis527/js/theme.js?1725376836 defer></script><script src=/cis527/js/tele-scroll.js?1725376836 defer></script></body></html>