




	
	
		

	
	
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.101.0">
    <meta name="generator" content="Relearn 5.2.0+tip">
    <meta name="description" content="CIS 527 Textbook">
    <meta name="author" content="Russell Feldhausen">
    <title>Email Protocols :: CIS 527 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cis527/3-core-networking-services/14-email-protocols/" rel="canonical" type="text/html" title="CIS 527 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis527/3-core-networking-services/14-email-protocols/index.xml" rel="alternate" type="application/rss+xml" title="CIS 527 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis527/3-core-networking-services/14-email-protocols/index.print.html" rel="alternate" type="text/html" title="CIS 527 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis527/3-core-networking-services/14-email-protocols/embed.html" rel="alternate" type="text/html" title="CIS 527 Textbook">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/fontawesome-all.min.css?1663688152" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis527/css/fontawesome-all.min.css?1663688152" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/featherlight.min.css?1663688152" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis527/css/featherlight.min.css?1663688152" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/auto-complete.css?1663688152" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis527/css/auto-complete.css?1663688152" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/perfect-scrollbar.min.css?1663688152" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/nucleus.css?1663688152" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/fonts.css?1663688152" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis527/css/fonts.css?1663688152" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/theme.css?1663688152" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/theme-light-theme.css?1663688152" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/ie.css?1663688152" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/variant.css?1663688152" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/print.css?1663688152" rel="stylesheet" media="print">
    <script src="https://ksu-cs-textbooks.github.io/cis527/js/variant.js?1663688152"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      var index_url="https://ksu-cs-textbooks.github.io/cis527/index.json";
      var root_url="https://ksu-cs-textbooks.github.io/cis527/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cis527/';
      window.variants && variants.init( [ 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cis527/css/custom.css?1663688152" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cis527/js/jquery.min.js?1663688152" defer></script>

  </head>
  <body class="mobile-support tele disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cis527/3-core-networking-services/14-email-protocols/">
    
    <div id="tele" class="tele mirror">
    
    <div id="body" class="default-animation">
      
      
      
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <div id="head-tags">
          </div>
          <article class="default">
<h1>Email Protocols</h1>

<a href="https://www.youtube.com/watch?v=lcg43SAJv5Q">YouTube Video</a>

<h4 id="resources">Resources</h4>
<ul>
<li><strong>

<a href="https://ksu-cs-textbooks.github.io/cis527/3-core-networking-services/14-email-protocols-slides/">Slides</a></strong></li>
<li>

<a href="https://en.wikipedia.org/wiki/Email" target="_blank" rel="noopener">Email</a> on Wikipedia</li>
<li>

<a href="https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol" target="_blank" rel="noopener">Simple Mail Transfer Protocol (SMTP)</a> on Wikipedia</li>
<li>

<a href="https://en.wikipedia.org/wiki/Post_Office_Protocol" target="_blank" rel="noopener">Post Office Protocol (POP3)</a> on Wikipedia</li>
<li>

<a href="https://en.wikipedia.org/wiki/Internet_Message_Access_Protocol" target="_blank" rel="noopener">Internet Message Access Protocol (IMAP)</a> on Wikipedia</li>
<li>

<a href="https://www.digitalocean.com/community/tutorials/why-you-may-not-want-to-run-your-own-mail-server" target="_blank" rel="noopener">Why You May Not Want to Run Your Own Mail Server</a> from DigitalOcean</li>
</ul>
<h4 id="video-transcript">Video Transcript</h4>
<p>In this video, we&rsquo;ll look at one more set of application layer protocols, the ones for sending and receiving electronic mail, or email.</p>
<p>Email was developed in the early days of the ARPANET, and was originally built as an extension to the existing File Transfer Protocol or FTP. Using these email protocols, a user on one system could send a message to a user on another system. Email was originally designed to be a text-only format, but the later introduction of the Multipurpose Internet Mail Extensions, or MIME, allowed emails to include additional content such as HTML markup, images, and more.</p>
<p>To send and receive email across the internet, there are a number of protocols involved. First, the Simple Mail Transfer Protocol (SMTP) is used to send mail from an email client to a server, and then between the servers until it reaches its desired recipient. Once there, the recipient can use either the Post Office Protocol (POP3), the Internet Message Access Protocol (IMAP), Microsoft&rsquo;s Exchange ActiveSync, or any number of webmail clients to actually view the email.</p>
<p>On an email server itself, there are several pieces of software involved in sending and receiving email. First, the Mail Transfer Agent (MTA) is responsible for SMTP connections, and is primarily used to send and receive email from other email servers. Next, the Mail Delivery Agent (MDA) will receive email from the MTA destined for users on this server, and will route it to the appropriate mailbox. Finally, there are any number of ways to get the email from the mailbox to the user, using the POP3, IMAP, or any number of other protocols. Or, as is often the case today, the user can simply view the email in a web browser, using a webmail client.</p>
<p>To see how email is routed through the internet, here is a nice diagram from Wikipedia showing the process. When Alice wants to send an email to Bob, she must first compose the email and send it to her local MTA using the SMTP protocol. Then, the MTA will use a DNS lookup to find the MX entry for Bob&rsquo;s email domain, which is <code>b.org</code> in this example. Then, the MTA can send that email to Bob&rsquo;s MTA, which will then pass it along to the MDA on that system, placing it in Bob&rsquo;s mailbox. Finally, Bob can then use a protocol such as POP3 to read the email from his mailbox onto his computer.</p>
<p>As with many other application layer protocols, several of the core email protocols are text-based as well, and can easily be done by hand using <code>telnet</code>. This slide shows what it would look like to use <code>telnet</code> to receive email using the POP3 protocol. However, most email servers today require the use of a secure protocol when accessing an email account, so it is difficult to perform this activity today.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cis527@cis527russfeldpuppet:~$ telnet mail.servergrove.com <span style="color:#ae81ff">110</span>
</span></span><span style="display:flex;"><span>Trying 69.195.222.232...
</span></span><span style="display:flex;"><span>Connected to mail.servergrove.com.
</span></span><span style="display:flex;"><span>Escape character is <span style="color:#e6db74">&#39;^]&#39;</span>.
</span></span><span style="display:flex;"><span>+OK POP3 ready
</span></span><span style="display:flex;"><span>USER test@beattieunioncemetery.org
</span></span><span style="display:flex;"><span>+OK
</span></span><span style="display:flex;"><span>PASS uns3cur3
</span></span><span style="display:flex;"><span>+OK logged in.
</span></span><span style="display:flex;"><span>STAT
</span></span><span style="display:flex;"><span>+OK <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">5580</span>
</span></span><span style="display:flex;"><span>RETR <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>+OK <span style="color:#ae81ff">4363</span> octets follow.
</span></span><span style="display:flex;"><span>Received: <span style="color:#f92672">(</span>qmail <span style="color:#ae81ff">11929</span> invoked from network<span style="color:#f92672">)</span>; <span style="color:#ae81ff">26</span> Feb <span style="color:#ae81ff">2016</span> 16:16:14 +0000
</span></span><span style="display:flex;"><span>Received-SPF: none <span style="color:#f92672">(</span>no valid SPF record<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Received: from mx-mia-1.servergrove.com <span style="color:#f92672">(</span>69.195.198.246<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  by sg111.servergrove.com with SMTP; <span style="color:#ae81ff">26</span> Feb <span style="color:#ae81ff">2016</span> 16:15:43 +0000
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>DELE <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>+OK message <span style="color:#ae81ff">2</span> deleted
</span></span><span style="display:flex;"><span>QUIT
</span></span><span style="display:flex;"><span>+OK Bye-bye.
</span></span></code></pre></div><p>However, many SMTP servers still support sending email via an unsecured connection. This is mainly because there are several older devices such as printers, copiers, network devices, and security devices that are all designed to send alerts via email. Those older devices are difficult if not impossible to upgrade, so many system administrators are forced to use an unsecured SMTP server to accept those notification emails. So, we can use one of those to perform this quick test and see how it works.</p>
<p>For this example, I will connect to the K-State CS Linux servers, as the server we are using will only accept emails from a limited number of systems, including these servers. In addition, it will only accept email sent to a limited number of domains. Both of these protections are in place to limit the amount of unsolicited SPAM email that could be sent using this server.</p>
<p>First, I&rsquo;ll use <code>telnet</code> to connect to the email server on port 25, the well-known port for SMTP:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>telnet smtp.cs.ksu.edu <span style="color:#ae81ff">25</span>
</span></span></code></pre></div><p>Then, I&rsquo;ll need to establish a connection with it, send my email, and close the connection. To make it easier to see below, I&rsquo;ve prefixed the messages from the server and my telnet client with <code>###</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">### Trying 129.130.10.29...</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### Connected to daytona.cs.ksu.edu.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### Escape character is &#39;^]&#39;.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### 220 daytona.cis.ksu.edu ESMTP Postfix (Debian/GNU)</span>
</span></span><span style="display:flex;"><span>HELO daytona.cs.ksu.edu
</span></span><span style="display:flex;"><span><span style="color:#75715e">### 250 daytona.cis.ksu.edu</span>
</span></span><span style="display:flex;"><span>MAIL FROM: testuser@ksu.edu
</span></span><span style="display:flex;"><span><span style="color:#75715e">### 250 2.1.0 Ok</span>
</span></span><span style="display:flex;"><span>RCPT TO: russfeld@ksu.edu
</span></span><span style="display:flex;"><span><span style="color:#75715e">### 250 2.1.5 Ok</span>
</span></span><span style="display:flex;"><span>DATA
</span></span><span style="display:flex;"><span><span style="color:#75715e">### 354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;</span>
</span></span><span style="display:flex;"><span>From: <span style="color:#e6db74">&#34;Russell Feldhausen&#34;</span>
</span></span><span style="display:flex;"><span>To: <span style="color:#e6db74">&#34;Test&#34;</span>
</span></span><span style="display:flex;"><span>Date: Fri, <span style="color:#ae81ff">6</span> September <span style="color:#ae81ff">2018</span> 10:00:00 -0700
</span></span><span style="display:flex;"><span>Subject: Test Message
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>This is a test! Hope it Works!
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span><span style="color:#75715e">### 250 2.0.0 Ok: queued as 827D23FDD1</span>
</span></span><span style="display:flex;"><span>QUIT
</span></span><span style="display:flex;"><span><span style="color:#75715e">### 221 2.0.0 Bye</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### Connection closed by foreign host.</span>
</span></span></code></pre></div><p>Once I have completed that process, I should receive the email in my inbox shortly. You&rsquo;ll notice that there are many things interesting about this email. First, my email client reports the correct date and time that it was received, but at the top of the email itself it gives a different timestamp for when it was sent. Additionally, even though I used my own email address as the recipient, in the email header I listed the name &ldquo;Test&rdquo; as the recipient, which is what appears in the email client.</p>
<p>I hope that this example clearly demonstrates how easy it is to spoof any part of an email. The email servers and protocols themselves don&rsquo;t enforce many rules at all, so it is easy to abuse the system, leading to the large amount of SPAM email we receive on a daily basis. However, I still find it fascinating to see behind the curtains a little at how these protocols are actually structured and how easy it is to work with them.</p>

            <footer class="footline">
            </footer>
          </article>
        </div>
      </main>
    </div>
    
  </div>
    
    
    
    
    <script src="https://ksu-cs-textbooks.github.io/cis527/js/clipboard.min.js?1663688152" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis527/js/perfect-scrollbar.min.js?1663688152" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis527/js/featherlight.min.js?1663688152" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis527/js/theme.js?1663688152" defer></script>
    
    <script src="https://ksu-cs-textbooks.github.io/cis527/js/tele-scroll.js?1663688152 defer"></script>
    
  </body>
</html>
